const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./UserNameSetupModal-a5tTULBs.js","./antd-Bl7BgLRS.js","./vendor-CeQafwst.js","./supabase-DQJTPruz.js","./router-xrOJY9lc.js","./utils-BLtkkhtr.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,o=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,s=(e,t)=>{for(var r in t||(t={}))a.call(t,r)&&o(e,r,t[r]);if(n)for(var r of n(t))i.call(t,r)&&o(e,r,t[r]);return e},l=(e,n)=>t(e,r(n)),c=(e,t)=>{var r={};for(var o in e)a.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&n)for(var o of n(e))t.indexOf(o)<0&&i.call(e,o)&&(r[o]=e[o]);return r},d=(e,t,r)=>new Promise((n,a)=>{var i=e=>{try{s(r.next(e))}catch(t){a(t)}},o=e=>{try{s(r.throw(e))}catch(t){a(t)}},s=e=>e.done?n(e.value):Promise.resolve(e.value).then(i,o);s((r=r.apply(e,t)).next())});import{r as m,a as p,g as u}from"./vendor-CeQafwst.js";import{R as h,T as x,B as g,r as y,S as f,L as j,a as b,D as v,b as w,c as S,d as k,e as _,f as C,g as I,h as N,i as z,j as R,k as $,l as W,M as T,s as E,C as B,m as F,A as P,n as U,o as A,I as O,p as D,q as M,t as L,u as q,v as Y,F as H,w as V,x as G,y as K,z as J,E as Q,G as X,H as Z,J as ee,K as te,N as re,O as ne,P as ae,Q as ie,U as oe,V as se}from"./antd-Bl7BgLRS.js";import{c as le,_ as ce}from"./supabase-DQJTPruz.js";import{N as de,u as me,a as pe,B as ue,R as he,b as xe}from"./router-xrOJY9lc.js";import{r as ge}from"./utils-BLtkkhtr.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var ye,fe,je={exports:{}},be={};var ve,we=(fe||(fe=1,je.exports=function(){if(ye)return be;ye=1;var e=m(),t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,a=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function o(e,r,o){var s,l={},c=null,d=null;for(s in void 0!==o&&(c=""+o),void 0!==r.key&&(c=""+r.key),void 0!==r.ref&&(d=r.ref),r)n.call(r,s)&&!i.hasOwnProperty(s)&&(l[s]=r[s]);if(e&&e.defaultProps)for(s in r=e.defaultProps)void 0===l[s]&&(l[s]=r[s]);return{$$typeof:t,type:e,key:c,ref:d,props:l,_owner:a.current}}return be.Fragment=r,be.jsx=o,be.jsxs=o,be}()),je.exports),Se={};const ke=u(function(){if(ve)return Se;ve=1;var e=p();return Se.createRoot=e.createRoot,Se.hydrateRoot=e.hydrateRoot,Se}()),_e="ACL å­£ä¿é¤Š",Ce="ACL å­£ä¿é¤Š",Ie="/home",Ne="/",ze="/register",Re="/project/:id",$e="/project/:id/season-setting",We="/project/:id/maintain-setting",Te="/project/:id/addmaintainancedata",Ee="/project/:id/viewmaintainancedata",Be="/project/:id/export-excel";class Fe extends h.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){}render(){var e;return this.state.hasError?we.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",padding:"20px",textAlign:"center"},children:[we.jsx(x.Title,{level:3,type:"danger",children:"ç™¼ç”ŸéŒ¯èª¤"}),we.jsx(x.Text,{style:{marginBottom:"20px"},children:(null==(e=this.state.error)?void 0:e.message)||"æœªçŸ¥éŒ¯èª¤"}),we.jsx(g,{type:"primary",onClick:()=>window.location.href="/",children:"é‡æ–°è¼‰å…¥é é¢"})]}):this.props.children}}const Pe={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_ANON_KEY:"your-anon-key-here",VITE_SUPABASE_URL:"https://your-project.supabase.co"},Ue=(e,t="")=>{const r=Pe[e];return r||t},Ae=le(Ue("VITE_SUPABASE_URL","https://placeholder.supabase.co"),Ue("VITE_SUPABASE_ANON_KEY","placeholder-key")),Oe={getCurrentUser(){return d(this,null,function*(){const{data:{user:e},error:t}=yield Ae.auth.getUser();return{user:e,error:t}})},getUserName(){return d(this,null,function*(){const{user:e,error:t}=yield this.getCurrentUser();if(t||!(null==e?void 0:e.email))return"";const{data:r,error:n}=yield Ae.from("user_names").select("user").eq("email",e.email).single();return!n&&(null==r?void 0:r.user)?r.user:e.email})},logout(){return d(this,null,function*(){localStorage.clear(),yield Ae.auth.signOut()})},isAuthenticated(){return d(this,null,function*(){const{user:e}=yield this.getCurrentUser();return!!e})}},De=()=>{const[e,t]=y.useState(null),[r,n]=y.useState(""),[a,i]=y.useState(!0),o=y.useCallback(()=>d(null,null,function*(){i(!0);try{const{user:e}=yield Oe.getCurrentUser();if(t(e),e){const e=yield Oe.getUserName();n(e)}}catch(e){}finally{i(!1)}}),[]);y.useEffect(()=>{o()},[o]);const s=y.useCallback(()=>d(null,null,function*(){yield Oe.logout(),t(null),n("")}),[]);return y.useMemo(()=>({user:e,userName:r,loading:a,logout:s,isAuthenticated:!!e}),[e,r,a,s])},Me=({tip:e="è¼‰å…¥ä¸­...",style:t={}})=>we.jsx("div",{style:s({position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",background:"var(--bg-primary)",zIndex:9999},t),children:we.jsxs("div",{className:"glass-morphism animate-fadeInUp",style:{padding:"60px 40px",textAlign:"center",borderRadius:"20px",minWidth:"300px"},children:[we.jsx("div",{className:"animate-bounce",style:{marginBottom:"24px"},children:we.jsx("div",{className:"neon-glow",style:{width:"80px",height:"80px",borderRadius:"50%",background:"var(--primary-gradient)",margin:"0 auto",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"2rem",animation:"rotateIn 2s ease-out infinite"},children:"âš¡"})}),we.jsx(f,{size:"large",style:{color:"var(--text-accent)"}}),we.jsx("div",{style:{marginTop:"24px",color:"var(--text-primary)",fontSize:"18px",fontWeight:600},children:e}),we.jsx("div",{style:{marginTop:"8px",color:"var(--text-secondary)",fontSize:"14px"},children:"è«‹ç¨å€™ç‰‡åˆ»..."})]})}),Le=({children:e})=>{const{isAuthenticated:t,loading:r}=De();return r?we.jsx(Me,{}):t?e:we.jsx(de,{to:Ne,replace:!0})},qe={projects:{getAll(){return d(this,null,function*(){const{data:e,error:t}=yield Ae.from("home_project_card").select("*");return{data:e||[],error:t}})},getById(e){return d(this,null,function*(){const{data:t,error:r}=yield Ae.from("home_project_card").select("*").eq("id",e).single();return{data:t,error:r}})},create(e){return d(this,null,function*(){const{data:t,error:r}=yield Ae.from("home_project_card").insert([e]);return{data:t,error:r}})}},users:{getAll(){return d(this,null,function*(){const{data:e,error:t}=yield Ae.from("user_names").select("user, email");return{data:e||[],error:t}})},getByEmail(e){return d(this,null,function*(){const{data:t,error:r}=yield Ae.from("user_names").select("user").eq("email",e);return{data:t||[],error:r}})},create(e){return d(this,null,function*(){const{data:t,error:r}=yield Ae.from("user_names").insert([e]);return{data:t,error:r}})},checkUsernameExists(e){return d(this,null,function*(){const{data:t,error:r}=yield Ae.from("user_names").select("user").eq("user",e);return{exists:t&&t.length>0,error:r}})}},maintenanceData:{create(e){return d(this,null,function*(){const{data:t,error:r}=yield Ae.from("maintainance_data").insert(e);return{data:t,error:r}})},getByProject(e){return d(this,null,function*(){const{data:t,error:r}=yield Ae.from("maintainance_data").select("*").eq("project",e);return{data:t||[],error:r}})},getOptions(e){return d(this,null,function*(){const{data:t,error:r}=yield Ae.from("maintainance_data").select("floor, thing, location").eq("project",e);return{data:t||[],error:r}})},delete(e){return d(this,null,function*(){const{data:t,error:r}=yield Ae.from("maintainance_data").delete().eq("id",e);return{data:t,error:r}})}},maintenancePhoto:{getByProject(e){return d(this,null,function*(){const{data:t,error:r}=yield Ae.from("maintainance_photo").select("*").eq("project",e).order("created_at",{ascending:!1}).limit(1e4);return{data:t||[],error:r}})},create(e){return d(this,null,function*(){try{const r=e,{files:n,addWatermark:a}=r,i=c(r,["files","addWatermark"]);if(!n||0===n.length)return{success:!1,error:"æ²’æœ‰æª”æ¡ˆéœ€è¦ä¸Šå‚³"};const o=[];for(let e=0;e<n.length;e++){const r=n[e],c=r.name.split(".").pop(),d=`${Date.now()}_${e}.${c}`,m=`${i.project_name}/${d}`;let p=r.originFileObj||r;if(a&&p.type.startsWith("image/"))try{p=yield qe.maintenancePhoto.addWatermarkToImage(p,i)}catch(t){}const{data:u,error:h}=yield Ae.storage.from("maintainance-data-photo").upload(m,p);if(h)return{success:!1,error:`æª”æ¡ˆä¸Šå‚³å¤±æ•—: ${h.message}`};o.push(l(s({},i),{photo_path:m,photo_name:r.name}))}const{data:d,error:m}=yield Ae.from("maintainance_photo").insert(o);return m?{success:!1,error:`è³‡æ–™åº«æ’å…¥å¤±æ•—: ${m.message}`}:{success:!0,data:d}}catch(r){return{success:!1,error:r.message}}})},addWatermarkToImage(e,t){return d(this,null,function*(){return new Promise((r,n)=>{const a=document.createElement("canvas"),i=a.getContext("2d"),o=new Image;o.onload=()=>{try{a.width=o.width,a.height=o.height,i.drawImage(o,0,0);const s=Math.max(20,Math.min(o.width/25,50));i.font=`bold ${s}px Arial`,i.fillStyle="white",i.strokeStyle="black",i.lineWidth=4,i.textAlign="left",i.shadowColor="rgba(0, 0, 0, 0.8)",i.shadowBlur=4,i.shadowOffsetX=2,i.shadowOffsetY=2;const l=`${t.project_name||"N/A"} - ${t.floor||"N/A"} - ${t.thing||"N/A"} - ${t.location||"N/A"}`,c=`æ—¥æœŸ: ${t.maintainance_time||"N/A"} | äººå“¡: ${t.maintainance_user||"N/A"}`,d=30,m=a.height-s-30,p=a.height-15;i.strokeText(l,d,m),i.fillText(l,d,m),i.strokeText(c,d,p),i.fillText(c,d,p),a.toBlob(t=>{if(t){const n=new File([t],e.name,{type:e.type,lastModified:Date.now()});r(n)}else n(new Error("Failed to create blob from canvas"))},e.type,.95)}catch(s){n(s)}},o.onerror=e=>{n(e)};const s=URL.createObjectURL(e);o.src=s,setTimeout(()=>{URL.revokeObjectURL(s)},1e4)})})},getByProject(e){return d(this,null,function*(){const{data:t,error:r}=yield Ae.from("maintainance_photo").select("*").eq("project",e);return{data:t||[],error:r}})},getOptions(e){return d(this,null,function*(){const{data:t,error:r}=yield Ae.from("maintainance_photo").select("floor, thing, location").eq("project",e);if(r)return{data:{floors:[],things:[],locations:[]},error:r};return{data:{floors:[...new Set(t.map(e=>e.floor).filter(Boolean))],things:[...new Set(t.map(e=>e.thing).filter(Boolean))],locations:[...new Set(t.map(e=>e.location).filter(Boolean))]},error:null}})},delete(e){return d(this,null,function*(){const{data:t,error:r}=yield Ae.from("maintainance_photo").delete().eq("id",e);return{data:t,error:r}})}},maintenanceSettings:{getByProject(e){return d(this,null,function*(){const{data:t,error:r}=yield Ae.from("maintainance_setting").select("*").eq("name",e).single();return{data:t,error:r}})},create(e){return d(this,null,function*(){const{data:t,error:r}=yield Ae.from("maintainance_setting").insert(e);return{data:t,error:r}})},update(e,t){return d(this,null,function*(){const{data:r,error:n}=yield Ae.from("maintainance_setting").upsert(t).eq("name",e);return{data:r,error:n}})}},storage:{getImageUrl(e,t){if(!t)return"";const{data:r}=Ae.storage.from(e).getPublicUrl(t);return(null==r?void 0:r.publicUrl)||""},uploadFile(e,t,r){return d(this,null,function*(){const{data:n,error:a}=yield Ae.storage.from(e).upload(t,r);return{data:n,error:a}})},deleteImage(e,t){return d(this,null,function*(){const{data:r,error:n}=yield Ae.storage.from(e).remove([t]);return{data:r,error:n}})}}};var Ye,He,Ve,Ge={};const Ke=u(function(){if(Ve)return He;Ve=1;var e=function(){if(Ye)return Ge;Ye=1,Ge.match=function(e,t){return i(e).some(function(e){var r=e.inverse,n="all"===e.type||t.type===e.type;if(n&&r||!n&&!r)return!1;var a=e.expressions.every(function(e){var r=e.feature,n=e.modifier,a=e.value,i=t[r];if(!i)return!1;switch(r){case"orientation":case"scan":return i.toLowerCase()===a.toLowerCase();case"width":case"height":case"device-width":case"device-height":a=l(a),i=l(i);break;case"resolution":a=s(a),i=s(i);break;case"aspect-ratio":case"device-aspect-ratio":case"device-pixel-ratio":a=o(a),i=o(i);break;case"grid":case"color":case"color-index":case"monochrome":a=parseInt(a,10)||1,i=parseInt(i,10)||0}switch(n){case"min":return i>=a;case"max":return i<=a;default:return i===a}});return a&&!r||!a&&r})},Ge.parse=i;var e=/(?:(only|not)?\s*([^\s\(\)]+)(?:\s*and)?\s*)?(.+)?/i,t=/\(\s*([^\s\:\)]+)\s*(?:\:\s*([^\s\)]+))?\s*\)/,r=/^(?:(min|max)-)?(.+)/,n=/(em|rem|px|cm|mm|in|pt|pc)?$/,a=/(dpi|dpcm|dppx)?$/;function i(n){return n.split(",").map(function(n){var a=(n=n.trim()).match(e),i=a[1],o=a[2],s=a[3]||"",l={};return l.inverse=!!i&&"not"===i.toLowerCase(),l.type=o?o.toLowerCase():"all",s=s.match(/\([^\)]+\)/g)||[],l.expressions=s.map(function(e){var n=e.match(t),a=n[1].toLowerCase().match(r);return{modifier:a[1],feature:a[2],value:n[2]}}),l})}function o(e){var t,r=Number(e);return r||(r=(t=e.match(/^(\d+)\s*\/\s*(\d+)$/))[1]/t[2]),r}function s(e){var t=parseFloat(e);switch(String(e).match(a)[1]){case"dpcm":return t/2.54;case"dppx":return 96*t;default:return t}}function l(e){var t=parseFloat(e);switch(String(e).match(n)[1]){case"em":case"rem":return 16*t;case"cm":return 96*t/2.54;case"mm":return 96*t/2.54/10;case"in":return 96*t;case"pt":return 72*t;case"pc":return 72*t/12;default:return t}}return Ge}().match,t="undefined"!=typeof window?window.matchMedia:null;function r(r,n,a){var i,o=this;function s(e){o.matches=e.matches,o.media=e.media}t&&!a&&(i=t.call(window,r)),i?(this.matches=i.matches,this.media=i.media,i.addListener(s)):(this.matches=e(r,n),this.media=r),this.addListener=function(e){i&&i.addListener(e)},this.removeListener=function(e){i&&i.removeListener(e)},this.dispose=function(){i&&i.removeListener(s)}}return He=function(e,t,n){return new r(e,t,n)}}());var Je=/[A-Z]/g,Qe=/^ms-/,Xe={};function Ze(e){return"-"+e.toLowerCase()}function et(e){if(Xe.hasOwnProperty(e))return Xe[e];var t=e.replace(Je,Ze);return Xe[e]=Qe.test(t)?"-"+t:t}var tt,rt,nt,at,it,ot={exports:{}};function st(){if(rt)return tt;rt=1;return tt="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}function lt(){if(at)return nt;at=1;var e=st();function t(){}function r(){}return r.resetWarningCache=t,nt=function(){function n(t,r,n,a,i,o){if(o!==e){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function a(){return n}n.isRequired=n;var i={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:a,element:n,elementType:n,instanceOf:a,node:n,objectOf:a,oneOf:a,oneOfType:a,shape:a,exact:a,checkPropTypes:r,resetWarningCache:t};return i.PropTypes=i,i}}function ct(){return it||(it=1,ot.exports=lt()()),ot.exports}const dt=u(ct()),mt=dt.oneOfType([dt.string,dt.number]),pt={all:dt.bool,grid:dt.bool,aural:dt.bool,braille:dt.bool,handheld:dt.bool,print:dt.bool,projection:dt.bool,screen:dt.bool,tty:dt.bool,tv:dt.bool,embossed:dt.bool},ut={orientation:dt.oneOf(["portrait","landscape"]),scan:dt.oneOf(["progressive","interlace"]),aspectRatio:dt.string,deviceAspectRatio:dt.string,height:mt,deviceHeight:mt,width:mt,deviceWidth:mt,color:dt.bool,colorIndex:dt.bool,monochrome:dt.bool,resolution:mt,type:Object.keys(pt)},{type:ht}=ut,xt=c(ut,["type"]),gt=s({minAspectRatio:dt.string,maxAspectRatio:dt.string,minDeviceAspectRatio:dt.string,maxDeviceAspectRatio:dt.string,minHeight:mt,maxHeight:mt,minDeviceHeight:mt,maxDeviceHeight:mt,minWidth:mt,maxWidth:mt,minDeviceWidth:mt,maxDeviceWidth:mt,minColor:dt.number,maxColor:dt.number,minColorIndex:dt.number,maxColorIndex:dt.number,minMonochrome:dt.number,maxMonochrome:dt.number,minResolution:mt,maxResolution:mt},xt);var yt={all:s(s({},pt),gt)};const ft=e=>{const t=[];return Object.keys(yt.all).forEach(r=>{const n=e[r];null!=n&&t.push(((e,t)=>{const r=et(e);return"number"==typeof t&&(t=`${t}px`),!0===t?r:!1===t?`not ${r}`:`(${r}: ${t})`})(r,n))}),t.join(" and ")},jt=y.createContext(void 0),bt=e=>{if(!e)return;return Object.keys(e).reduce((t,r)=>(t[et(r)]=e[r],t),{})},vt=()=>{const e=y.useRef(!1);return y.useEffect(()=>{e.current=!0},[]),e.current},wt=e=>{const t=y.useContext(jt),r=()=>bt(e)||bt(t),[n,a]=y.useState(r);return y.useEffect(()=>{const e=r();(function(e,t){if(e===t)return!0;if(!e||!t)return!1;const r=Object.keys(e),n=Object.keys(t),a=r.length;if(n.length!==a)return!1;for(let i=0;i<a;i++){const n=r[i];if(e[n]!==t[n]||!Object.prototype.hasOwnProperty.call(t,n))return!1}return!0})(n,e)||a(e)},[e,t]),n},St=e=>{const t=()=>(e=>e.query||ft(e))(e),[r,n]=y.useState(t);return y.useEffect(()=>{const e=t();r!==e&&n(e)},[e]),r},kt=(e,t,r)=>{const n=wt(t),a=St(e);if(!a)throw new Error("Invalid or missing MediaQuery!");const i=((e,t)=>{const r=()=>Ke(e,t||{},!!t),[n,a]=y.useState(r),i=vt();return y.useEffect(()=>{if(i){const e=r();return a(e),()=>{e&&e.dispose()}}},[e,t]),n})(a,n),o=(e=>{const[t,r]=y.useState(e.matches);return y.useEffect(()=>{const t=e=>{r(e.matches)};return e.addListener(t),r(e.matches),()=>{e.removeListener(t)}},[e]),t})(i);return vt(),y.useEffect(()=>{},[o]),y.useEffect(()=>()=>{i&&i.dispose()},[]),o};function _t({projectName:e="",userName:t="",onUserClick:r=()=>{},onHomeClick:n=()=>{},customSideMenu:a=null,noShadow:i=!1,id:o=""}){const[s,l]=h.useState(!1),c=me();kt({maxWidth:767});const m=[{key:"profile",icon:we.jsx(k,{}),label:"è¨­å®šä½¿ç”¨è€…è³‡æ–™",onClick:r},{key:"logout",icon:we.jsx(_,{}),label:"ç™»å‡º",className:"logout-item",onClick:()=>d(null,null,function*(){yield Oe.logout(),c(Ne)}),style:{background:"var(--danger-gradient)",color:"white",borderRadius:"8px",margin:"4px 0",fontWeight:600}}],p=a||we.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[we.jsx(g,{className:"sidebar-menu-item",type:"text",icon:we.jsx(C,{}),onClick:()=>{l(!1),c("/home")},children:"ä¸»ç•«é¢"}),we.jsx("div",{style:{height:16}}),we.jsx(g,{className:"sidebar-menu-item",type:"text",icon:we.jsx(I,{}),onClick:()=>{l(!1),c(`/project/${o}`)},children:"æœ¬æ¬¡å­£ä¿é¤Šè¡¨å–®"}),we.jsx(g,{className:"sidebar-menu-item",type:"text",icon:we.jsx(N,{}),onClick:()=>{l(!1),c(`/project/${o}/addmaintainancedata`)},children:"æ–°å¢å­£ä¿é¤Šè³‡æ–™"}),we.jsx(g,{className:"sidebar-menu-item",type:"text",icon:we.jsx(z,{}),onClick:()=>{l(!1),c(`/project/${o}/viewmaintainancedata`)},children:"æŸ¥çœ‹å­£ä¿é¤Šè³‡æ–™"}),we.jsx(g,{className:"sidebar-menu-item",type:"text",icon:we.jsx(R,{}),onClick:()=>{l(!1),c(`/project/${o}/export-excel`)},children:"ExcelåŒ¯å‡º"}),we.jsx("div",{className:"sidebar-divider"}),we.jsx(g,{className:"sidebar-menu-item",type:"text",icon:we.jsx(k,{}),onClick:()=>{l(!1),c(`/project/${o}/season-setting`)},children:"æœ¬æ¬¡å­£ä¿é¤Šè¨­å®š"}),we.jsx(g,{className:"sidebar-menu-item",type:"text",icon:we.jsx($,{}),onClick:()=>{l(!1),c(`/project/${o}/maintain-setting`)},children:"ä¿é¤Šè³‡è¨Šè¨­å®š"}),we.jsx("div",{className:"sidebar-divider"}),we.jsx(g,{className:"sidebar-menu-item delete-all-data-btn",type:"text",icon:we.jsx(W,{}),onClick:()=>{T.confirm({title:"ç¢ºèªåˆªé™¤æ‰€æœ‰å­£ä¿é¤Šè³‡æ–™",icon:we.jsx(W,{}),content:"æ‚¨ç¢ºå®šè¦åˆªé™¤æ‰€æœ‰å­£ä¿é¤Šè³‡æ–™å—ï¼Ÿé€™å°‡æ°¸ä¹…åˆªé™¤ä»¥ä¸‹è³‡æ–™ï¼š\nâ€¢ maintainance_photo è¡¨ä¸­çš„æ‰€æœ‰ç…§ç‰‡è¨˜éŒ„\nâ€¢ maintainance_setting è¡¨ä¸­çš„æ‰€æœ‰è¨­å®šè³‡æ–™\nâ€¢ ç›¸é—œçš„ç…§ç‰‡æ–‡ä»¶\n\næ­¤æ“ä½œç„¡æ³•å¾©åŸï¼",okText:"ç¢ºèªåˆªé™¤",okType:"danger",cancelText:"å–æ¶ˆ",className:"modern-modal",onOk:()=>d(null,null,function*(){try{const{data:t,error:r}=yield qe.maintenancePhoto.getByProject(e);if(r)throw r;for(const e of t)e.photo_path&&(yield qe.storage.deleteImage("maintainance-data-photo",e.photo_path)),yield qe.maintenancePhoto.delete(e.id);const{error:n}=yield Ae.from("maintainance_setting").delete().eq("name",e);if(n)throw n;E.success({content:"åˆªé™¤æˆåŠŸï¼æ‰€æœ‰å­£ä¿é¤Šè³‡æ–™ï¼ˆç…§ç‰‡å’Œè¨­å®šï¼‰å·²æˆåŠŸåˆªé™¤",duration:3}),l(!1),setTimeout(()=>{c(0)},1e3)}catch(t){E.error({content:`åˆªé™¤å¤±æ•—: ${t.message||"æœªçŸ¥éŒ¯èª¤"}`,duration:3})}}),onCancel(){}})},style:{background:"var(--danger-gradient)",color:"white",borderRadius:"8px",margin:"4px 0",fontWeight:600,boxShadow:"var(--shadow-danger)",border:"1px solid var(--border-danger)",transition:"var(--transition-smooth)"},children:"åˆªé™¤æ‰€æœ‰å­£ä¿é¤Šè³‡æ–™"}),we.jsx("div",{style:{flex:1}}),we.jsx("div",{style:{textAlign:"center",marginTop:24},children:we.jsx(g,{className:"sidebar-menu-item",type:"text",icon:we.jsx(w,{}),onClick:r,children:t||"ç”¨æˆ¶"})})]});return we.jsxs(we.Fragment,{children:[we.jsx(j.Header,{className:"unified-topbar modern-topbar",children:we.jsxs("div",{className:"topbar-container",style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",height:"100%",padding:"0 24px",position:"relative"},children:[we.jsx("div",{className:"topbar-left",style:{display:"flex",alignItems:"center",gap:"16px",minWidth:"120px"},children:we.jsx(g,{className:"menu-trigger-btn interactive-click",type:"text",icon:we.jsx(b,{}),onClick:()=>l(!0),style:{color:"var(--text-primary)",fontSize:"18px",width:"44px",height:"44px",borderRadius:"var(--radius-md)",background:"var(--bg-tertiary)",border:"1px solid var(--border-primary)",transition:"var(--transition-smooth)",display:"flex",alignItems:"center",justifyContent:"center"}})}),we.jsx("div",{className:"topbar-center",style:{flex:1,display:"flex",justifyContent:"center",alignItems:"center"},children:we.jsx(x.Title,{className:"unified-topbar-title gradient-text animate-fadeInDown",level:4,style:{margin:0,fontSize:"24px",fontWeight:700,background:"var(--primary-gradient)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",textAlign:"center",cursor:"pointer",transition:"var(--transition-smooth)"},onClick:()=>c(Ie),children:e||"å­£ä¿é¤Šç®¡ç†ç³»çµ±"})}),we.jsxs("div",{className:"topbar-right",style:{display:"flex",alignItems:"center",gap:"12px",minWidth:"120px",justifyContent:"flex-end"},children:[we.jsxs("div",{className:"user-info",style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 12px",background:"transparent",borderRadius:"var(--radius-md)",border:"none",transition:"var(--transition-smooth)"},children:[we.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"14px",fontWeight:500},children:"ğŸ‘‹"}),we.jsx("span",{style:{color:"var(--text-primary)",fontSize:"14px",fontWeight:600,maxWidth:"80px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t||"ç”¨æˆ¶"})]}),we.jsx(v,{menu:{items:m},trigger:["click"],placement:"bottomRight",overlayClassName:"unified-dropdown",popupRender:e=>we.jsx("div",{className:"user-dropdown",children:e}),children:we.jsx(g,{className:"user-menu-trigger interactive-click neon-glow",type:"text",style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 12px",height:"44px",background:"var(--bg-tertiary)",border:"1px solid var(--border-primary)",borderRadius:"var(--radius-md)",color:"var(--text-primary)",transition:"var(--transition-bounce)"},children:we.jsx(w,{style:{fontSize:"16px"}})})})]})]})}),we.jsx(S,{title:"é¸å–®",className:"modern-sidebar",placement:"left",open:s,onClose:()=>{l(!1)},width:280,children:p})]})}const Ct=({children:e,projectName:t,userName:r,projectId:n,customSideMenu:a,noShadow:i=!1,background:o="var(--bg-primary)"})=>we.jsxs(we.Fragment,{children:[we.jsx("div",{className:"animated-bg"}),we.jsxs(j,{className:"page-enter",style:{minHeight:"100vh",background:o},children:[we.jsx(_t,{userName:r,projectName:t,id:n,customSideMenu:a,noShadow:i,onUserClick:()=>{},onHomeClick:()=>{}}),we.jsx(j.Content,{style:{padding:"32px 24px",minHeight:"calc(100vh - 70px)",background:"transparent",position:"relative",zIndex:1},children:we.jsx("div",{className:"animate-fadeInUp",children:e})})]})]}),It=({project:e,onClick:t,style:r={}})=>{return we.jsx(B,{className:"modern-card interactive-click glass-morphism",hoverable:!0,cover:e.photo_path?we.jsxs("div",{style:{position:"relative",overflow:"hidden",borderRadius:"16px 16px 0 0"},children:[we.jsx("img",{alt:"cover",src:(n=e.photo_path,qe.storage.getImageUrl("home-project-card-photo",n)),style:{height:160,width:"100%",objectFit:"cover",transition:"var(--transition-smooth)"}}),we.jsx("div",{className:"animate-shimmer",style:{position:"absolute",top:0,left:0,right:0,bottom:0,opacity:.3}}),1===e.id&&we.jsx("div",{style:{position:"absolute",top:8,left:8,background:"rgba(0, 0, 0, 0.7)",borderRadius:"50%",padding:"6px",display:"flex",alignItems:"center",justifyContent:"center"},children:we.jsx(F,{style:{color:"#ffd700",fontSize:"14px"}})})]}):we.jsxs("div",{style:{height:160,background:"var(--accent-gradient)",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"16px 16px 0 0",position:"relative"},children:[we.jsx(x.Title,{level:1,style:{color:"white",margin:0,textShadow:"0 2px 4px rgba(0,0,0,0.3)"},children:e.name.charAt(0)}),1===e.id&&we.jsx("div",{style:{position:"absolute",top:8,left:8,background:"rgba(0, 0, 0, 0.7)",borderRadius:"50%",padding:"6px",display:"flex",alignItems:"center",justifyContent:"center"},children:we.jsx(F,{style:{color:"#ffd700",fontSize:"14px"}})})]}),onClick:r=>{t(e)},style:s({minHeight:320,height:"auto",cursor:"pointer",transition:"var(--transition-bounce)"},r),styles:{body:{padding:"20px",background:"transparent"}},children:we.jsx(B.Meta,{title:we.jsx(x.Title,{level:5,className:"gradient-text",style:{margin:0,fontSize:"1.2rem",fontWeight:600,marginBottom:"12px",whiteSpace:"normal",wordWrap:"break-word",lineHeight:1.3},children:e.name}),description:we.jsxs("div",{style:{animation:"fadeInUp 0.6s ease-out 0.2s both"},children:[we.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:14,marginBottom:8,fontWeight:500},children:["ğŸ¢ æª¢æŸ¥å–®ä½ï¼š",e.unit]}),we.jsxs("div",{style:{color:"var(--text-muted)",fontSize:14,lineHeight:1.5,display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden"},children:["ğŸ“‹ æª¢æŸ¥èªªæ˜ï¼š",e.directions]})]})})});var n},Nt={createTemplateFromProject1(){return d(this,null,function*(){try{const{data:e,error:t}=yield qe.projects.getById(1);if(t)throw t;if(!e)throw new Error("æ‰¾ä¸åˆ°å°ˆæ¡ˆ1çš„è³‡æ–™");const{data:r,error:n}=yield Ae.from("maintainance_setting").select("*").eq("name",e.name);if(n)throw n;const{data:a,error:i}=yield qe.maintenanceData.getByProject(e.name);if(i)throw i;const{data:o,error:s}=yield qe.maintenancePhoto.getByProject(e.name);if(s)throw s;return{template:{projectData:{name:e.name,unit:e.unit,directions:e.directions,photo_path:e.photo_path},maintenanceSettings:r||[],maintenanceData:a||[],maintenancePhotos:o||[]},error:null}}catch(e){return{template:null,error:e}}})},createProjectFromTemplate(e="æ–°å°ˆæ¡ˆ"){return d(this,null,function*(){try{const{template:r,error:n}=yield this.createTemplateFromProject1();if(n)throw n;const a=e,{data:i,error:o}=yield Ae.from("home_project_card").select("name").eq("name",a);if(o)throw o;if(i&&i.length>0)throw new Error(`å°ˆæ¡ˆåç¨± "${a}" å·²å­˜åœ¨ï¼Œè«‹ä½¿ç”¨ä¸åŒçš„åç¨±`);let c=null;if(r.projectData.photo_path)try{const{data:t,error:n}=yield Ae.storage.from("home-project-card-photo").download(r.projectData.photo_path);if(!n&&t){const n=r.projectData.photo_path.split(".").pop(),a=(new Date).getTime();c=`${e}_${a}.${n}`;const{error:i}=yield Ae.storage.from("home-project-card-photo").upload(c,t);i&&(c=null)}}catch(t){c=null}const d=(r.projectData.unit||"é è¨­å–®ä½").replace(/_\d+_[a-z0-9]+$/i,""),m=(r.projectData.directions||"é è¨­èªªæ˜").replace(/_\d+_[a-z0-9]+$/i,""),p={name:a,unit:d,directions:m,photo_path:c},{data:u,error:h}=yield qe.projects.create(p);if(h)throw h;if(r.maintenanceSettings&&r.maintenanceSettings.length>0){const e=r.maintenanceSettings.map(e=>l(s({},e),{id:void 0,name:a})),{error:t}=yield Ae.from("maintainance_setting").insert(e)}if(r.maintenanceData&&r.maintenanceData.length>0){const e=r.maintenanceData.map(e=>l(s({},e),{id:void 0,project:a})),{error:t}=yield Ae.from("maintainance_data").insert(e)}if(r.maintenancePhotos&&r.maintenancePhotos.length>0){const e=r.maintenancePhotos.map(e=>({project:a,project_name:a,floor:e.floor,thing:e.thing,location:e.location,maintainance_time:e.maintainance_time,maintainance_user:e.maintainance_user,photo_path:null,photo_name:null,created_at:(new Date).toISOString()})),{error:t}=yield Ae.from("maintainance_photo").insert(e)}return{project:(null==u?void 0:u[0])||u,error:null,message:`æˆåŠŸå‰µå»ºæ–°å°ˆæ¡ˆ: ${a}`}}catch(r){return{project:null,error:r,message:`å‰µå»ºå°ˆæ¡ˆå¤±æ•—: ${r.message}`}}})},getTemplatePreview(){return d(this,null,function*(){var e,t,r;try{const{template:n,error:a}=yield this.createTemplateFromProject1();if(a)throw a;return{preview:{name:n.projectData.name,unit:n.projectData.unit,directions:n.projectData.directions,settingsCount:(null==(e=n.maintenanceSettings)?void 0:e.length)||0,dataCount:(null==(t=n.maintenanceData)?void 0:t.length)||0,photoCount:(null==(r=n.maintenancePhotos)?void 0:r.length)||0,hasPhoto:!!n.projectData.photo_path},error:null}}catch(n){return{preview:null,error:n}}})}},{Title:zt,Text:Rt}=x,$t=({visible:e,onClose:t,onSuccess:r})=>{const{message:n}=P.useApp(),[a,i]=y.useState(!1),[o,s]=y.useState(null),[l,c]=y.useState(""),[m,p]=y.useState(!0);y.useEffect(()=>{e&&(u(),c("æ–°çš„å­£ä¿é¤Šå°ˆæ¡ˆ"))},[e]);const u=()=>d(null,null,function*(){p(!0);try{const{preview:e,error:t}=yield Nt.getTemplatePreview();if(t)throw t;s(e)}catch(e){}finally{p(!1)}}),h=()=>{a||(c(""),s(null),t())};return we.jsx(T,{open:e,onCancel:h,footer:null,width:600,className:"modern-modal",title:we.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[we.jsx(D,{style:{color:"var(--text-accent)",fontSize:"20px"}}),we.jsx("span",{children:"å‰µå»ºæ–°å°ˆæ¡ˆ"})]}),children:we.jsxs("div",{style:{padding:"20px 0"},children:[we.jsxs("div",{style:{background:"var(--bg-tertiary)",border:"1px solid var(--border-primary)",borderRadius:"12px",padding:"20px",marginBottom:"24px"},children:[we.jsxs(zt,{level:4,style:{color:"var(--text-primary)",marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[we.jsx(U,{style:{color:"var(--text-accent)"}}),"ç¯„æœ¬é è¦½"]}),m?we.jsxs("div",{style:{textAlign:"center",padding:"20px"},children:[we.jsx(f,{size:"large"}),we.jsx(Rt,{style:{display:"block",marginTop:"12px",color:"var(--text-secondary)"},children:"è¼‰å…¥ç¯„æœ¬è³‡è¨Šä¸­..."})]}):o?we.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[we.jsxs("div",{children:[we.jsx(Rt,{strong:!0,style:{color:"var(--text-primary)"},children:"ç¯„æœ¬ä¾†æºï¼š"}),we.jsx("br",{}),we.jsx(Rt,{style:{color:"var(--text-secondary)"},children:o.name})]}),we.jsxs("div",{children:[we.jsx(Rt,{strong:!0,style:{color:"var(--text-primary)"},children:"å–®ä½ï¼š"}),we.jsx("br",{}),we.jsx(Rt,{style:{color:"var(--text-secondary)"},children:o.unit})]}),we.jsxs("div",{children:[we.jsx(Rt,{strong:!0,style:{color:"var(--text-primary)"},children:"ä¿é¤Šè¨­å®šé …ç›®ï¼š"}),we.jsx("br",{}),we.jsxs(Rt,{style:{color:"var(--text-secondary)"},children:[o.settingsCount," é …"]})]}),we.jsxs("div",{children:[we.jsx(Rt,{strong:!0,style:{color:"var(--text-primary)"},children:"ä¿é¤Šè³‡æ–™é …ç›®ï¼š"}),we.jsx("br",{}),we.jsxs(Rt,{style:{color:"var(--text-secondary)"},children:[o.dataCount," é …"]})]}),we.jsxs("div",{children:[we.jsx(Rt,{strong:!0,style:{color:"var(--text-primary)"},children:"ä¿é¤Šç…§ç‰‡çµæ§‹ï¼š"}),we.jsx("br",{}),we.jsxs(Rt,{style:{color:"var(--text-secondary)"},children:[o.photoCount," é …"]})]}),we.jsxs("div",{children:[we.jsx(Rt,{strong:!0,style:{color:"var(--text-primary)"},children:"å°ˆæ¡ˆå°é¢ï¼š"}),we.jsx("br",{}),we.jsx(Rt,{style:{color:"var(--text-secondary)"},children:o.hasPhoto?"âœ“ åŒ…å«":"âœ— ç„¡ç…§ç‰‡"})]})]}):we.jsx(A,{message:"ç„¡æ³•è¼‰å…¥ç¯„æœ¬é è¦½",description:"è«‹ç¨å¾Œå†è©¦æˆ–è¯ç¹«ç®¡ç†å“¡",type:"warning",showIcon:!0})]}),we.jsxs("div",{style:{marginBottom:"24px"},children:[we.jsx(zt,{level:5,style:{color:"var(--text-primary)",marginBottom:"12px"},children:"æ–°å°ˆæ¡ˆåç¨±"}),we.jsx(O,{value:l,onChange:e=>c(e.target.value),placeholder:"è«‹è¼¸å…¥æ–°å°ˆæ¡ˆçš„åç¨±",size:"large",style:{background:"var(--bg-tertiary)",border:"1px solid var(--border-primary)",borderRadius:"8px",color:"var(--text-primary)"},disabled:a}),we.jsx(Rt,{style:{color:"var(--text-muted)",fontSize:"12px",display:"block",marginTop:"8px"},children:"è«‹ç¢ºä¿å°ˆæ¡ˆåç¨±çš„å”¯ä¸€æ€§ï¼Œé¿å…èˆ‡ç¾æœ‰å°ˆæ¡ˆé‡è¤‡"})]}),we.jsx(A,{message:"ç¯„æœ¬èªªæ˜",description:we.jsxs("div",{children:[we.jsx("p",{children:"æ­¤åŠŸèƒ½æœƒè¤‡è£½å°ˆæ¡ˆ1çš„æ‰€æœ‰è¨­å®šï¼Œå‰µå»ºä¸€å€‹å…¨æ–°çš„ç¨ç«‹å°ˆæ¡ˆï¼ŒåŒ…æ‹¬ï¼š"}),we.jsxs("ul",{style:{margin:"8px 0",paddingLeft:"20px"},children:[we.jsx("li",{children:"å°ˆæ¡ˆåŸºæœ¬è³‡è¨Šï¼ˆhome_project_cardï¼‰"}),we.jsx("li",{children:"ä¿é¤Šè¨­å®šè³‡æ–™ï¼ˆmaintainance_settingï¼‰"}),we.jsx("li",{children:"ä¿é¤Šé …ç›®è³‡æ–™ï¼ˆmaintainance_dataï¼‰"}),we.jsx("li",{children:"ä¿é¤Šç…§ç‰‡çµæ§‹ï¼ˆmaintainance_photoï¼Œä¸å«å¯¦éš›ç…§ç‰‡æ–‡ä»¶ï¼‰"}),we.jsx("li",{children:"å°ˆæ¡ˆå°é¢ç…§ç‰‡ï¼ˆå¦‚æœå­˜åœ¨ï¼‰"})]}),we.jsx("p",{style:{margin:"8px 0 0 0",fontSize:"12px",color:"var(--text-muted)"},children:"æ³¨æ„ï¼šä¿é¤Šç…§ç‰‡çš„è³‡æ–™çµæ§‹æœƒè¢«è¤‡è£½ï¼Œä½†å¯¦éš›ç…§ç‰‡æ–‡ä»¶éœ€è¦é‡æ–°ä¸Šå‚³ã€‚æ–°å°ˆæ¡ˆä¸æœƒåŒ…å«ä»»ä½•å¯†ç¢¼ä¿è­·åŠŸèƒ½ã€‚"})]}),type:"info",showIcon:!0,style:{marginBottom:"24px"}}),we.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px",paddingTop:"16px",borderTop:"1px solid var(--border-primary)"},children:[we.jsx(g,{onClick:h,disabled:a,style:{background:"var(--bg-tertiary)",border:"1px solid var(--border-primary)",color:"var(--text-primary)",borderRadius:"8px",height:"40px",padding:"0 20px"},children:"å–æ¶ˆ"}),we.jsx(g,{type:"primary",icon:we.jsx(N,{}),onClick:()=>d(null,null,function*(){if(l.trim()){i(!0);try{const{project:e,error:n,message:a}=yield Nt.createProjectFromTemplate(l.trim());if(n)throw n;T.success({title:"å°ˆæ¡ˆå‰µå»ºæˆåŠŸ",content:a,className:"custom-success-modal",onOk:()=>{null==r||r(e),t()}})}catch(e){T.error({title:"å‰µå»ºå¤±æ•—",content:`å‰µå»ºå°ˆæ¡ˆæ™‚ç™¼ç”ŸéŒ¯èª¤: ${e.message}`,className:"modern-modal"})}finally{i(!1)}}else n.error({content:"è¼¸å…¥éŒ¯èª¤ï¼šè«‹è¼¸å…¥å°ˆæ¡ˆåç¨±",duration:3})}),loading:a,disabled:!l.trim()||m,style:{background:"var(--primary-gradient)",border:"none",borderRadius:"8px",height:"40px",padding:"0 24px",fontWeight:"600"},children:a?"å‰µå»ºä¸­...":"å‰µå»ºå°ˆæ¡ˆ"})]})]})})},Wt=e=>{const[t,r]=y.useState(null),[n,a]=y.useState(!0),[i,o]=y.useState(null),s=y.useCallback(()=>d(null,null,function*(){if(e){a(!0),o(null);try{const{data:t,error:n}=yield qe.projects.getById(e);n?(o(n),r(null)):r(t)}catch(t){o(t),r(null)}finally{a(!1)}}else a(!1)}),[e]);y.useEffect(()=>{s()},[s]);return y.useMemo(()=>({project:t,loading:n,error:i}),[t,n,i])};function Tt(){const e=me(),{userName:t}=De(),{projects:r,loading:n}=(()=>{const[e,t]=y.useState([]),[r,n]=y.useState(!0),[a,i]=y.useState(null),o=y.useCallback(()=>d(null,null,function*(){n(!0),i(null);try{const{data:e,error:r}=yield qe.projects.getAll();r?(i(r),t([])):t(e||[])}catch(e){i(e),t([])}finally{n(!1)}}),[]);return y.useEffect(()=>{o()},[o]),y.useMemo(()=>({projects:e,loading:r,error:a,fetchProjects:o}),[e,r,a,o])})(),[a,i]=y.useState(!1),[o,s]=y.useState(!1),[l,c]=y.useState(""),[m,p]=y.useState(null),u=t=>{t&&t.id?1===t.id?(p(t),s(!0),c("")):e(`/project/${t.id}`):E.error("å°ˆæ¡ˆè³‡æ–™ç•°å¸¸ï¼Œç„¡æ³•è·³è½‰")},h=()=>{"ACLacl@"===l?(s(!1),c(""),e(`/project/${m.id}`),p(null),E.success("å¯†ç¢¼æ­£ç¢ºï¼Œæ­£åœ¨é€²å…¥å°ˆæ¡ˆ...")):(E.error("å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥"),c(""))};if(n)return we.jsx(Me,{});const f=we.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[we.jsx("div",{className:"sidebar-title",children:Ce}),we.jsx(g,{className:"sidebar-menu-item",type:"text",icon:we.jsx(N,{}),onClick:()=>i(!0),style:{background:"var(--primary-gradient)",color:"white",borderRadius:"8px",margin:"4px 0",fontWeight:600,boxShadow:"var(--shadow-primary)",border:"1px solid var(--border-primary)",transition:"var(--transition-smooth)"},children:"æ–°å¢æ¡ˆå ´"}),we.jsx(g,{className:"sidebar-menu-item",type:"text",icon:we.jsx(k,{}),onClick:()=>E.info("å°šæœªå¯¦ä½œæ‡‰ç”¨ç¨‹å¼è¨­å®š"),children:"æ‡‰ç”¨ç¨‹å¼è¨­å®š"}),we.jsx("div",{style:{flex:1}}),we.jsx("div",{style:{textAlign:"center",marginTop:24},children:we.jsx(g,{className:"sidebar-menu-item",type:"text",icon:we.jsx(w,{}),onClick:()=>E.info("å°šæœªå¯¦ä½œç”¨æˆ¶é é¢"),children:t||"ç”¨æˆ¶"})})]});return we.jsxs(Ct,{userName:t,projectName:_e,customSideMenu:f,children:[we.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto",padding:"20px"},children:[we.jsx("div",{className:"animate-fadeInUp",style:{marginBottom:"32px"},children:we.jsx(x.Title,{level:2,className:"gradient-text",style:{textAlign:"center",marginBottom:"8px",fontSize:"2.5rem",fontWeight:700},children:"å­£ä¿é¤Šç®¡ç†ç³»çµ±"})}),we.jsx(M,{gutter:[24,24],children:r.map((e,t)=>we.jsx(L,{xs:24,sm:12,md:8,lg:6,children:we.jsx("div",{className:"animate-scaleIn interactive-hover",style:{animationDelay:.1*t+"s",animationFillMode:"both"},children:we.jsx(It,{project:e,onClick:u})})},e.id))}),0===r.length&&we.jsxs("div",{className:"animate-fadeInUp",style:{textAlign:"center",padding:"80px 20px",color:"var(--text-muted)"},children:[we.jsx(x.Title,{level:3,style:{color:"var(--text-muted)"},children:"æš«ç„¡å°ˆæ¡ˆè³‡æ–™"}),we.jsx(x.Text,{children:"è«‹è¯ç¹«ç®¡ç†å“¡æ–°å¢å°ˆæ¡ˆ"})]})]}),we.jsx($t,{visible:a,onClose:()=>i(!1),onSuccess:e=>{i(!1),window.location.reload()}}),we.jsx(T,{title:we.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[we.jsx(F,{style:{color:"var(--text-accent)"}}),we.jsx("span",{children:"å°ˆæ¡ˆå¯†ç¢¼é©—è­‰"})]}),open:o,onOk:h,onCancel:()=>{s(!1),c(""),p(null)},okText:"ç¢ºèª",cancelText:"å–æ¶ˆ",className:"modern-modal",maskClosable:!1,okButtonProps:{disabled:!l.trim(),style:{background:"var(--primary-gradient)",border:"none",borderRadius:"8px"}},cancelButtonProps:{style:{background:"var(--bg-tertiary)",border:"1px solid var(--border-primary)",color:"var(--text-primary)",borderRadius:"8px"}},children:we.jsxs("div",{style:{padding:"20px 0"},children:[we.jsx(x.Text,{style:{color:"var(--text-secondary)",marginBottom:"16px",display:"block"},children:"æ­¤å°ˆæ¡ˆéœ€è¦å¯†ç¢¼æ‰èƒ½è¨ªå•ï¼Œè«‹è¼¸å…¥æ­£ç¢ºçš„å¯†ç¢¼ï¼š"}),we.jsx(O.Password,{value:l,onChange:e=>c(e.target.value),placeholder:"è«‹è¼¸å…¥å°ˆæ¡ˆå¯†ç¢¼",size:"large",prefix:we.jsx(F,{style:{color:"var(--text-muted)"}}),onPressEnter:h,style:{background:"var(--bg-tertiary)",border:"1px solid var(--border-primary)",borderRadius:"8px",color:"var(--text-primary)"},autoFocus:!0}),we.jsxs(x.Text,{style:{color:"var(--text-muted)",fontSize:"12px",marginTop:"8px",display:"block"},children:["å°ˆæ¡ˆåç¨±ï¼š",null==m?void 0:m.name]})]})})]})}const Et=({message:e="ç™¼ç”ŸéŒ¯èª¤",showBackButton:t=!0,onBack:r,backText:n="å›ä¸»ç•«é¢"})=>we.jsxs("div",{className:"glass-morphism animate-fadeInUp",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",padding:"40px",textAlign:"center",color:"var(--text-primary)",margin:"20px",maxWidth:"500px",marginLeft:"auto",marginRight:"auto"},children:[we.jsx("div",{className:"animate-bounce",style:{marginBottom:"24px"},children:we.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:"var(--danger-gradient)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"2rem",color:"white",boxShadow:"var(--shadow-danger)",animation:"pulse 2s ease-in-out infinite"},children:"âš ï¸"})}),we.jsx(x.Title,{level:4,className:"gradient-text",style:{marginBottom:16,fontSize:"1.5rem"},children:e}),t&&we.jsxs(g,{type:"primary",onClick:()=>{r?r():window.location.href="/home"},size:"large",className:"interactive-click",style:{height:"48px",fontSize:"16px",fontWeight:600,borderRadius:"12px",background:"var(--primary-gradient)",border:"none",boxShadow:"var(--shadow-glow)",padding:"0 32px"},children:["ğŸ  ",n]})]}),Bt=({visible:e,onClose:t,success:r=!0,title:n="",message:a=""})=>{const i=r?"å„²å­˜æˆåŠŸ":"å„²å­˜å¤±æ•—",o=r?"è³‡æ–™å·²æˆåŠŸå„²å­˜ï¼":"å„²å­˜éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";return we.jsx(T,{open:e,onCancel:t,footer:null,centered:!0,closable:!1,width:400,className:"save-result-modal",children:we.jsxs("div",{style:{textAlign:"center",padding:"20px 0"},children:[we.jsx("div",{className:"animate-scaleIn",style:{marginBottom:"20px"},children:r?we.jsx(q,{style:{fontSize:"64px",color:"var(--text-success)",animation:"successPulse 0.6s ease-out"}}):we.jsx(Y,{style:{fontSize:"64px",color:"var(--text-danger)",animation:"errorShake 0.6s ease-out"}})}),we.jsx("h2",{style:{color:"var(--text-primary)",marginBottom:"12px",fontSize:"24px",fontWeight:600},children:n||i}),we.jsx("p",{style:{color:"var(--text-secondary)",marginBottom:"24px",fontSize:"16px",lineHeight:1.5},children:a||o}),we.jsx(g,{type:"primary",size:"large",onClick:t,className:"interactive-click",style:{height:"48px",fontSize:"16px",fontWeight:600,borderRadius:"12px",background:r?"var(--success-gradient)":"var(--primary-gradient)",border:"none",boxShadow:r?"var(--shadow-success)":"var(--shadow-glow)",padding:"0 32px"},children:"ç¢ºå®š"})]})})};function Ft(){const{id:e}=pe(),t=me(),{userName:r}=De(),{project:n,loading:a,error:i}=Wt(e),[o]=H.useForm(),[s,l]=y.useState(!1),[c,m]=y.useState([]),[p,u]=y.useState([]),[h,x]=y.useState([]),[f,j]=y.useState([]),[b,v]=y.useState([]),[w,S]=y.useState(null),[_,C]=y.useState(""),[I,N]=y.useState(!0),[z,R]=y.useState(!1),[$,W]=y.useState(!1),[T,F]=y.useState(!1),[P,U]=y.useState(!0),[O,D]=y.useState("");y.useEffect(()=>{n&&(M(),L(),q(),o.setFieldsValue({maintainance_time:V().format("YYYY-MM-DD"),maintainance_user:r}))},[n,r,o]),y.useEffect(()=>()=>{_&&URL.revokeObjectURL(_)},[_]),y.useEffect(()=>{w&&I&&ee()},[I]);const M=()=>d(null,null,function*(){try{const{data:e,error:t}=yield qe.maintenanceSettings.getByProject(n.name);if(t&&"PGRST116"!==t.code)return;const r=V();if(e){if(e.time_start&&e.time_finish){const t=V(e.time_start),n=V(e.time_finish);(r.isBefore(t)||r.isAfter(n))&&(R(!0),W(!0))}}else R(!0),W(!0)}catch(e){}}),L=()=>d(null,null,function*(){try{const{data:e,error:t}=yield qe.maintenanceData.getOptions(n.name);if(t)throw t;m(e)}catch(e){}}),q=()=>d(null,null,function*(){try{const{data:e,error:t}=yield qe.maintenancePhoto.getByProject(n.name);if(t)throw t;const r=new Set(e.map(e=>`${e.floor}_${e.thing}_${e.location}`));j(Array.from(r))}catch(e){}}),Y=y.useCallback(()=>{const e=o.getFieldValue("floor"),t=o.getFieldValue("thing"),r=new Set(f);let n=[];e&&t?(n=c.filter(r=>r.floor===e&&r.thing===t).map(e=>e.location).filter(Boolean).filter(n=>{const a=`${e}_${t}_${n}`;return!r.has(a)}),x([...new Set(n)])):x([]);let a=[];if(e){const t=c.filter(t=>t.floor===e).map(e=>e.thing).filter(Boolean);a=[...new Set(t.filter(t=>c.filter(r=>r.floor===e&&r.thing===t).some(n=>{const a=`${e}_${t}_${n.location}`;return!r.has(a)})))],u(a)}else u([]);const i=new Set;c.forEach(e=>{const t=e.floor;if(!t)return;c.filter(e=>e.floor===t).map(e=>e.thing).filter(Boolean).some(e=>c.filter(r=>r.floor===t&&r.thing===e).some(n=>{const a=`${t}_${e}_${n.location}`;return!r.has(a)}))&&i.add(t)}),v(Array.from(i))},[c,o,f]);y.useEffect(()=>{n&&(c.length>0||f.length>0||0===c.length&&0===f.length)&&Y()},[c,f,Y,n]);const X=e=>d(null,null,function*(){if(!I)return URL.createObjectURL(e);try{const t=o.getFieldsValue(),r=yield re(e,t);return URL.createObjectURL(r)}catch(t){return URL.createObjectURL(e)}}),Z=e=>d(null,null,function*(){const t=e.target.files[0];if(t)if(t.type.startsWith("image/")){S(t);const e=yield X(t);C(e)}else E.error("è«‹é¸æ“‡åœ–ç‰‡æª”æ¡ˆ")}),ee=()=>d(null,null,function*(){if(w){_&&URL.revokeObjectURL(_);const e=yield X(w);C(e)}}),te=()=>{_&&URL.revokeObjectURL(_),S(null),C("")},re=(e,t)=>d(null,null,function*(){return new Promise((r,a)=>{const i=document.createElement("canvas"),o=i.getContext("2d"),s=new Image;s.onload=()=>{try{i.width=s.width,i.height=s.height,o.drawImage(s,0,0);const l=[`æ¡ˆå ´åç¨±: ${(null==n?void 0:n.name)||t.project||""}`,`æª¢æŸ¥é …ç›®: ${t.thing||""}`,`æª¢æŸ¥ä½ç½®: ${t.location||""}`,`æª¢æŸ¥æ—¥æœŸ: ${t.maintainance_time||V().format("YYYY/MM/DD")}`],c=1.25*Math.max(16,Math.min(s.width/40,24)),d=c+6,m=30;o.font=`${c}px Arial`;const p=Math.max(...l.map(e=>o.measureText(e).width))+2*m,u=l.length*d+2*m,h=i.width-p-20,x=i.height-u;o.fillStyle="rgba(128, 128, 128, 0.8)",o.fillRect(h,x,p,u),o.font=`${c}px Arial`,o.fillStyle="white",o.textAlign="left",o.textBaseline="top",l.forEach((e,t)=>{const r=h+m,n=x+m+t*d;o.fillText(e,r,n)}),i.toBlob(t=>{if(t){const n=new File([t],e.name,{type:e.type});r(n)}else a(new Error("ç„¡æ³•å‰µå»ºæµ®æ°´å°åœ–ç‰‡"))},e.type,.9)}catch(l){a(l)}},s.onerror=()=>a(new Error("åœ–ç‰‡è¼‰å…¥å¤±æ•—")),s.src=URL.createObjectURL(e)})});return a?we.jsx(Me,{}):i||!n?we.jsx(Et,{message:"æ‰¾ä¸åˆ°å°ˆæ¡ˆè³‡æ–™",onBack:()=>t(Ie)}):we.jsx(Ct,{userName:r,projectName:n.name,projectId:e,children:we.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto",padding:"20px"},children:[z&&we.jsx(A,{message:"ä¿é¤Šè¨­å®šæé†’",description:"æ­¤å°ˆæ¡ˆå°šæœªè¨­å®šä¿é¤ŠæœŸé–“æˆ–ç›®å‰ä¸åœ¨ä¿é¤ŠæœŸé–“å…§ï¼Œè«‹å…ˆé€²è¡Œè¨­å®šã€‚",type:"warning",showIcon:!0,icon:we.jsx(G,{}),style:{marginBottom:16},action:we.jsx(g,{size:"small",type:"primary",onClick:()=>t(`/project/${e}/season-setting`),children:"å‰å¾€è¨­å®š"})}),we.jsx(B,{className:"modern-card glass-morphism animate-fadeInUp",title:we.jsxs("div",{style:{fontSize:"1.8rem",fontWeight:700,display:"flex",alignItems:"center",gap:"12px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",textShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[we.jsx("span",{style:{fontSize:"2rem",filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.2))"},children:"ğŸ”§"}),"å­£ä¿é¤Šä½œæ¥­ç³»çµ±"]}),style:{marginBottom:32,background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"16px",boxShadow:"0 8px 32px rgba(0,0,0,0.1)"},children:we.jsxs(H,{form:o,layout:"vertical",onFinish:e=>d(null,null,function*(){if(w){l(!0);try{let t=w;I&&(t=yield re(w,e));const a=t.name.split(".").pop(),i=`${Date.now()}.${a}`,s=`${n.id}/${i}`,{data:l,error:c}=yield Ae.storage.from("maintainance-data-photo").upload(s,t);if(c)throw new Error(`ç…§ç‰‡ä¸Šå‚³å¤±æ•—: ${c.message}`);const{data:d,error:m}=yield Ae.from("maintainance_data").select("company, direction").eq("project",n.name).eq("floor",e.floor).eq("thing",e.thing).eq("location",e.location).single(),p={project:n.name,floor:e.floor,thing:e.thing,location:e.location,maintainance_user:e.maintainance_user,maintainance_time:e.maintainance_time,photo_path:s,direction:(null==d?void 0:d.direction)||"å­£ä¿é¤Šæª¢æŸ¥",company:(null==d?void 0:d.company)||"ç¶­è­·å…¬å¸"},{data:u,error:h}=yield Ae.from("maintainance_photo").insert(p);if(h)throw new Error(`è³‡æ–™åº«å„²å­˜å¤±æ•—: ${h.message}`);h?(U(!1),D((null==h?void 0:h.message)||"å„²å­˜å¤±æ•—ï¼Œè«‹é‡è©¦")):(U(!0),D("ä¿é¤Šè³‡æ–™å·²æˆåŠŸå„²å­˜ï¼"),o.resetFields(),o.setFieldsValue({maintainance_time:V().format("YYYY-MM-DD"),maintainance_user:r}),te(),yield q()),F(!0)}catch(t){U(!1),D(t.message||"å„²å­˜å¤±æ•—ï¼Œè«‹é‡è©¦"),F(!0)}finally{l(!1)}}else E.error("è«‹é¸æ“‡ä¸€å¼µç…§ç‰‡")}),onValuesChange:(e,t)=>{"floor"in e&&o.setFieldsValue({thing:void 0,location:void 0}),"thing"in e&&o.setFieldsValue({location:void 0}),Y(),w&&I&&setTimeout(()=>ee(),100)},disabled:$,className:"animate-slideInLeft",style:{maxWidth:"700px",margin:"0 auto",animationDelay:"0.2s",animationFillMode:"both",padding:"20px"},children:[we.jsx(H.Item,{label:we.jsxs("span",{style:{color:"var(--text-primary)",fontWeight:600,fontSize:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[we.jsx("span",{style:{fontSize:"20px"},children:"ğŸ¢"}),"æ¨“å±¤é¸æ“‡"]}),name:"floor",rules:[{required:!0,message:"è«‹é¸æ“‡æ¨“å±¤"}],children:we.jsx(K,{placeholder:"ğŸ” è«‹é¸æ“‡æ¨“å±¤",options:b.map(e=>({label:e,value:e})),style:{width:"100%",height:"48px"},className:"modern-select"})}),we.jsx(H.Item,{label:we.jsxs("span",{style:{color:"var(--text-primary)",fontWeight:600,fontSize:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[we.jsx("span",{style:{fontSize:"20px"},children:"ğŸ”"}),"æª¢æŸ¥é …ç›®"]}),name:"thing",rules:[{required:!0,message:"è«‹é¸æ“‡æª¢æŸ¥é …ç›®"}],children:we.jsx(K,{placeholder:"âš™ï¸ è«‹é¸æ“‡æª¢æŸ¥é …ç›®",options:p.map(e=>({label:e,value:e})),style:{width:"100%",height:"48px"},className:"modern-select"})}),we.jsx(H.Item,{label:we.jsxs("span",{style:{color:"var(--text-primary)",fontWeight:600,fontSize:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[we.jsx("span",{style:{fontSize:"20px"},children:"ğŸ“"}),"æª¢æŸ¥ä½ç½®"]}),name:"location",rules:[{required:!0,message:"è«‹é¸æ“‡æª¢æŸ¥ä½ç½®"}],children:we.jsx(K,{placeholder:"ğŸ¯ è«‹é¸æ“‡æª¢æŸ¥ä½ç½®",options:h.map(e=>({label:e,value:e})),style:{width:"100%",height:"48px"},className:"modern-select"})}),we.jsx(H.Item,{label:we.jsxs("span",{style:{color:"var(--text-primary)",fontWeight:600,fontSize:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[we.jsx("span",{style:{fontSize:"20px"},children:"ğŸ“…"}),"ä¿é¤Šæ—¥æœŸ"]}),name:"maintainance_time",rules:[{required:!0,message:"è«‹è¼¸å…¥ä¿é¤Šæ—¥æœŸ"}],children:we.jsxs("div",{style:{position:"relative"},children:[we.jsx("input",{type:"date",value:o.getFieldValue("maintainance_time")||"",onChange:e=>o.setFieldValue("maintainance_time",e.target.value),style:{width:"100%",height:"48px",padding:"12px 16px",border:"2px solid #e1e5e9",borderRadius:"12px",fontSize:"16px",fontWeight:"500",background:"rgba(255,255,255,0.8)",backdropFilter:"blur(10px)",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",color:"#333",colorScheme:"none",appearance:"none",WebkitAppearance:"none",MozAppearance:"textfield"},onFocus:e=>{e.target.style.borderColor="#667eea",e.target.style.boxShadow="0 0 0 3px rgba(102, 126, 234, 0.1)",e.target.style.background="rgba(102, 126, 234, 0.05)"},onBlur:e=>{e.target.style.borderColor="#e1e5e9",e.target.style.boxShadow="0 2px 8px rgba(0,0,0,0.05)",e.target.style.background="rgba(255,255,255,0.8)"}}),we.jsx("style",{jsx:!0,children:'\n                  input[type="date"]::-webkit-calendar-picker-indicator {\n                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                    border-radius: 6px;\n                    padding: 4px;\n                    cursor: pointer;\n                    filter: invert(1);\n                  }\n                  input[type="date"]::-webkit-calendar-picker-indicator:hover {\n                    background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);\n                    transform: scale(1.1);\n                  }\n                  input[type="date"]::-webkit-inner-spin-button,\n                  input[type="date"]::-webkit-outer-spin-button {\n                    -webkit-appearance: none;\n                    margin: 0;\n                  }\n                '})]})}),we.jsx(H.Item,{label:we.jsxs("span",{style:{color:"var(--text-primary)",fontWeight:600,fontSize:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[we.jsx("span",{style:{fontSize:"20px"},children:"ğŸ‘¤"}),"ä¿é¤Šäººå“¡"]}),name:"maintainance_user",rules:[{required:!0,message:"è«‹è¼¸å…¥ä¿é¤Šäººå“¡"}],children:we.jsx("input",{type:"text",placeholder:"ğŸ‘¨â€ğŸ”§ è«‹è¼¸å…¥ä¿é¤Šäººå“¡å§“å",value:o.getFieldValue("maintainance_user")||"",onChange:e=>o.setFieldValue("maintainance_user",e.target.value),style:{width:"100%",height:"48px",padding:"12px 16px",border:"2px solid #e1e5e9",borderRadius:"12px",fontSize:"16px",fontWeight:"500",background:"rgba(255,255,255,0.8)",backdropFilter:"blur(10px)",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",color:"#333"},onFocus:e=>{e.target.style.borderColor="#667eea",e.target.style.boxShadow="0 0 0 3px rgba(102, 126, 234, 0.1)",e.target.style.background="rgba(102, 126, 234, 0.05)"},onBlur:e=>{e.target.style.borderColor="#e1e5e9",e.target.style.boxShadow="0 2px 8px rgba(0,0,0,0.05)",e.target.style.background="rgba(255,255,255,0.8)"}})}),we.jsx(H.Item,{label:we.jsxs("span",{style:{color:"var(--text-primary)",fontWeight:600,fontSize:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[we.jsx("span",{style:{fontSize:"20px"},children:"ğŸ“·"}),"ç…§ç‰‡ä¸Šå‚³"]}),required:!0,children:we.jsx("div",{style:{border:w?"3px solid #52c41a":"3px dashed #667eea",borderRadius:"16px",padding:"24px",textAlign:"center",background:w?"linear-gradient(135deg, rgba(82, 196, 26, 0.1) 0%, rgba(82, 196, 26, 0.05) 100%)":"linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.05) 100%)",backdropFilter:"blur(10px)",transition:"all 0.3s ease",boxShadow:w?"0 8px 32px rgba(82, 196, 26, 0.2)":"0 8px 32px rgba(102, 126, 234, 0.1)",position:"relative",overflow:"hidden"},children:w?we.jsxs("div",{style:{position:"relative"},children:[we.jsxs("div",{style:{position:"relative",width:"100%",paddingBottom:"75%",overflow:"hidden",borderRadius:"12px",boxShadow:"0 4px 16px rgba(0,0,0,0.1)",cursor:"pointer",transition:"all 0.3s ease"},onClick:()=>document.getElementById("photo-upload").click(),onMouseEnter:e=>{e.currentTarget.style.transform="scale(1.02)",e.currentTarget.style.boxShadow="0 8px 24px rgba(0,0,0,0.15)"},onMouseLeave:e=>{e.currentTarget.style.transform="scale(1)",e.currentTarget.style.boxShadow="0 4px 16px rgba(0,0,0,0.1)"},children:[we.jsx("img",{src:_,alt:"é è¦½",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",borderRadius:"12px"}}),we.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",opacity:0,transition:"opacity 0.3s ease"},onMouseEnter:e=>{e.currentTarget.style.opacity="1"},onMouseLeave:e=>{e.currentTarget.style.opacity="0"},children:we.jsxs("div",{style:{color:"white",fontSize:"18px",fontWeight:"600",textAlign:"center"},children:[we.jsx("div",{style:{fontSize:"32px",marginBottom:"8px"},children:"ğŸ“¸"}),"é»æ“Šé‡æ–°é¸æ“‡ç…§ç‰‡"]})}),we.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),te()},style:{position:"absolute",top:"12px",right:"12px",width:"36px",height:"36px",borderRadius:"50%",border:"none",background:"rgba(255, 77, 79, 0.9)",color:"white",cursor:"pointer",fontSize:"20px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(255, 77, 79, 0.4)",zIndex:10,transition:"all 0.3s ease"},onMouseEnter:e=>{e.target.style.transform="scale(1.1)",e.target.style.boxShadow="0 6px 16px rgba(255, 77, 79, 0.6)"},onMouseLeave:e=>{e.target.style.transform="scale(1)",e.target.style.boxShadow="0 4px 12px rgba(255, 77, 79, 0.4)"},children:"Ã—"})]}),we.jsx("div",{style:{marginTop:"16px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:we.jsxs("div",{style:{fontSize:"16px",color:"#52c41a",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},children:[we.jsx("span",{style:{fontSize:"20px"},children:"âœ…"}),w.name]})}),we.jsx("input",{type:"file",accept:"image/*",onChange:Z,style:{display:"none"},id:"photo-upload"})]}):we.jsxs("div",{children:[we.jsx("input",{type:"file",accept:"image/*",onChange:Z,style:{display:"none"},id:"photo-upload"}),we.jsxs("label",{htmlFor:"photo-upload",style:{cursor:"pointer",display:"block",padding:"32px",transition:"all 0.3s ease"},onMouseEnter:e=>{e.currentTarget.style.transform="scale(1.02)"},onMouseLeave:e=>{e.currentTarget.style.transform="scale(1)"},children:[we.jsx("div",{style:{fontSize:"64px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",marginBottom:"20px",filter:"drop-shadow(0 4px 8px rgba(0,0,0,0.1))"},children:"ğŸ“¸"}),we.jsx("div",{style:{fontSize:"20px",fontWeight:600,color:"#667eea",marginBottom:"8px"},children:"é»æ“Šä¸Šå‚³ç…§ç‰‡"}),we.jsx("div",{style:{fontSize:"14px",color:"#8c8c8c",fontWeight:500},children:"æ”¯æ´ JPGã€PNGã€WEBP ç­‰æ ¼å¼"}),we.jsx("div",{style:{marginTop:"16px",padding:"8px 16px",background:"rgba(102, 126, 234, 0.1)",borderRadius:"20px",display:"inline-block",fontSize:"12px",color:"#667eea",fontWeight:600},children:"âœ¨ æ”¯æ´è‡ªå‹•æµ®æ°´å°"})]})]})})}),we.jsx(H.Item,{children:we.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",padding:"20px",background:I?"linear-gradient(135deg, rgba(82, 196, 26, 0.1) 0%, rgba(82, 196, 26, 0.05) 100%)":"linear-gradient(135deg, rgba(140, 140, 140, 0.1) 0%, rgba(140, 140, 140, 0.05) 100%)",borderRadius:"16px",border:I?"2px solid #52c41a":"2px solid #d9d9d9",transition:"all 0.3s ease",boxShadow:I?"0 4px 16px rgba(82, 196, 26, 0.2)":"0 4px 16px rgba(0,0,0,0.05)",cursor:"pointer"},onClick:()=>N(!I),children:[we.jsx("div",{style:{width:"24px",height:"24px",borderRadius:"6px",background:I?"linear-gradient(135deg, #52c41a 0%, #389e0d 100%)":"#d9d9d9",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s ease",boxShadow:I?"0 2px 8px rgba(82, 196, 26, 0.3)":"none"},children:I&&we.jsx("span",{style:{color:"white",fontSize:"14px",fontWeight:"bold"},children:"âœ“"})}),we.jsxs("label",{style:{color:"var(--text-primary)",fontWeight:600,cursor:"pointer",margin:0,fontSize:"16px",flex:1},children:[we.jsx("span",{style:{fontSize:"20px",marginRight:"8px"},children:"ğŸ·ï¸"}),"è‡ªå‹•æ·»åŠ æµ®æ°´å°",we.jsx("div",{style:{fontSize:"14px",color:"#8c8c8c",marginTop:"4px",fontWeight:400},children:"åŒ…å«æ¡ˆå ´åç¨±ã€æª¢æŸ¥é …ç›®ã€ä½ç½®ã€æ—¥æœŸç­‰è³‡è¨Š"})]})]})}),we.jsx(H.Item,{style:{marginTop:"32px"},children:we.jsx(g,{type:"primary",htmlType:"submit",loading:s,disabled:$,icon:we.jsx(J,{style:{fontSize:"20px"}}),size:"large",style:{width:"100%",height:"64px",fontSize:"18px",fontWeight:700,background:s?"linear-gradient(135deg, #bfbfbf 0%, #8c8c8c 100%)":"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none",borderRadius:"16px",boxShadow:s?"0 4px 16px rgba(0,0,0,0.1)":"0 8px 32px rgba(102, 126, 234, 0.4)",transition:"all 0.3s ease",position:"relative",overflow:"hidden"},onMouseEnter:e=>{s||$||(e.target.style.transform="translateY(-2px)",e.target.style.boxShadow="0 12px 40px rgba(102, 126, 234, 0.5)")},onMouseLeave:e=>{s||$||(e.target.style.transform="translateY(0)",e.target.style.boxShadow="0 8px 32px rgba(102, 126, 234, 0.4)")},children:we.jsx("span",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px"},children:s?we.jsxs(we.Fragment,{children:[we.jsx("span",{style:{display:"inline-block",width:"20px",height:"20px",border:"2px solid #ffffff",borderTop:"2px solid transparent",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"æ­£åœ¨å„²å­˜è³‡æ–™..."]}):we.jsxs(we.Fragment,{children:[we.jsx(J,{style:{fontSize:"20px"}}),"ğŸ’¾ å„²å­˜ä¿é¤Šè³‡æ–™"]})})})})]})}),we.jsx(Q,{icon:we.jsx(k,{}),tooltip:"å°ˆæ¡ˆè¨­å®š",onClick:()=>t(`${We}/${e}`),style:{right:24,bottom:24}}),we.jsx(Bt,{visible:T,success:P,message:O,onClose:()=>F(!1)})]})})}function Pt(){const{id:e}=pe(),[t,r]=y.useState(!1),[n,a]=y.useState(!1),[i,o]=y.useState(!0),[c,m]=y.useState(""),[p,u]=y.useState({}),[h,x]=y.useState({name:"",unit:"",directions:""}),[f,j]=y.useState(""),[b,v]=y.useState(!1),w=me();y.useEffect(()=>{d(null,null,function*(){r(!0);const t=e;let n=null,a=null;try{const{data:e,error:t}=yield Ae.auth.getUser();n=e,a=t}catch(s){}if(null==n?void 0:n.user){const e=n.user.email;if(e)try{const{data:t,error:r}=yield Ae.from("user_names").select("user").eq("email",e).single();!r&&t&&t.user?j(t.user):j(e||"ç”¨æˆ¶")}catch(s){j(e||"ç”¨æˆ¶")}else j("ç”¨æˆ¶")}else j("ç”¨æˆ¶");if(!t)return void r(!1);const{data:i}=yield Ae.from("home_project_card").select("name, unit, directions").eq("id",t).single();if(i){x({name:i.name||"",unit:i.unit||"",directions:i.directions||""});try{yield Ae.from("maintainance_setting").upsert({name:i.name})}catch(s){}}const{data:o}=yield Ae.from("maintainance_setting").select("*").eq("project_id",t).single();o&&u({year_q:o.year_q||"",time_start:o.time_start?V(o.time_start):null,time_finish:o.time_finish?V(o.time_finish):null}),r(!1)})},[]);return we.jsxs("div",{style:{minHeight:"100vh",width:"100vw",background:"var(--background-color)",display:"flex",flexDirection:"column"},children:[we.jsx(_t,{userName:f,projectName:h.name,id:e,onUserClick:()=>w("/home"),onHomeClick:()=>w("/home"),onHistory:()=>{},onSeasonSetting:()=>{},onInfoSetting:()=>{w(`/project/${e}/maintain-setting`)},drawerOpen:b,setDrawerOpen:v}),we.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:h.name||h.unit||h.directions?we.jsxs(B,{className:"glass-morphism animate-fadeInUp",style:{width:440,borderRadius:16,boxShadow:"var(--shadow-intense)",background:"var(--bg-glass)",backdropFilter:"blur(20px)",border:"1px solid var(--border-primary)"},children:[we.jsx("h2",{className:"gradient-text",style:{textAlign:"center",marginBottom:24,fontSize:"1.5rem",fontWeight:600},children:"âš™ï¸ æœ¬æ¬¡å­£ä¿é¤Šè¨­å®š"}),we.jsxs(H,{layout:"vertical",initialValues:l(s({},p),{name:h.name,unit:h.unit,directions:h.directions}),onFinish:e=>d(null,null,function*(){r(!0);const t={name:h.name,year_q:e.year_q,time_start:e.time_start?e.time_start.format("YYYY-MM-DD"):null,time_finish:e.time_finish?e.time_finish.format("YYYY-MM-DD"):null},{error:n}=yield Ae.from("maintainance_setting").upsert(t,{onConflict:["name","year_q"]});n?(o(!1),m("å„²å­˜å¤±æ•—"),a(!0)):(o(!0),m("å„²å­˜æˆåŠŸ"),a(!0)),r(!1)}),children:[we.jsx(H.Item,{label:we.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"ğŸ¢ æ¡ˆå ´åç¨±"}),name:"name",children:we.jsx(O,{disabled:!0,style:{height:"48px",borderRadius:"12px",fontSize:"16px",background:"var(--bg-secondary)",color:"var(--text-secondary)"}})}),we.jsx(H.Item,{label:we.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"ğŸ­ æª¢æŸ¥å–®ä½"}),name:"unit",children:we.jsx(O,{disabled:!0,style:{height:"48px",borderRadius:"12px",fontSize:"16px",background:"var(--bg-secondary)",color:"var(--text-secondary)"}})}),we.jsx(H.Item,{label:we.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"ğŸ“‹ æª¢æŸ¥èªªæ˜"}),name:"directions",children:we.jsx(O.TextArea,{disabled:!0,autoSize:!0,style:{borderRadius:"12px",fontSize:"16px",background:"var(--bg-secondary)",color:"var(--text-secondary)"}})}),we.jsx(H.Item,{label:we.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"ğŸ“Š å­£åˆ¥"}),name:"year_q",rules:[{required:!0,message:"è«‹è¼¸å…¥å­£åˆ¥"}],children:we.jsx(O,{placeholder:"ä¾‹å¦‚ï¼š2024 Q3",className:"interactive-hover",style:{height:"48px",borderRadius:"12px",fontSize:"16px"}})}),we.jsx(H.Item,{label:we.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"ğŸ“… ä¿é¤Šæ™‚é–“èµ·"}),name:"time_start",rules:[{required:!0,message:"è«‹é¸æ“‡ä¿é¤Šé–‹å§‹æ™‚é–“"}],children:we.jsx(X,{style:{width:"100%",height:"48px",borderRadius:"12px"},format:"YYYY-MM-DD",className:"interactive-hover"})}),we.jsx(H.Item,{label:we.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"ğŸ“… ä¿é¤Šæ™‚é–“è¿„"}),name:"time_finish",rules:[{required:!0,message:"è«‹é¸æ“‡ä¿é¤ŠçµæŸæ™‚é–“"}],children:we.jsx(X,{style:{width:"100%",height:"48px",borderRadius:"12px"},format:"YYYY-MM-DD",className:"interactive-hover"})}),we.jsx(H.Item,{children:we.jsx(g,{type:"primary",htmlType:"submit",block:!0,loading:t,className:"interactive-click neon-glow",style:{height:"52px",fontSize:"18px",fontWeight:600,borderRadius:"12px",background:"var(--success-gradient)",border:"none",boxShadow:"var(--shadow-success)"},children:"å„²å­˜è¨­å®š"})}),we.jsx(H.Item,{children:we.jsx(g,{danger:!0,block:!0,className:"interactive-click",onClick:()=>d(null,null,function*(){if(!h.name)return o(!1),m("æ‰¾ä¸åˆ°æ¡ˆå ´åç¨±"),void a(!0);r(!0);try{const{error:e}=yield Ae.from("maintainance_setting").delete().eq("name",h.name);e?(o(!1),m("é‡ç½®å¤±æ•—"),a(!0)):(o(!0),m("å·²é‡ç½®æ‰€æœ‰ä¿é¤Šæ™‚é–“"),a(!0))}catch(e){o(!1),m("é‡ç½®æ™‚ç™¼ç”ŸéŒ¯èª¤"),a(!0)}r(!1)}),style:{marginTop:16,background:"var(--danger-gradient)",borderColor:"transparent",boxShadow:"var(--shadow-danger)",animation:"redGlow 2s ease-in-out infinite",fontWeight:600,height:"48px",borderRadius:"12px"},children:"ğŸ—‘ï¸ é‡ç½®æ­¤æ¡ˆå ´çš„æ‰€æœ‰ä¿é¤Šæ™‚é–“"})})]},h.name+h.unit+h.directions+(p.year_q||""))]}):we.jsx(Me,{tip:"è¼‰å…¥å°ˆæ¡ˆè³‡æ–™ä¸­..."})}),we.jsx(Bt,{visible:n,onClose:()=>a(!1),success:i,message:c})]})}function Ut(){const{id:e}=pe(),[t,r]=y.useState(!1),[n,a]=y.useState({}),[i,o]=y.useState({name:"",unit:"",directions:""}),[c,m]=y.useState(""),[p,u]=y.useState(!1),[h,x]=y.useState(!1),[f,j]=y.useState(""),[b,v]=y.useState("success"),[w,S]=y.useState(null),[k,_]=y.useState(null),[C,I]=y.useState(null),N=y.useRef(),z=me();y.useEffect(()=>{d(null,null,function*(){r(!0);const t=e;let n=null,a=null;try{const{data:e,error:t}=yield Ae.auth.getUser();n=e,a=t}catch(l){a=l}let i=n&&n.user?n.user.email:null;if(i)try{const{data:e,error:t}=yield Ae.from("user_names").select("user").eq("email",i).single();!t&&e&&e.user?m(e.user):m(i||"ç”¨æˆ¶")}catch(l){m(i||"ç”¨æˆ¶")}else m("ç”¨æˆ¶");if(!t)return void r(!1);const{data:s}=yield Ae.from("home_project_card").select("name, unit, directions, photo_path").eq("id",t).single();if(s&&(o(s),s.photo_path)){I(s.photo_path);try{const{data:e}=Ae.storage.from("home-project-card-photo").getPublicUrl(s.photo_path);(null==e?void 0:e.publicUrl)&&S(e.publicUrl)}catch(c){}}r(!1)})},[]);return we.jsxs(we.Fragment,{children:[we.jsx(T,{open:h,onOk:()=>x(!1),onCancel:()=>x(!1),okText:"ç¢ºèª",cancelButtonProps:{style:{display:"none"}},centered:!0,className:"success"===b?"custom-success-modal":"modern-modal",bodyStyle:{textAlign:"center",fontSize:18,padding:32},title:"success"===b?"æˆåŠŸ":"éŒ¯èª¤",afterClose:()=>{},children:f}),we.jsxs("div",{style:{minHeight:"100vh",width:"100vw",background:"var(--background-color)",display:"flex",flexDirection:"column"},children:[we.jsx(_t,{projectName:i.name||"è¼‰å…¥ä¸­...",userName:c,id:e,onHomeClick:()=>z("/home"),drawerOpen:p,setDrawerOpen:u}),we.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:i.name||i.unit||i.directions?we.jsxs(B,{className:"glass-morphism animate-fadeInUp",style:{width:440,borderRadius:16,boxShadow:"var(--shadow-intense)",background:"var(--bg-glass)",backdropFilter:"blur(20px)",border:"1px solid var(--border-primary)"},children:[we.jsx("h2",{className:"gradient-text",style:{textAlign:"center",marginBottom:24,fontSize:"1.5rem",fontWeight:600},children:"ğŸ”§ ä¿é¤Šè³‡è¨Šè¨­å®š"}),we.jsxs(H,{layout:"vertical",initialValues:l(s({},n),{name:i.name,unit:i.unit,directions:i.directions}),onFinish:t=>d(null,null,function*(){r(!0);const{name:n,unit:a,directions:i}=t,s=e||1;try{yield(e=>d(null,null,function*(){try{const{data:t,error:r}=yield Ae.storage.from("home-project-card-photo").list(e.toString());if(r)return;if(t&&t.length>0){const r=t.map(t=>`${e}/${t.name}`),{error:n}=yield Ae.storage.from("home-project-card-photo").remove(r)}}catch(t){}}))(s);let e="";k&&(e=yield((e,r)=>d(null,null,function*(){try{const t=Date.now(),n=r.name.split(".").pop(),a=`${e}/project_${e}_${t}.${n}`,{error:i}=yield Ae.storage.from("home-project-card-photo").upload(a,r);if(i)throw i;return a}catch(t){throw t}}))(s,k));const{error:t}=yield Ae.from("home_project_card").update({name:n,unit:a,directions:i,photo_path:e}).eq("id",s);if(t)setSaveSuccess(!1),j(`å„²å­˜å¤±æ•—ï¼š${t.message||"æœªçŸ¥éŒ¯èª¤"}`),setSaveResultVisible(!0);else if(setSaveSuccess(!0),j("ä¿é¤Šè³‡è¨Šå·²å„²å­˜ï¼Œç…§ç‰‡å·²æ›´æ–°"),setSaveResultVisible(!0),o({name:n,unit:a,directions:i}),I(e),_(null),e)try{const{data:t}=Ae.storage.from("home-project-card-photo").getPublicUrl(e);(null==t?void 0:t.publicUrl)&&S(t.publicUrl)}catch(l){}else S(null)}catch(c){setSaveSuccess(!1),j(`è™•ç†å¤±æ•—ï¼š${c.message||"æœªçŸ¥éŒ¯èª¤"}`),setSaveResultVisible(!0)}finally{r(!1)}}),children:[we.jsx(H.Item,{label:we.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"ğŸ¢ æ¡ˆå ´åç¨±"}),name:"name",rules:[{required:!0,message:"è«‹è¼¸å…¥æ¡ˆå ´åç¨±"}],children:we.jsx(O,{name:"name",className:"interactive-hover",style:{height:"48px",borderRadius:"12px",fontSize:"16px"}})}),we.jsx(H.Item,{label:we.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"ğŸ­ æª¢æŸ¥å–®ä½"}),name:"unit",rules:[{required:!0,message:"è«‹è¼¸å…¥æª¢æŸ¥å–®ä½"}],children:we.jsx(O,{name:"unit",className:"interactive-hover",style:{height:"48px",borderRadius:"12px",fontSize:"16px"}})}),we.jsx(H.Item,{label:we.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"ğŸ“‹ æª¢æŸ¥èªªæ˜"}),name:"directions",children:we.jsx(O.TextArea,{name:"directions",autoSize:!0,className:"interactive-hover",style:{borderRadius:"12px",fontSize:"16px"}})}),we.jsxs(H.Item,{label:we.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"ğŸ“¸ ä¸Šå‚³æ¡ˆå ´åœ–ç‰‡"}),children:[we.jsx("div",{className:"interactive-hover",style:{border:"2px dashed var(--border-primary)",borderRadius:"12px",padding:"20px",textAlign:"center",background:"var(--bg-tertiary)",cursor:"pointer",transition:"var(--transition-smooth)",minHeight:"120px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},onClick:()=>{var e;return null==(e=N.current)?void 0:e.click()},children:w?we.jsx("img",{src:w,alt:"æ¡ˆå ´åœ–ç‰‡é è¦½",style:{maxWidth:"100%",maxHeight:"200px",borderRadius:"8px",objectFit:"cover"}}):we.jsxs("div",{className:"animate-bounce",style:{color:"var(--text-accent)",display:"flex",flexDirection:"column",alignItems:"center",gap:"8px"},children:[we.jsx("div",{style:{fontSize:"2rem"},children:"ğŸ“¸"}),we.jsx("div",{style:{fontWeight:500},children:"é»æ“Šä¸Šå‚³æ¡ˆå ´åœ–ç‰‡"})]})}),we.jsx("input",{ref:N,type:"file",accept:"image/*",capture:"environment",style:{display:"none"},onChange:e=>{const t=e.target.files[0];if(t){_(t);const e=new FileReader;e.onload=e=>{S(e.target.result)},e.readAsDataURL(t)}else{if(C)try{const{data:e}=Ae.storage.from("home-project-card-photo").getPublicUrl(C);(null==e?void 0:e.publicUrl)&&S(e.publicUrl)}catch(r){S(null)}else S(null);_(null)}}})]}),we.jsx(H.Item,{children:we.jsx(g,{type:"primary",htmlType:"submit",block:!0,loading:t,className:"interactive-click neon-glow",style:{height:"52px",fontSize:"18px",fontWeight:600,borderRadius:"12px",background:"var(--success-gradient)",border:"none",boxShadow:"var(--shadow-success)"},children:"å„²å­˜è¨­å®š"})})]},i.name+i.unit+i.directions+(n.year_q||""))]}):we.jsx(Me,{tip:"è¼‰å…¥å°ˆæ¡ˆè³‡æ–™ä¸­..."})})]})]})}function At({onRegisterSuccess:e}){const[t]=H.useForm(),[r,n]=y.useState(""),[a,i]=y.useState(!1);return we.jsxs("div",{style:{textAlign:"center",marginBottom:"32px"},children:[we.jsx("div",{className:"neon-glow animate-rotateIn",style:{width:"80px",height:"80px",borderRadius:"50%",background:"var(--success-gradient)",margin:"0 auto 24px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"2rem",fontWeight:"bold",color:"white"},children:"ğŸ‘¤"}),we.jsx(x.Title,{level:2,className:"gradient-text",style:{marginBottom:"8px",fontSize:"2rem",fontWeight:700},children:"è¨»å†Šæ–°å¸³è™Ÿ"}),we.jsxs(H,{form:t,layout:"vertical",onFinish:t=>d(null,null,function*(){n("");const{email:r,password:a,confirmPassword:o}=t;if(!r||!a||!o)return void n("æ‰€æœ‰æ¬„ä½çš†å¿…å¡«");if(a!==o)return void n("å¯†ç¢¼èˆ‡ç¢ºèªå¯†ç¢¼ä¸ä¸€è‡´");i(!0);const{data:s,error:l}=yield Ae.auth.signUp({email:r,password:a,options:{emailRedirectTo:`${window.location.origin}/login`}});if(l)return n(l.message),void i(!1);i(!1),s.user&&!s.session&&(n(""),alert("è¨»å†ŠæˆåŠŸï¼è«‹æª¢æŸ¥æ‚¨çš„éƒµç®±ä¸¦é»æ“Šé©—è­‰é€£çµä»¥å®Œæˆè¨»å†Šã€‚")),e&&e()}),className:"animate-fadeInUp",style:{marginTop:"24px",animationDelay:"0.3s",animationFillMode:"both"},children:[we.jsx(H.Item,{label:we.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"ğŸ“§ Email"}),name:"email",rules:[{required:!0,message:"è«‹è¼¸å…¥Email"},{type:"email",message:"Emailæ ¼å¼éŒ¯èª¤"}],children:we.jsx(O,{placeholder:"è«‹è¼¸å…¥æ‚¨çš„Email",className:"interactive-hover",style:{height:"48px",borderRadius:"12px",fontSize:"16px"}})}),we.jsx(H.Item,{label:we.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"ğŸ”’ å¯†ç¢¼"}),name:"password",rules:[{required:!0,message:"è«‹è¼¸å…¥å¯†ç¢¼"}],children:we.jsx(O.Password,{placeholder:"è«‹è¼¸å…¥å¯†ç¢¼",className:"interactive-hover",style:{height:"48px",borderRadius:"12px",fontSize:"16px"}})}),we.jsx(H.Item,{label:we.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"ğŸ” ç¢ºèªå¯†ç¢¼"}),name:"confirmPassword",dependencies:["password"],rules:[{required:!0,message:"è«‹å†æ¬¡è¼¸å…¥å¯†ç¢¼"},({getFieldValue:e})=>({validator:(t,r)=>r&&e("password")!==r?Promise.reject(new Error("å¯†ç¢¼èˆ‡ç¢ºèªå¯†ç¢¼ä¸ä¸€è‡´")):Promise.resolve()})],children:we.jsx(O.Password,{placeholder:"è«‹å†æ¬¡è¼¸å…¥å¯†ç¢¼",className:"interactive-hover",style:{height:"48px",borderRadius:"12px",fontSize:"16px"}})}),r&&we.jsxs("div",{className:"animate-slideInLeft",style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid var(--border-danger)",borderRadius:"12px",padding:"12px 16px",color:"var(--text-danger)",marginBottom:"24px",textAlign:"center",fontWeight:500,backdropFilter:"blur(10px)"},children:["âš ï¸ ",r]}),we.jsx(g,{type:"primary",htmlType:"submit",block:!0,loading:a,className:"interactive-click neon-glow",style:{height:"52px",fontSize:"18px",fontWeight:600,borderRadius:"12px",background:"var(--success-gradient)",border:"none",boxShadow:"var(--shadow-success)",transition:"var(--transition-bounce)",marginBottom:"12px"},children:"ç«‹å³è¨»å†Š"})]})]})}function Ot(){const e=me(),[t,r]=y.useState(!1);return y.useEffect(()=>(document.body.classList.add("register-page"),()=>{document.body.classList.remove("register-page")}),[]),t?we.jsxs(we.Fragment,{children:[we.jsx("div",{className:"animated-bg"}),we.jsx("div",{className:"register-container",children:we.jsxs("div",{className:"register-card-modern glass-effect",children:[we.jsx("h2",{style:{color:"var(--text-primary)",textAlign:"center",marginBottom:24},children:"è¨»å†ŠæˆåŠŸï¼"}),we.jsx("p",{style:{color:"var(--text-secondary)",textAlign:"center",marginBottom:32},children:"è«‹è‡³ä¿¡ç®±å®Œæˆé©—è­‰å¾Œå†ç™»å…¥"}),we.jsx(g,{className:"modern-btn-primary",type:"primary",block:!0,size:"large",onClick:()=>e(Ne),children:"å‰å¾€ç™»å…¥"})]})})]}):we.jsxs(we.Fragment,{children:[we.jsx("div",{className:"animated-bg"}),we.jsx("div",{style:{minHeight:"100vh",background:"var(--bg-primary)",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",position:"relative",overflow:"hidden"},children:we.jsxs("div",{className:"glass-morphism animate-scaleIn",style:{padding:"48px 40px",width:"100%",maxWidth:"420px",boxShadow:"var(--shadow-intense)",position:"relative",zIndex:1},children:[we.jsx(At,{onRegisterSuccess:()=>r(!0)}),we.jsx(g,{block:!0,onClick:()=>e(Ne),className:"interactive-hover",style:{height:"48px",fontSize:"16px",fontWeight:500,borderRadius:"12px",background:"var(--bg-tertiary)",border:"1px solid var(--border-primary)",color:"var(--text-primary)",marginTop:"12px"},children:"ğŸ”™ è¿”å›ç™»å…¥"})]})})]})}function Dt(){const{id:e}=pe(),t=me(),{userName:r}=De(),{project:n,loading:a,error:i}=Wt(e),[o]=H.useForm(),[s,l]=y.useState(!1);y.useEffect(()=>{o.setFieldsValue({create_at:V(),user:r})},[o,r]);return a?we.jsx(Me,{}):i||!n?we.jsx(Et,{message:"æ‰¾ä¸åˆ°å°ˆæ¡ˆè³‡æ–™",onBack:()=>t(Ie)}):we.jsx(Ct,{userName:r,projectName:n.name,projectId:e,children:we.jsx("div",{style:{maxWidth:"800px",margin:"0 auto",padding:"20px"},children:we.jsx(B,{className:"modern-card glass-morphism animate-fadeInUp",title:we.jsx("div",{className:"gradient-text",style:{fontSize:"1.5rem",fontWeight:600,display:"flex",alignItems:"center",gap:"8px"},children:"â• æ–°å¢å­£ä¿é¤Šè³‡æ–™"}),style:{marginBottom:24},children:we.jsxs(H,{form:o,layout:"vertical",onFinish:e=>d(null,null,function*(){if(!n)return;l(!0);let t=null;try{t={thing:e.thing,location:e.location,floor:e.floor,creat_at:e.create_at.format("YYYY-MM-DD"),creat_user:r,project:n.name,company:n.unit,direction:n.directions};const{error:a}=yield qe.maintenanceData.create(t);if(a)throw a;E.success({content:"å­£ä¿é¤Šè³‡æ–™æ–°å¢æˆåŠŸï¼",duration:3,style:{marginTop:"20vh"}}),o.resetFields(),o.setFieldsValue({create_at:V(),user:r})}catch(a){E.error("æ–°å¢å­£ä¿é¤Šè³‡æ–™å¤±æ•—: "+(a.message||"æœªçŸ¥éŒ¯èª¤")),E.error({content:`æ–°å¢å¤±æ•—ï¼š${a.message||"æœªçŸ¥éŒ¯èª¤"}`,duration:3})}finally{l(!1)}}),className:"animate-slideInLeft",style:{maxWidth:"600px",margin:"0 auto",animationDelay:"0.2s",animationFillMode:"both"},children:[we.jsx(H.Item,{label:we.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"ğŸ” æª¢æŸ¥é …ç›®"}),name:"thing",rules:[{required:!0,message:"è«‹è¼¸å…¥æª¢æŸ¥é …ç›®"}],children:we.jsx(O,{placeholder:"è«‹è¼¸å…¥æª¢æŸ¥é …ç›®",className:"interactive-hover",style:{height:"48px",borderRadius:"12px",fontSize:"16px"}})}),we.jsx(H.Item,{label:we.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"ğŸ“ æª¢æŸ¥ä½ç½®"}),name:"location",rules:[{required:!0,message:"è«‹è¼¸å…¥æª¢æŸ¥ä½ç½®"}],children:we.jsx(O,{placeholder:"è«‹è¼¸å…¥æª¢æŸ¥ä½ç½®",className:"interactive-hover",style:{height:"48px",borderRadius:"12px",fontSize:"16px"}})}),we.jsx(H.Item,{label:we.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"ğŸ¢ æ¨“å±¤"}),name:"floor",rules:[{required:!0,message:"è«‹è¼¸å…¥æ¨“å±¤"}],children:we.jsx(O,{placeholder:"è«‹è¼¸å…¥æ¨“å±¤",className:"interactive-hover",style:{height:"48px",borderRadius:"12px",fontSize:"16px"}})}),we.jsx(H.Item,{label:we.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"ğŸ“… æ–°å¢æ—¥æœŸ"}),name:"create_at",rules:[{required:!0,message:"è«‹é¸æ“‡æ–°å¢æ—¥æœŸ"}],children:we.jsx(X,{style:{width:"100%",height:"48px",borderRadius:"12px",fontSize:"16px"},className:"interactive-hover"})}),we.jsx(H.Item,{label:we.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"ğŸ‘¤ æ–°å¢è€…"}),name:"user",children:we.jsx(O,{disabled:!0,value:r,style:{height:"48px",borderRadius:"12px",fontSize:"16px",background:"var(--bg-secondary)",color:"var(--text-secondary)"}})}),we.jsx(H.Item,{style:{marginTop:32},children:we.jsxs(Z,{size:"large",style:{width:"100%",justifyContent:"center"},children:[we.jsx(g,{type:"primary",htmlType:"submit",icon:we.jsx(J,{}),loading:s,size:"large",className:"interactive-click neon-glow",style:{height:"52px",fontSize:"18px",fontWeight:600,borderRadius:"12px",background:"var(--success-gradient)",border:"none",boxShadow:"var(--shadow-success)",padding:"0 32px"},children:"å„²å­˜"}),we.jsx(g,{type:"default",icon:we.jsx(ee,{}),onClick:()=>{o.resetFields(),o.setFieldsValue({create_at:V(),user:r})},size:"large",className:"interactive-hover",style:{height:"52px",fontSize:"18px",fontWeight:500,borderRadius:"12px",background:"var(--bg-tertiary)",border:"1px solid var(--border-primary)",color:"var(--text-primary)",padding:"0 32px"},children:"å–æ¶ˆ"})]})})]})})})})}const{Title:Mt,Text:Lt}=x;function qt(){const{id:e}=pe(),t=me(),{userName:r}=De(),{project:n,loading:a,error:i}=Wt(e),{modal:o}=P.useApp(),[c,m]=y.useState([]),[p,u]=y.useState(!0),[h,x]=y.useState({}),[j,b]=y.useState([]),[v,w]=y.useState(!1),[S,k]=y.useState(!1);y.useEffect(()=>{n&&_()},[n]);const _=()=>d(null,null,function*(){try{const{data:e,error:t}=yield qe.maintenanceData.getByProject(n.name);if(t)throw t;const{data:r,error:a}=yield qe.maintenancePhoto.getByProject(n.name);if(a)throw a;const i=new Map;r.forEach(e=>{const t=`${e.project}_${e.floor}_${e.thing}_${e.location}`;i.set(t,e)});const o=(e.map(e=>{const t=`${e.project}_${e.floor}_${e.thing}_${e.location}`,r=i.get(t);return l(s({},e),{photo_path:r?r.photo_path:null,photo_record_id:r?r.id:null,maintainance_user:r?r.maintainance_user:e.creat_user,maintainance_time:r?r.maintainance_time:e.creat_at})})||[]).sort((e,t)=>{const r=e.photo_path&&""!==e.photo_path.trim(),n=t.photo_path&&""!==t.photo_path.trim();return!r&&n?-1:r&&!n?1:new Date(t.created_at||0)-new Date(e.created_at||0)});m(o),C(o)}catch(e){}finally{u(!1)}}),C=e=>{const t={};e.forEach(e=>{let r="æœªåˆ†é¡";if(e.location){const t=e.location.match(/[\u4e00-\u9fff]+/);r=t?t[0]:"æœªåˆ†é¡"}t[r]||(t[r]=[]),t[r].push(e)}),Object.keys(t).forEach(e=>{t[e].sort((e,t)=>I(e.location)-I(t.location))}),x(t)},I=e=>{if(!e)return 0;const t=e.match(/(\d+)-(\d+)/);return t?100*parseInt(t[1])+parseInt(t[2]):0},N=e=>{if(!e)return null;try{const{data:t}=Ae.storage.from("maintainance-data-photo").getPublicUrl(e);return t.publicUrl}catch(t){return null}},z=e=>{const t=e.photo_path,r=j.includes(e.id),n={minWidth:280,flexShrink:0,position:"relative",border:r?"2px solid #1890ff":void 0,boxShadow:r?"0 0 10px rgba(24, 144, 255, 0.3)":void 0};return we.jsx(B,{className:"modern-card "+(t?"":"maintenance-card-missing"),style:n,cover:we.jsxs("div",{style:{position:"relative"},children:[v&&we.jsx(ne,{checked:r,onChange:t=>{return r=e.id,n=t.target.checked,void b(n?e=>[...e,r]:e=>e.filter(e=>e!==r));var r,n},style:{position:"absolute",top:8,right:8,zIndex:10,backgroundColor:"var(--bg-secondary)",borderRadius:"4px",padding:"2px",border:"1px solid var(--border-primary)",boxShadow:"var(--shadow-sm)"}}),t?we.jsx("img",{alt:"ä¿é¤Šç…§ç‰‡",src:N(e.photo_path),style:{height:160,objectFit:"cover",width:"100%"},onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="flex"}}):we.jsx("div",{style:{height:160,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(255, 77, 79, 0.2)",color:"#ff4d4f"},children:we.jsx(G,{style:{fontSize:48}})})]}),children:we.jsx(B.Meta,{title:we.jsx("div",{style:{color:t?"var(--text-primary)":"#ff4d4f"},children:e.location}),description:we.jsxs("div",{children:[we.jsxs(Lt,{style:{color:"var(--text-secondary)"},children:["æª¢æŸ¥é …ç›®ï¼š",e.thing]}),we.jsx("br",{}),we.jsxs(Lt,{style:{color:"var(--text-muted)"},children:["æ¨“å±¤ï¼š",e.floor]}),we.jsx("br",{}),we.jsxs(Lt,{style:{color:"var(--text-muted)"},children:["æ–°å¢æ—¥æœŸï¼š",e.maintainance_time]}),we.jsx("br",{}),we.jsxs(Lt,{style:{color:"var(--text-muted)"},children:["ä¿é¤Šè€…ï¼š",e.maintainance_user||"æœªå¡«å¯«"]}),!t&&we.jsx("div",{style:{marginTop:8,color:"#ff4d4f",fontSize:12},children:"âš ï¸ ç¼ºå°‘ç…§ç‰‡è³‡æ–™"})]})})},e.id)},R=e=>Object.entries(e).map(([e,t],r)=>we.jsxs("div",{className:"animate-slideInLeft",style:{marginBottom:32,animationDelay:.1*r+"s",animationFillMode:"both"},children:[we.jsxs(Mt,{level:4,className:"gradient-text",style:{marginBottom:16,borderLeft:"4px solid var(--text-accent)",paddingLeft:12,fontSize:"1.3rem",fontWeight:600},children:["ğŸ“‚ ",e]}),we.jsx("div",{className:"horizontal-scroll",children:t.map((e,t)=>we.jsx("div",{className:"animate-scaleIn",style:{animationDelay:.1*r+.05*t+"s",animationFillMode:"both"},children:z(e)},e.id))})]},e));if(a)return we.jsx(Me,{});if(i||!n)return we.jsx(Et,{message:"æ‰¾ä¸åˆ°å°ˆæ¡ˆè³‡æ–™",onBack:()=>t(Ie)});const $=[{key:"location",label:"æŒ‰æª¢æŸ¥ä½ç½®åˆ†é¡",children:p?we.jsx("div",{style:{textAlign:"center",padding:40},children:we.jsx(f,{size:"large"})}):0===Object.keys(h).length?we.jsx(te,{description:"æš«ç„¡ä¿é¤Šè³‡æ–™"}):R(h)},{key:"thing",label:"æŒ‰æª¢æŸ¥é …ç›®åˆ†é¡",children:p?we.jsx("div",{style:{textAlign:"center",padding:40},children:we.jsx(f,{size:"large"})}):0===c.length?we.jsx(te,{description:"æš«ç„¡ä¿é¤Šè³‡æ–™"}):R((e=>{const t={};return e.forEach(e=>{const r=e.thing||"æœªåˆ†é¡";t[r]||(t[r]=[]),t[r].push(e)}),t})(c))}];return we.jsx(Ct,{userName:r,projectName:n.name,projectId:e,children:we.jsx("div",{style:{maxWidth:"1200px",margin:"0 auto",padding:"20px"},children:we.jsx(B,{className:"modern-card glass-morphism animate-fadeInUp",title:we.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[we.jsx("div",{className:"gradient-text",style:{display:"flex",alignItems:"center",gap:8,fontSize:"1.5rem",fontWeight:600},children:"ğŸ‘ï¸ æŸ¥çœ‹å­£ä¿é¤Šè³‡æ–™"}),we.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[v&&we.jsxs(we.Fragment,{children:[we.jsxs(ne,{checked:j.length===c.length&&c.length>0,indeterminate:j.length>0&&j.length<c.length,onChange:e=>{return t=e.target.checked,void b(t?c.map(e=>e.id):[]);var t},style:{color:"var(--text-primary)"},children:["å…¨é¸ (",j.length,"/",c.length,")"]}),we.jsxs(g,{type:"primary",danger:!0,icon:we.jsx(ae,{}),onClick:()=>{d(null,null,function*(){0!==j.length?o.confirm({title:we.jsxs("span",{style:{color:"var(--text-primary)"},children:[we.jsx(ae,{})," ç¢ºèªåˆªé™¤å­£ä¿é¤Šé …ç›®"]}),content:we.jsxs("span",{style:{color:"var(--text-secondary)"},children:["æ‚¨ç¢ºå®šè¦åˆªé™¤é¸ä¸­çš„ ",we.jsx("strong",{style:{color:"var(--text-accent)"},children:j.length})," å€‹å­£ä¿é¤Šé …ç›®å—ï¼Ÿé€™å°‡åˆªé™¤ maintainance_data è¡¨ä¸­çš„è³‡æ–™è¨˜éŒ„ã€‚"]}),okText:"ç¢ºèª",cancelText:"å–æ¶ˆ",okButtonProps:{danger:!0},centered:!0,className:"modern-modal",onOk:()=>d(null,null,function*(){k(!0);try{for(const e of j)yield qe.maintenanceData.delete(e);T.success({title:"åˆªé™¤æˆåŠŸ",content:`æˆåŠŸåˆªé™¤ ${j.length} å€‹å­£ä¿é¤Šé …ç›®`,className:"custom-success-modal"}),b([]),w(!1),_()}catch(e){T.error({title:"åˆªé™¤å¤±æ•—",content:"æ“ä½œå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦",className:"modern-modal"})}finally{k(!1)}})}):E.warning("è«‹å…ˆé¸æ“‡è¦åˆªé™¤çš„é …ç›®")})},loading:S,disabled:0===j.length,style:{marginRight:8},children:["åˆªé™¤å­£ä¿é¤Šé …ç›® (",j.length,")"]}),we.jsxs(g,{type:"primary",danger:!0,icon:we.jsx(ae,{}),onClick:()=>{d(null,null,function*(){0!==j.length?o.confirm({title:we.jsxs("span",{style:{color:"var(--text-primary)"},children:[we.jsx(ae,{})," ç¢ºèªåˆªé™¤æœ¬æ¬¡å­£ä¿é¤Šè³‡æ–™"]}),content:we.jsxs("span",{style:{color:"var(--text-secondary)"},children:["æ‚¨ç¢ºå®šè¦åˆªé™¤é¸ä¸­çš„ ",we.jsx("strong",{style:{color:"var(--text-accent)"},children:j.length})," å€‹é …ç›®çš„ç…§ç‰‡è³‡æ–™å—ï¼Ÿé€™å°‡åˆªé™¤ maintainance_photo è¡¨ä¸­çš„è³‡æ–™å’Œç›¸é—œç…§ç‰‡æ–‡ä»¶ã€‚"]}),okText:"ç¢ºèª",cancelText:"å–æ¶ˆ",okButtonProps:{danger:!0},centered:!0,className:"modern-modal",onOk:()=>d(null,null,function*(){k(!0);try{for(const e of j){const t=c.find(t=>t.id===e);t&&t.photo_record_id&&(t.photo_path&&(yield qe.storage.deleteImage("maintainance-data-photo",t.photo_path)),yield qe.maintenancePhoto.delete(t.photo_record_id))}T.success({title:"åˆªé™¤æˆåŠŸ",content:`æˆåŠŸåˆªé™¤ ${j.length} å€‹æœ¬æ¬¡å­£ä¿é¤Šè³‡æ–™`,className:"custom-success-modal"}),b([]),w(!1),_()}catch(e){T.error({title:"åˆªé™¤å¤±æ•—",content:"æ“ä½œå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦",className:"modern-modal"})}finally{k(!1)}})}):E.warning("è«‹å…ˆé¸æ“‡è¦åˆªé™¤çš„é …ç›®")})},loading:S,disabled:0===j.length,children:["åˆªé™¤æœ¬æ¬¡å­£ä¿é¤Šè³‡æ–™ (",j.length,")"]})]}),we.jsx(g,{type:v?"default":"primary",icon:we.jsx(ie,{}),onClick:()=>{w(!v),b([])},children:v?"å–æ¶ˆé¸æ“‡":"æ‰¹é‡é¸æ“‡"})]})]}),style:{marginBottom:24},children:we.jsx(re,{items:$,defaultActiveKey:"location",className:"animate-slideInRight",style:{minHeight:400,animationDelay:"0.3s",animationFillMode:"both"}})})})})}const Yt=u(ge());function Ht(e){return d(this,null,function*(){const t=yield fetch(e);return yield t.arrayBuffer()})}function Vt(){const{id:e}=pe(),t=me(),{userName:r}=De(),{project:n,loading:a,error:i}=Wt(e),{message:o,modal:s}=P.useApp(),[l,c]=y.useState(!1),[m,p]=y.useState(null),[u,h]=y.useState([]),[x,f]=y.useState([]),[j,b]=y.useState(!1),[v,w]=y.useState("merged"),[S,k]=y.useState({});y.useEffect(()=>{n&&n.name&&d(null,null,function*(){if(n&&n.name)try{const{data:e,error:t}=yield qe.maintenancePhoto.getByProject(n.name);if(t)throw t;if(h(e||[]),e&&e.length>0){const t=e.reduce((e,t)=>{const r=t.thing||"æœªåˆ†é¡";return e[r]||(e[r]=[]),e[r].push(t),e},{});k(t)}}catch(e){p("ç„¡æ³•ç²å–ä¿é¤Šè³‡æ–™")}})},[n]);const _=(e,t,r)=>d(null,null,function*(){const a=e.addWorksheet(t);for(let e=1;e<=1e3;e++)a.getRow(e).height=49.5;for(let e=1;e<=50;e++)a.getColumn(e).width=6.5;const i={top:{style:"thin",color:{argb:"FF000000"}},left:{style:"thin",color:{argb:"FF000000"}},bottom:{style:"thin",color:{argb:"FF000000"}},right:{style:"thin",color:{argb:"FF000000"}}},{data:o,error:s}=yield Ae.from("maintainance_setting").select("time_start, time_finish").eq("name",n.name).single();a.mergeCells("A1:B2");const l=a.getCell("A1");l.value="æ±ºè£ç·¨è™Ÿ",l.font={size:14,name:"Microsoft YaHei UI"},l.alignment={horizontal:"center",vertical:"middle"},l.border=i,a.mergeCells("C1:F2"),a.getCell("C1").border=i,a.mergeCells("G1:H2");const c=a.getCell("G1");c.value="å·¥ç¨‹åç¨±",c.font={size:14,name:"Microsoft YaHei UI"},c.alignment={horizontal:"center",vertical:"middle"},c.border=i,a.mergeCells("I1:T2");const d=a.getCell("I1");d.value=n.name,d.font={size:14,name:"Microsoft YaHei UI"},d.alignment={horizontal:"center",vertical:"middle"},d.border=i,a.mergeCells("U1:AD2");const m=a.getCell("U1");m.value="é©—æ”¶ç…§ç‰‡",m.font={size:20,name:"Microsoft YaHei UI"},m.alignment={horizontal:"center",vertical:"middle"},m.border=i,a.mergeCells("AE1:AF2");const p=a.getCell("AE1");p.value="æ—¥æœŸ",p.font={size:20,name:"Microsoft YaHei UI"},p.alignment={horizontal:"center",vertical:"middle"},p.border=i,a.mergeCells("AG1:AJ1");const u=a.getCell("AG1");u.value=(null==o?void 0:o.time_start)||"",u.font={size:14,name:"Microsoft YaHei UI"},u.alignment={horizontal:"center",vertical:"middle"},u.border=i,a.mergeCells("AG2:AJ2");const h=a.getCell("AG2");if(h.value=(null==o?void 0:o.time_finish)||"",h.font={size:14,name:"Microsoft YaHei UI"},h.alignment={horizontal:"center",vertical:"middle"},h.border=i,r&&r.length>0){let t=4,n=1;const i=Math.ceil(r.length/4);for(let o=0;o<i;o++){const i=t+14*o;for(let t=0;t<4;t++){const s=4*o+t;if(s>=r.length)break;const l=r[s],c=3+9*t,d=e=>{let t="";for(;e>0;)e--,t=String.fromCharCode(65+e%26)+t,e=Math.floor(e/26);return t},m=d(c),p=d(c+6),u=i,h=i+8;try{a.mergeCells(`${m}${u}:${p}${h}`)}catch(x){}if(l.photo_path)try{const t=qe.storage.getImageUrl("maintainance-data-photo",l.photo_path),r=yield Ht(t),n=e.addImage({buffer:r,extension:"jpeg"});a.addImage(n,{tl:{col:c-1+.1,row:u-1+.1},ext:{width:290.6,height:226.5}})}catch(g){const e=a.getCell(`${m}${u}`);e.value="ç…§ç‰‡è¼‰å…¥å¤±æ•—",e.alignment={horizontal:"center",vertical:"middle"}}const y=i+9;try{a.mergeCells(`${m}${y}:${p}${y}`)}catch(x){}const f=a.getCell(`${m}${y}`);f.value=`â„–${n}`,f.font={size:14,name:"Microsoft YaHei UI"},f.alignment={horizontal:"center",vertical:"middle"},f.border={bottom:{style:"thin",color:{argb:"FF000000"}}};const j=y+1,b=a.getCell(`${m}${j}`);b.value="ä½ç½®:",b.font={size:10,name:"Microsoft YaHei UI"};const v=d(c+1),w=p;try{a.mergeCells(`${v}${j}:${w}${j}`)}catch(x){}const S=a.getCell(`${v}${j}`);S.value=l.location||"",S.font={size:10,name:"Microsoft YaHei UI"};const k=j+1,_=a.getCell(`${m}${k}`);_.value="å…§å®¹:",_.font={size:10,name:"Microsoft YaHei UI"};try{a.mergeCells(`${v}${k}:${w}${k}`)}catch(x){}const C=a.getCell(`${v}${k}`);C.value=l.thing||"",C.font={size:10,name:"Microsoft YaHei UI"};const I=k+1,N=a.getCell(`${m}${I}`);N.value="å‚™è¨»:",N.font={size:10,name:"Microsoft YaHei UI"},N.border={bottom:{style:"thin",color:{argb:"FF000000"}}};try{a.mergeCells(`${v}${I}:${w}${I}`)}catch(x){}const z=a.getCell(`${v}${I}`);z.value="",z.font={size:10,name:"Microsoft YaHei UI"},z.border={bottom:{style:"thin",color:{argb:"FF000000"}}},n++}}}});if(a)return we.jsx(Me,{});if(i||!n)return we.jsx(Et,{message:"æ‰¾ä¸åˆ°å°ˆæ¡ˆè³‡æ–™",onBack:()=>t("/")});return we.jsx(Ct,{userName:r,projectName:null==n?void 0:n.name,projectId:e,children:we.jsxs("div",{style:{padding:"20px",color:"white"},children:[we.jsx("h1",{children:"åŒ¯å‡º Excel"}),we.jsxs(B,{title:"ğŸ“‹ è¼¸å‡ºé¸é …",style:{marginBottom:"20px",backgroundColor:"var(--bg-card)",border:"1px solid var(--border-primary)"},headStyle:{color:"white",backgroundColor:"var(--bg-secondary)"},bodyStyle:{backgroundColor:"var(--bg-card)"},children:[we.jsxs(M,{gutter:[16,16],children:[we.jsx(L,{span:12,children:we.jsx(ne,{checked:"merged"===v,onChange:e=>e.target.checked&&w("merged"),style:{color:"white"},children:we.jsxs("span",{style:{color:"white"},children:[we.jsx("strong",{children:"åˆä½µè¼¸å‡º"}),we.jsx("br",{}),we.jsx("small",{style:{color:"var(--text-secondary)"},children:"ä¸åˆ†é¡ï¼Œç›´æ¥åŒ¯å‡ºæ‰€æœ‰è³‡æ–™åˆ°å–®ä¸€å·¥ä½œè¡¨"})]})})}),we.jsx(L,{span:12,children:we.jsx(ne,{checked:"categorized"===v,onChange:e=>e.target.checked&&w("categorized"),style:{color:"white"},children:we.jsxs("span",{style:{color:"white"},children:[we.jsx("strong",{children:"åˆ†é¡è¼¸å‡º"}),we.jsx("br",{}),we.jsx("small",{style:{color:"var(--text-secondary)"},children:"æ ¹æ“šä¿é¤Šé …ç›®åˆ†é¡ï¼Œæ¯å€‹ä¸åŒçš„ä¿é¤Šé …ç›®å‰µå»ºä¸€å€‹å·¥ä½œè¡¨"})]})})})]}),"categorized"===v&&Object.keys(S).length>0&&we.jsxs("div",{style:{marginTop:"16px",padding:"12px",backgroundColor:"var(--bg-secondary)",borderRadius:"6px"},children:[we.jsx("h4",{style:{color:"white",margin:"0 0 8px 0"},children:"å°‡å‰µå»ºçš„å·¥ä½œè¡¨ï¼š"}),we.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:Object.entries(S).map(([e,t])=>we.jsxs("span",{style:{backgroundColor:"var(--primary-color)",color:"white",padding:"4px 8px",borderRadius:"4px",fontSize:"12px"},children:[e," (",t.length,"ç­†)"]},e))})]})]}),we.jsxs(M,{gutter:[16,16],style:{marginBottom:"20px"},children:[we.jsx(L,{children:we.jsx(g,{type:"default",onClick:()=>{if(!u.length)return;const e=u.map((e,t)=>({key:t,"åºè™Ÿ":`â„–${t+1}`,"ä½ç½®":e.location||"","å…§å®¹":e.thing||"","å‚™è¨»":"","ç…§ç‰‡":e.photo_path?"æœ‰ç…§ç‰‡":"ç„¡ç…§ç‰‡"}));f(e),b(!0)},disabled:!u.length,size:"large",style:{height:"48px",fontSize:"16px",fontWeight:600},children:"ğŸ“‹ é è¦½è¡¨æ ¼"})}),we.jsx(L,{children:we.jsx(g,{type:"primary",onClick:()=>d(null,null,function*(){if(c(!0),p(null),!n||!n.name)return o.error({content:"ç„¡æ³•ç”Ÿæˆ Excelï¼šå°ˆæ¡ˆè³‡æ–™å°šæœªè¼‰å…¥ï¼Œè«‹ç¨å¾Œå†è©¦",duration:3}),void c(!1);try{const{data:e,error:t}=yield qe.maintenancePhoto.getByProject(n.name);if(t)throw t;const r=new Yt.Workbook;if("merged"===v)yield _(r,"1008-ç¯„æœ¬",e);else{const t=e.reduce((e,t)=>{const r=t.thing||"æœªåˆ†é¡";return e[r]||(e[r]=[]),e[r].push(t),e},{});for(const[e,n]of Object.entries(t)){const t=e.length>31?e.substring(0,31):e;yield _(r,t,n)}}const a=yield r.xlsx.writeBuffer(),i=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),s=document.createElement("a");s.href=URL.createObjectURL(i);const l="merged"===v?`${n.name}_åˆä½µè¼¸å‡º.xlsx`:`${n.name}_åˆ†é¡è¼¸å‡º.xlsx`;s.download=l,s.click(),o.success({content:`Excel æ–‡ä»¶å·²æˆåŠŸä¸‹è¼‰ï¼æª”æ¡ˆ ${l} å·²ç”Ÿæˆ`,duration:3,style:{marginTop:"20vh"}})}catch(e){o.error({content:"ç”Ÿæˆå¤±æ•—ï¼šç„¡æ³•ç”Ÿæˆ Excel æ–‡ä»¶ï¼Œè«‹ç¨å¾Œå†è©¦",duration:3})}finally{c(!1)}}),loading:l,disabled:l||!u.length,size:"large",style:{background:"var(--primary-gradient)",border:"none",height:"48px",fontSize:"16px",fontWeight:600},children:l?"æ­£åœ¨ç”Ÿæˆ Excel...":`ä¸‹è¼‰ ${"merged"===v?"åˆä½µ":"åˆ†é¡"}è¼¸å‡º Excel`})})]}),j&&we.jsx(B,{title:"ğŸ“Š è¡¨æ ¼é è¦½ (èˆ‡åŒ¯å‡ºçš„è¡¨æ ¼ä¸€æ¨¡ä¸€æ¨£)",style:{marginBottom:"20px",backgroundColor:"var(--bg-card)",border:"1px solid var(--border-primary)"},headStyle:{color:"white",backgroundColor:"var(--bg-secondary)"},bodyStyle:{backgroundColor:"var(--bg-card)"},extra:we.jsx(g,{type:"text",onClick:()=>b(!1),style:{color:"white"},children:"éš±è—é è¦½"}),children:we.jsx(oe,{columns:[{title:"åºè™Ÿ",dataIndex:"åºè™Ÿ",key:"åºè™Ÿ",width:80,align:"center"},{title:"ä½ç½®",dataIndex:"ä½ç½®",key:"ä½ç½®",width:150},{title:"å…§å®¹",dataIndex:"å…§å®¹",key:"å…§å®¹",width:150},{title:"å‚™è¨»",dataIndex:"å‚™è¨»",key:"å‚™è¨»",width:150},{title:"ç…§ç‰‡",dataIndex:"ç…§ç‰‡",key:"ç…§ç‰‡",width:100,align:"center"}],dataSource:x,pagination:{pageSize:10},size:"small",style:{backgroundColor:"white"}})}),m&&we.jsx(A,{message:m,type:"error",style:{marginTop:20},showIcon:!0}),we.jsxs("div",{style:{background:"var(--bg-card)",padding:"16px",borderRadius:"8px",margin:"16px 0",border:"1px solid var(--border-primary)"},children:[we.jsx("h3",{children:"ğŸ“‹ ç¯„æœ¬æ ¼å¼èªªæ˜"}),we.jsxs("ul",{style:{margin:"8px 0",paddingLeft:"20px"},children:[we.jsx("li",{children:"å…¨éƒ¨åˆ—é«˜ï¼š19.5ï¼Œå…¨éƒ¨æ¬„å¯¬ï¼š5.26"}),we.jsx("li",{children:"å­—é«”ï¼šMicrosoft YaHei UI"}),we.jsx("li",{children:"æ¨™é¡Œåˆ—ï¼šæ±ºè£ç·¨è™Ÿã€å·¥ç¨‹åç¨±ã€å°ˆæ¡ˆåç¨±ã€é©—æ”¶ç…§ç‰‡ã€æ—¥æœŸ"}),we.jsx("li",{children:"è³‡æ–™å€ï¼šä¸€æ©«æ’4çµ„ï¼Œæ¯çµ„åŒ…å«ç…§ç‰‡ã€ç·¨è™Ÿã€ä½ç½®ã€å…§å®¹ã€å‚™è¨»"}),we.jsx("li",{children:"è‡ªå‹•å¾ maintainance_setting å–å¾—æ™‚é–“è³‡æ–™"})]})]}),we.jsxs("div",{style:{marginTop:"24px",fontSize:"14px",color:"var(--text-secondary)"},children:[we.jsxs("p",{children:["ğŸ“Š è³‡æ–™çµ±è¨ˆï¼šå…± ",u.length," ç­†ä¿é¤Šç…§ç‰‡è¨˜éŒ„"]}),we.jsx("p",{children:"ğŸ“ æª”æ¡ˆæ ¼å¼ï¼šExcel (.xlsx)"}),"categorized"===v&&we.jsxs("p",{children:["ğŸ“‚ åˆ†é¡çµ±è¨ˆï¼šå°‡å‰µå»º ",Object.keys(S).length," å€‹å·¥ä½œè¡¨"]})]})]})})}function Gt({onLoginSuccess:e}){const[t,r]=y.useState([]),[n,a]=y.useState(""),[i,o]=y.useState(""),[s,l]=y.useState(""),[c,m]=y.useState(!1),p=me();y.useEffect(()=>{!function(){d(this,null,function*(){const{data:e,error:t}=yield qe.users.getAll();!t&&e&&r(e)})}()},[]);const u=()=>d(null,null,function*(){if(l(""),m(!0),!n||!i)return l("è«‹è¼¸å…¥å¸³è™Ÿå’Œå¯†ç¢¼"),void m(!1);try{const{data:{user:t}}=yield Ae.auth.getUser();let r=n;if(!n.includes("@")){const{data:e,error:t}=yield Ae.from("user_names").select("email").eq("user",n).single();if(t||!e)return l("æ‰¾ä¸åˆ°æ­¤ç”¨æˆ¶å"),void m(!1);r=e.email}const{data:a,error:o}=yield Ae.auth.signInWithPassword({email:r,password:i});if(o)return l("ç™»å…¥å¤±æ•—ï¼š"+o.message),void m(!1);const{data:s,error:c}=yield Ae.from("user_names").select("user").eq("email",r).single();E.success("ç™»å…¥æˆåŠŸï¼"),!c&&s||setTimeout(()=>{ce(()=>d(null,null,function*(){const{default:e}=yield import("./UserNameSetupModal-a5tTULBs.js");return{default:e}}),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url).then(({default:e})=>{const{createRoot:t}=require("react-dom/client"),n=document.createElement("div");document.body.appendChild(n);const a=t(n),i=()=>{a.unmount(),document.body.removeChild(n)};a.render(h.createElement(e,{visible:!0,onClose:i,userEmail:r,onSuccess:e=>{i()}}))})},500),e&&e()}catch(t){l("ç™»å…¥ç•°å¸¸ï¼š"+t.message)}finally{m(!1)}}),f=t.filter(e=>e.user&&!e.user.includes("@")).map(e=>({value:e.user}));return we.jsxs(we.Fragment,{children:[we.jsx("div",{className:"animated-bg"}),we.jsx("div",{style:{minHeight:"100vh",background:"var(--bg-primary)",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",position:"relative",overflow:"hidden"},children:we.jsxs("div",{className:"glass-morphism animate-scaleIn",style:{padding:"48px 40px",width:"100%",maxWidth:"420px",boxShadow:"var(--shadow-intense)",position:"relative",zIndex:1},children:[we.jsxs("div",{className:"animate-fadeInUp",style:{textAlign:"center",marginBottom:"32px"},children:[we.jsx("div",{className:"neon-glow animate-rotateIn",style:{width:"80px",height:"80px",borderRadius:"50%",background:"var(--primary-gradient)",margin:"0 auto 24px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"2rem",fontWeight:"bold",color:"white"},children:"ğŸ”§"}),we.jsx(x.Title,{level:2,className:"gradient-text",style:{marginBottom:"8px",fontSize:"2rem",fontWeight:700},children:"å­£ä¿é¤Šç®¡ç†ç³»çµ±"})]}),we.jsxs(H,{layout:"vertical",onFinish:u,className:"animate-fadeInUp",style:{animationDelay:"0.3s",animationFillMode:"both"},children:[we.jsx(H.Item,{label:we.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"ğŸ‘¤ å¸³è™Ÿ"}),required:!0,children:we.jsx(se,{className:"interactive-hover",value:n,onChange:a,options:f,placeholder:"è«‹è¼¸å…¥Emailæˆ–é¸æ“‡ç”¨æˆ¶å",style:{height:"48px",borderRadius:"12px",fontSize:"16px"},filterOption:(e,t)=>{var r;return(null!=(r=null==t?void 0:t.value)?r:"").toLowerCase().includes(e.toLowerCase())}})}),we.jsx(H.Item,{label:we.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"ğŸ”’ å¯†ç¢¼"}),required:!0,children:we.jsx(O.Password,{className:"interactive-hover",value:i,onChange:e=>o(e.target.value),placeholder:"è«‹è¼¸å…¥å¯†ç¢¼",style:{height:"48px",borderRadius:"12px",fontSize:"16px"},onPressEnter:u})}),s&&we.jsxs("div",{className:"animate-slideInLeft",style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid var(--border-danger)",borderRadius:"12px",padding:"12px 16px",color:"var(--text-danger)",marginBottom:"24px",textAlign:"center",fontWeight:500,backdropFilter:"blur(10px)"},children:["âš ï¸ ",s]}),we.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[we.jsx(g,{type:"primary",onClick:u,loading:c,block:!0,disabled:!n||!i,className:"interactive-click neon-glow",style:{height:"52px",fontSize:"18px",fontWeight:600,borderRadius:"12px",background:"var(--primary-gradient)",border:"none",boxShadow:"var(--shadow-glow)",transition:"var(--transition-bounce)"},children:"ç«‹å³ç™»å…¥"}),we.jsx(g,{block:!0,onClick:()=>p(ze),className:"interactive-hover",style:{height:"48px",fontSize:"16px",fontWeight:500,borderRadius:"12px",background:"var(--bg-tertiary)",border:"1px solid var(--border-primary)",color:"var(--text-primary)"},children:"è¨»å†Šæ–°å¸³è™Ÿ"})]})]})]})})]})}function Kt(){return we.jsx(Fe,{children:we.jsx(P,{children:we.jsx(ue,{children:we.jsxs(he,{children:[we.jsx(xe,{path:Ne,element:we.jsx(Jt,{})}),we.jsx(xe,{path:ze,element:we.jsx(Ot,{})}),we.jsx(xe,{path:Ie,element:we.jsx(Le,{children:we.jsx(Tt,{})})}),we.jsx(xe,{path:Re,element:we.jsx(Le,{children:we.jsx(Ft,{})})}),we.jsx(xe,{path:$e,element:we.jsx(Le,{children:we.jsx(Pt,{})})}),we.jsx(xe,{path:We,element:we.jsx(Le,{children:we.jsx(Ut,{})})}),we.jsx(xe,{path:Te,element:we.jsx(Le,{children:we.jsx(Dt,{})})}),we.jsx(xe,{path:Ee,element:we.jsx(Le,{children:we.jsx(qt,{})})}),we.jsx(xe,{path:Be,element:we.jsx(Le,{children:we.jsx(Vt,{})})}),we.jsx(xe,{path:"*",element:we.jsx(de,{to:Ne,replace:!0})})]})})})})}function Jt(){const e=me();return we.jsx(Gt,{onLoginSuccess:()=>e(Ie)})}ke.createRoot(document.getElementById("root")).render(we.jsx(h.StrictMode,{children:we.jsx(Kt,{})}));export{we as j,Ae as s};
