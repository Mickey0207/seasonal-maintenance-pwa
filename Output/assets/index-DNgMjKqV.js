var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertyNames,a=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,l=(e,t)=>{for(var r in t||(t={}))i.call(t,r)&&s(e,r,t[r]);if(a)for(var r of a(t))o.call(t,r)&&s(e,r,t[r]);return e},c=(e,n)=>t(e,r(n)),d=(e,t)=>{var r={};for(var n in e)i.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&a)for(var n of a(e))t.indexOf(n)<0&&o.call(e,n)&&(r[n]=e[n]);return r},m=(e,t,r)=>new Promise((n,a)=>{var i=e=>{try{s(r.next(e))}catch(t){a(t)}},o=e=>{try{s(r.throw(e))}catch(t){a(t)}},s=e=>e.done?n(e.value):Promise.resolve(e.value).then(i,o);s((r=r.apply(e,t)).next())});import{r as p,a as u,g as h}from"./vendor-CeQafwst.js";import{R as x,T as g,B as f,r as y,S as b,L as j,a as v,D as w,b as S,c as k,d as _,e as N,f as I,g as C,h as R,i as z,j as W,k as T,l as E,M as $,C as B,m as O,n as F,s as A,o as U,p as P,F as L,q as D,A as q,t as M,u as Y,v as H,w as V,I as K,x as G,y as X,z as J,E as Q,G as Z,H as ee,J as te,K as re,N as ne,O as ae,P as ie}from"./antd-Dylj3sc-.js";import{c as oe}from"./supabase-DzqVpjuu.js";import{N as se,u as le,a as ce,B as de,R as me,b as pe}from"./router-B3hCes90.js";import{r as ue}from"./utils-BLtkkhtr.js";var he,xe,ge=(he={"assets/index-DNgMjKqV.js"(e){!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var t,r,n,a={exports:{}},i={},o=(r||(r=1,a.exports=function(){if(t)return i;t=1;var e=p(),r=Symbol.for("react.element"),n=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var i,l={},c=null,d=null;for(i in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,i)&&!s.hasOwnProperty(i)&&(l[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===l[i]&&(l[i]=t[i]);return{$$typeof:r,type:e,key:c,ref:d,props:l,_owner:o.current}}return i.Fragment=n,i.jsx=l,i.jsxs=l,i}()),a.exports),s={},he=function(){if(n)return s;n=1;var e=u();return s.createRoot=e.createRoot,s.hydrateRoot=e.hydrateRoot,s}();const xe=h(he),ge="ACL 季保養",fe="ACL 季保養",ye="/home",be="/",je="/register",ve="/project/:id",we="/project/:id/season-setting",Se="/project/:id/maintain-setting",ke="/project/:id/addmaintainancedata",_e="/project/:id/viewmaintainancedata",Ne="/project/:id/export-excel";class Ie extends x.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){}render(){var e;return this.state.hasError?o.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",padding:"20px",textAlign:"center"},children:[o.jsx(g.Title,{level:3,type:"danger",children:"發生錯誤"}),o.jsx(g.Text,{style:{marginBottom:"20px"},children:(null==(e=this.state.error)?void 0:e.message)||"未知錯誤"}),o.jsx(f,{type:"primary",onClick:()=>window.location.reload(),children:"重新載入頁面"})]}):this.props.children}}const Ce={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_ANON_KEY:"your-anon-key-here",VITE_SUPABASE_URL:"https://your-project.supabase.co"},Re=(e,t="")=>{const r=Ce[e];return r||t},ze=Re("VITE_SUPABASE_URL","https://placeholder.supabase.co"),We=Re("VITE_SUPABASE_ANON_KEY","placeholder-key"),Te=oe(ze,We),Ee={getCurrentUser(){return m(this,null,function*(){const{data:{user:e},error:t}=yield Te.auth.getUser();return{user:e,error:t}})},getUserName(){return m(this,null,function*(){const{user:e,error:t}=yield this.getCurrentUser();if(t||!(null==e?void 0:e.email))return"";const{data:r,error:n}=yield Te.from("user_names").select("user").eq("email",e.email).single();return!n&&(null==r?void 0:r.user)?r.user:e.email})},logout(){return m(this,null,function*(){localStorage.clear(),yield Te.auth.signOut()})},isAuthenticated(){return m(this,null,function*(){const{user:e}=yield this.getCurrentUser();return!!e})}},$e=()=>{const[e,t]=y.useState(null),[r,n]=y.useState(""),[a,i]=y.useState(!0);return y.useEffect(()=>{m(null,null,function*(){i(!0);try{const{user:e}=yield Ee.getCurrentUser();if(t(e),e){const e=yield Ee.getUserName();n(e)}}catch(e){}finally{i(!1)}})},[]),{user:e,userName:r,loading:a,logout:()=>m(null,null,function*(){yield Ee.logout(),t(null),n("")}),isAuthenticated:!!e}},Be=({tip:e="載入中...",style:t={}})=>o.jsx("div",{style:l({position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",background:"var(--bg-primary)",zIndex:9999},t),children:o.jsxs("div",{className:"glass-morphism animate-fadeInUp",style:{padding:"60px 40px",textAlign:"center",borderRadius:"20px",minWidth:"300px"},children:[o.jsx("div",{className:"animate-bounce",style:{marginBottom:"24px"},children:o.jsx("div",{className:"neon-glow",style:{width:"80px",height:"80px",borderRadius:"50%",background:"var(--primary-gradient)",margin:"0 auto",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"2rem",animation:"rotateIn 2s ease-out infinite"},children:"⚡"})}),o.jsx(b,{size:"large",style:{color:"var(--text-accent)"}}),o.jsx("div",{style:{marginTop:"24px",color:"var(--text-primary)",fontSize:"18px",fontWeight:600},children:e}),o.jsx("div",{style:{marginTop:"8px",color:"var(--text-secondary)",fontSize:"14px"},children:"請稍候片刻..."})]})}),Oe=({children:e})=>{const{isAuthenticated:t,loading:r}=$e();return r?o.jsx(Be,{}):t?e:o.jsx(se,{to:be,replace:!0})},Fe={projects:{getAll(){return m(this,null,function*(){const{data:e,error:t}=yield Te.from("home_project_card").select("*");return{data:e||[],error:t}})},getById(e){return m(this,null,function*(){const{data:t,error:r}=yield Te.from("home_project_card").select("*").eq("id",e).single();return{data:t,error:r}})},create(e){return m(this,null,function*(){const{data:t,error:r}=yield Te.from("home_project_card").insert([e]);return{data:t,error:r}})}},users:{getAll(){return m(this,null,function*(){const{data:e,error:t}=yield Te.from("user_names").select("user, email");return{data:e||[],error:t}})},getByEmail(e){return m(this,null,function*(){const{data:t,error:r}=yield Te.from("user_names").select("user").eq("email",e);return{data:t||[],error:r}})},create(e){return m(this,null,function*(){const{data:t,error:r}=yield Te.from("user_names").insert([e]);return{data:t,error:r}})},checkUsernameExists(e){return m(this,null,function*(){const{data:t,error:r}=yield Te.from("user_names").select("user").eq("user",e);return{exists:t&&t.length>0,error:r}})}},maintenanceData:{create(e){return m(this,null,function*(){const{data:t,error:r}=yield Te.from("maintainance_data").insert(e);return{data:t,error:r}})},getByProject(e){return m(this,null,function*(){const{data:t,error:r}=yield Te.from("maintainance_data").select("*").eq("project",e);return{data:t||[],error:r}})},getOptions(e){return m(this,null,function*(){const{data:t,error:r}=yield Te.from("maintainance_data").select("floor, thing, location").eq("project",e);return{data:t||[],error:r}})},delete(e){return m(this,null,function*(){const{data:t,error:r}=yield Te.from("maintainance_data").delete().eq("id",e);return{data:t,error:r}})}},maintenancePhoto:{getByProject(e){return m(this,null,function*(){const{data:t,error:r}=yield Te.from("maintainance_photo").select("*").eq("project",e).order("created_at",{ascending:!1}).limit(1e4);return{data:t||[],error:r}})},create(e){return m(this,null,function*(){try{const r=e,{files:n,addWatermark:a}=r,i=d(r,["files","addWatermark"]);if(!n||0===n.length)return{success:!1,error:"沒有檔案需要上傳"};const o=[];for(let e=0;e<n.length;e++){const r=n[e],s=r.name.split(".").pop(),d=`${Date.now()}_${e}.${s}`,m=`${i.project_name}/${d}`;let p=r.originFileObj||r;if(a&&p.type.startsWith("image/"))try{p=yield Fe.maintenancePhoto.addWatermarkToImage(p,i)}catch(t){}const{data:u,error:h}=yield Te.storage.from("maintainance-data-photo").upload(m,p);if(h)return{success:!1,error:`檔案上傳失敗: ${h.message}`};o.push(c(l({},i),{photo_path:m,photo_name:r.name}))}const{data:s,error:m}=yield Te.from("maintainance_photo").insert(o);return m?{success:!1,error:`資料庫插入失敗: ${m.message}`}:{success:!0,data:s}}catch(r){return{success:!1,error:r.message}}})},addWatermarkToImage(e,t){return m(this,null,function*(){return new Promise((r,n)=>{const a=document.createElement("canvas"),i=a.getContext("2d"),o=new Image;o.onload=()=>{try{a.width=o.width,a.height=o.height,i.drawImage(o,0,0);const s=Math.max(20,Math.min(o.width/25,50));i.font=`bold ${s}px Arial`,i.fillStyle="white",i.strokeStyle="black",i.lineWidth=4,i.textAlign="left",i.shadowColor="rgba(0, 0, 0, 0.8)",i.shadowBlur=4,i.shadowOffsetX=2,i.shadowOffsetY=2;const l=`${t.project_name||"N/A"} - ${t.floor||"N/A"} - ${t.thing||"N/A"} - ${t.location||"N/A"}`,c=`日期: ${t.maintainance_time||"N/A"} | 人員: ${t.maintainance_user||"N/A"}`,d=30,m=a.height-s-30,p=a.height-15;i.strokeText(l,d,m),i.fillText(l,d,m),i.strokeText(c,d,p),i.fillText(c,d,p),a.toBlob(t=>{if(t){const n=new File([t],e.name,{type:e.type,lastModified:Date.now()});r(n)}else n(new Error("Failed to create blob from canvas"))},e.type,.95)}catch(s){n(s)}},o.onerror=e=>{n(e)};const s=URL.createObjectURL(e);o.src=s,setTimeout(()=>{URL.revokeObjectURL(s)},1e4)})})},getByProject(e){return m(this,null,function*(){const{data:t,error:r}=yield Te.from("maintainance_photo").select("*").eq("project",e);return{data:t||[],error:r}})},getOptions(e){return m(this,null,function*(){const{data:t,error:r}=yield Te.from("maintainance_photo").select("floor, thing, location").eq("project",e);return r?{data:{floors:[],things:[],locations:[]},error:r}:{data:{floors:[...new Set(t.map(e=>e.floor).filter(Boolean))],things:[...new Set(t.map(e=>e.thing).filter(Boolean))],locations:[...new Set(t.map(e=>e.location).filter(Boolean))]},error:null}})},delete(e){return m(this,null,function*(){const{data:t,error:r}=yield Te.from("maintainance_photo").delete().eq("id",e);return{data:t,error:r}})}},maintenanceSettings:{getByProject(e){return m(this,null,function*(){const{data:t,error:r}=yield Te.from("maintainance_setting").select("*").eq("name",e).single();return{data:t,error:r}})},create(e){return m(this,null,function*(){const{data:t,error:r}=yield Te.from("maintainance_setting").insert(e);return{data:t,error:r}})},update(e,t){return m(this,null,function*(){const{data:r,error:n}=yield Te.from("maintainance_setting").upsert(t).eq("name",e);return{data:r,error:n}})}},storage:{getImageUrl(e,t){if(!t)return"";const{data:r}=Te.storage.from(e).getPublicUrl(t);return(null==r?void 0:r.publicUrl)||""},uploadFile(e,t,r){return m(this,null,function*(){const{data:n,error:a}=yield Te.storage.from(e).upload(t,r);return{data:n,error:a}})},deleteImage(e,t){return m(this,null,function*(){const{data:r,error:n}=yield Te.storage.from(e).remove([t]);return{data:r,error:n}})}}};var Ae,Ue,Pe,Le={},De=function(){if(Pe)return Ue;Pe=1;var e=function(){if(Ae)return Le;Ae=1,Le.match=function(e,t){return i(e).some(function(e){var r=e.inverse,n="all"===e.type||t.type===e.type;if(n&&r||!n&&!r)return!1;var a=e.expressions.every(function(e){var r=e.feature,n=e.modifier,a=e.value,i=t[r];if(!i)return!1;switch(r){case"orientation":case"scan":return i.toLowerCase()===a.toLowerCase();case"width":case"height":case"device-width":case"device-height":a=l(a),i=l(i);break;case"resolution":a=s(a),i=s(i);break;case"aspect-ratio":case"device-aspect-ratio":case"device-pixel-ratio":a=o(a),i=o(i);break;case"grid":case"color":case"color-index":case"monochrome":a=parseInt(a,10)||1,i=parseInt(i,10)||0}switch(n){case"min":return i>=a;case"max":return i<=a;default:return i===a}});return a&&!r||!a&&r})},Le.parse=i;var e=/(?:(only|not)?\s*([^\s\(\)]+)(?:\s*and)?\s*)?(.+)?/i,t=/\(\s*([^\s\:\)]+)\s*(?:\:\s*([^\s\)]+))?\s*\)/,r=/^(?:(min|max)-)?(.+)/,n=/(em|rem|px|cm|mm|in|pt|pc)?$/,a=/(dpi|dpcm|dppx)?$/;function i(n){return n.split(",").map(function(n){var a=(n=n.trim()).match(e),i=a[1],o=a[2],s=a[3]||"",l={};return l.inverse=!!i&&"not"===i.toLowerCase(),l.type=o?o.toLowerCase():"all",s=s.match(/\([^\)]+\)/g)||[],l.expressions=s.map(function(e){var n=e.match(t),a=n[1].toLowerCase().match(r);return{modifier:a[1],feature:a[2],value:n[2]}}),l})}function o(e){var t,r=Number(e);return r||(r=(t=e.match(/^(\d+)\s*\/\s*(\d+)$/))[1]/t[2]),r}function s(e){var t=parseFloat(e);switch(String(e).match(a)[1]){case"dpcm":return t/2.54;case"dppx":return 96*t;default:return t}}function l(e){var t=parseFloat(e);switch(String(e).match(n)[1]){case"em":case"rem":return 16*t;case"cm":return 96*t/2.54;case"mm":return 96*t/2.54/10;case"in":return 96*t;case"pt":return 72*t;case"pc":return 72*t/12;default:return t}}return Le}().match,t="undefined"!=typeof window?window.matchMedia:null;function r(r,n,a){var i,o=this;function s(e){o.matches=e.matches,o.media=e.media}t&&!a&&(i=t.call(window,r)),i?(this.matches=i.matches,this.media=i.media,i.addListener(s)):(this.matches=e(r,n),this.media=r),this.addListener=function(e){i&&i.addListener(e)},this.removeListener=function(e){i&&i.removeListener(e)},this.dispose=function(){i&&i.removeListener(s)}}return Ue=function(e,t,n){return new r(e,t,n)}}();const qe=h(De);var Me=/[A-Z]/g,Ye=/^ms-/,He={};function Ve(e){return"-"+e.toLowerCase()}function Ke(e){if(He.hasOwnProperty(e))return He[e];var t=e.replace(Me,Ve);return He[e]=Ye.test(t)?"-"+t:t}var Ge,Xe,Je,Qe,Ze,et={exports:{}};function tt(){return Xe?Ge:(Xe=1,Ge="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}function rt(){if(Qe)return Je;Qe=1;var e=tt();function t(){}function r(){}return r.resetWarningCache=t,Je=function(){function n(t,r,n,a,i,o){if(o!==e){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function a(){return n}n.isRequired=n;var i={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:a,element:n,elementType:n,instanceOf:a,node:n,objectOf:a,oneOf:a,oneOfType:a,shape:a,exact:a,checkPropTypes:r,resetWarningCache:t};return i.PropTypes=i,i}}function nt(){return Ze||(Ze=1,et.exports=rt()()),et.exports}const at=h(nt()),it=at.oneOfType([at.string,at.number]),ot={all:at.bool,grid:at.bool,aural:at.bool,braille:at.bool,handheld:at.bool,print:at.bool,projection:at.bool,screen:at.bool,tty:at.bool,tv:at.bool,embossed:at.bool},st={orientation:at.oneOf(["portrait","landscape"]),scan:at.oneOf(["progressive","interlace"]),aspectRatio:at.string,deviceAspectRatio:at.string,height:it,deviceHeight:it,width:it,deviceWidth:it,color:at.bool,colorIndex:at.bool,monochrome:at.bool,resolution:it,type:Object.keys(ot)},{type:lt}=st,ct=d(st,["type"]),dt=l({minAspectRatio:at.string,maxAspectRatio:at.string,minDeviceAspectRatio:at.string,maxDeviceAspectRatio:at.string,minHeight:it,maxHeight:it,minDeviceHeight:it,maxDeviceHeight:it,minWidth:it,maxWidth:it,minDeviceWidth:it,maxDeviceWidth:it,minColor:at.number,maxColor:at.number,minColorIndex:at.number,maxColorIndex:at.number,minMonochrome:at.number,maxMonochrome:at.number,minResolution:it,maxResolution:it},ct);var mt={all:l(l({},ot),dt)};const pt=e=>{const t=[];return Object.keys(mt.all).forEach(r=>{const n=e[r];null!=n&&t.push(((e,t)=>{const r=Ke(e);return"number"==typeof t&&(t=`${t}px`),!0===t?r:!1===t?`not ${r}`:`(${r}: ${t})`})(r,n))}),t.join(" and ")},ut=y.createContext(void 0),ht=e=>{if(e)return Object.keys(e).reduce((t,r)=>(t[Ke(r)]=e[r],t),{})},xt=()=>{const e=y.useRef(!1);return y.useEffect(()=>{e.current=!0},[]),e.current},gt=e=>{const t=y.useContext(ut),r=()=>ht(e)||ht(t),[n,a]=y.useState(r);return y.useEffect(()=>{const e=r();(function(e,t){if(e===t)return!0;if(!e||!t)return!1;const r=Object.keys(e),n=Object.keys(t),a=r.length;if(n.length!==a)return!1;for(let i=0;i<a;i++){const n=r[i];if(e[n]!==t[n]||!Object.prototype.hasOwnProperty.call(t,n))return!1}return!0})(n,e)||a(e)},[e,t]),n},ft=e=>{const t=()=>(e=>e.query||pt(e))(e),[r,n]=y.useState(t);return y.useEffect(()=>{const e=t();r!==e&&n(e)},[e]),r},yt=(e,t,r)=>{const n=gt(t),a=ft(e);if(!a)throw new Error("Invalid or missing MediaQuery!");const i=((e,t)=>{const r=()=>qe(e,t||{},!!t),[n,a]=y.useState(r),i=xt();return y.useEffect(()=>{if(i){const e=r();return a(e),()=>{e&&e.dispose()}}},[e,t]),n})(a,n),o=(e=>{const[t,r]=y.useState(e.matches);return y.useEffect(()=>{const t=e=>{r(e.matches)};return e.addListener(t),r(e.matches),()=>{e.removeListener(t)}},[e]),t})(i);return xt(),y.useEffect(()=>{},[o]),y.useEffect(()=>()=>{i&&i.dispose()},[]),o};function bt({projectName:e="",userName:t="",onUserClick:r=()=>{},onHomeClick:n=()=>{},customSideMenu:a=null,noShadow:i=!1,id:s=""}){const[l,c]=x.useState(!1),d=le();yt({maxWidth:767});const p=[{key:"profile",icon:o.jsx(_,{}),label:"設定使用者資料",onClick:r},{key:"logout",icon:o.jsx(N,{}),label:"登出",className:"logout-item",onClick:()=>m(null,null,function*(){yield Ee.logout(),d(be)}),style:{background:"var(--danger-gradient)",color:"white",borderRadius:"8px",margin:"4px 0",fontWeight:600}}],u=a||o.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[o.jsx(f,{className:"sidebar-menu-item",type:"text",icon:o.jsx(I,{}),onClick:()=>{c(!1),"/home"===window.location.pathname?window.location.reload():d("/home")},children:"主畫面"}),o.jsx("div",{style:{height:16}}),o.jsx(f,{className:"sidebar-menu-item",type:"text",icon:o.jsx(C,{}),onClick:()=>{c(!1),window.location.pathname===`/project/${s}`?window.location.reload():d(`/project/${s}`)},children:"本次季保養表單"}),o.jsx(f,{className:"sidebar-menu-item",type:"text",icon:o.jsx(R,{}),onClick:()=>{c(!1),window.location.pathname===`/project/${s}/addmaintainancedata`?window.location.reload():d(`/project/${s}/addmaintainancedata`)},children:"新增季保養資料"}),o.jsx(f,{className:"sidebar-menu-item",type:"text",icon:o.jsx(z,{}),onClick:()=>{c(!1),window.location.pathname===`/project/${s}/viewmaintainancedata`?window.location.reload():d(`/project/${s}/viewmaintainancedata`)},children:"查看季保養資料"}),o.jsx(f,{className:"sidebar-menu-item",type:"text",icon:o.jsx(W,{}),onClick:()=>{c(!1),window.location.pathname===`/project/${s}/export-excel`?window.location.reload():d(`/project/${s}/export-excel`)},children:"Excel匯出"}),o.jsx("div",{className:"sidebar-divider"}),o.jsx(f,{className:"sidebar-menu-item",type:"text",icon:o.jsx(_,{}),onClick:()=>{c(!1),window.location.pathname===`/project/${s}/season-setting`?window.location.reload():d(`/project/${s}/season-setting`)},children:"本次季保養設定"}),o.jsx(f,{className:"sidebar-menu-item",type:"text",icon:o.jsx(T,{}),onClick:()=>{c(!1),window.location.pathname===`/project/${s}/maintain-setting`?window.location.reload():d(`/project/${s}/maintain-setting`)},children:"保養資訊設定"}),o.jsx("div",{className:"sidebar-divider"}),o.jsx(f,{className:"sidebar-menu-item delete-all-data-btn",type:"text",icon:o.jsx(E,{}),onClick:()=>{$.confirm({title:"確認刪除所有季保養照片資料",icon:o.jsx(E,{}),content:"您確定要刪除所有季保養照片資料嗎？這將永久刪除 maintainance_photo 表中的所有記錄以及相關的照片文件，但會保留 maintainance_data 表中的保養記錄。此操作無法復原！",okText:"確認刪除",okType:"danger",cancelText:"取消",className:"modern-modal",onOk:()=>m(null,null,function*(){try{const{data:t,error:r}=yield Fe.maintenancePhoto.getByProject(e);if(r)throw r;for(const e of t)e.photo_path&&(yield Fe.storage.deleteImage("maintainance-data-photo",e.photo_path)),yield Fe.maintenancePhoto.delete(e.id);$.success({title:"刪除成功",content:"所有季保養照片資料已成功刪除！保養記錄已保留。",className:"custom-success-modal",onOk:()=>{c(!1),window.location.reload()}})}catch(t){$.error({title:"刪除失敗",content:`操作失敗: ${t.message||"未知錯誤"}`,className:"modern-modal"})}}),onCancel(){}})},style:{background:"var(--danger-gradient)",color:"white",borderRadius:"8px",margin:"4px 0",fontWeight:600,boxShadow:"var(--shadow-danger)",border:"1px solid var(--border-danger)",transition:"var(--transition-smooth)"},children:"刪除所有季保養照片資料"}),o.jsx("div",{style:{flex:1}}),o.jsx("div",{style:{textAlign:"center",marginTop:24},children:o.jsx(f,{className:"sidebar-menu-item",type:"text",icon:o.jsx(S,{}),onClick:r,children:t||"用戶"})})]});return o.jsxs(o.Fragment,{children:[o.jsxs(j.Header,{className:"modern-topbar",children:[o.jsx("div",{className:"topbar-left",children:o.jsx(f,{className:"menu-trigger-btn",type:"text",icon:o.jsx(v,{}),onClick:()=>c(!0)})}),o.jsx("div",{className:"topbar-center",style:{position:"absolute",left:"50%",transform:"translateX(-50%)",textAlign:"center"},children:o.jsx(g.Title,{className:"topbar-title",level:4,children:e})}),o.jsx("div",{className:"topbar-right",style:{marginLeft:"auto"},children:o.jsx(w,{menu:{items:p},trigger:["click"],placement:"bottomRight",popupRender:e=>o.jsx("div",{className:"user-dropdown",children:e}),children:o.jsx(f,{className:"user-menu-trigger",type:"text",icon:o.jsx(S,{}),children:t||"用戶"})})})]}),o.jsx(k,{title:"選單",className:"modern-sidebar",placement:"left",open:l,onClose:()=>{c(!1),setTimeout(()=>{window.location.reload()},100)},width:280,children:u})]})}const jt=({children:e,projectName:t,userName:r,projectId:n,customSideMenu:a,noShadow:i=!1,background:s="var(--bg-primary)"})=>o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"animated-bg"}),o.jsxs(j,{className:"page-enter",style:{minHeight:"100vh",background:s},children:[o.jsx(bt,{userName:r,projectName:t,id:n,customSideMenu:a,noShadow:i,onUserClick:()=>{},onHomeClick:()=>{}}),o.jsx(j.Content,{style:{padding:"32px 24px",minHeight:"calc(100vh - 70px)",background:"transparent",position:"relative",zIndex:1},children:o.jsx("div",{className:"animate-fadeInUp",children:e})})]})]}),vt=({project:e,onClick:t,style:r={}})=>{return o.jsx(B,{className:"modern-card interactive-click glass-morphism",hoverable:!0,cover:e.photo_path?o.jsxs("div",{style:{position:"relative",overflow:"hidden",borderRadius:"16px 16px 0 0"},children:[o.jsx("img",{alt:"cover",src:(n=e.photo_path,Fe.storage.getImageUrl("home-project-card-photo",n)),style:{height:160,width:"100%",objectFit:"cover",transition:"var(--transition-smooth)"}}),o.jsx("div",{className:"animate-shimmer",style:{position:"absolute",top:0,left:0,right:0,bottom:0,opacity:.3}})]}):o.jsx("div",{style:{height:160,background:"var(--accent-gradient)",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"16px 16px 0 0",position:"relative"},children:o.jsx(g.Title,{level:1,style:{color:"white",margin:0,textShadow:"0 2px 4px rgba(0,0,0,0.3)"},children:e.name.charAt(0)})}),onClick:()=>t(e),style:l({minHeight:320,height:"auto",cursor:"pointer",transition:"var(--transition-bounce)"},r),bodyStyle:{padding:"20px",background:"transparent"},children:o.jsx(B.Meta,{title:o.jsx(g.Title,{level:5,className:"gradient-text",style:{margin:0,fontSize:"1.2rem",fontWeight:600,marginBottom:"12px",whiteSpace:"normal",wordWrap:"break-word",lineHeight:1.3},children:e.name}),description:o.jsxs("div",{style:{animation:"fadeInUp 0.6s ease-out 0.2s both"},children:[o.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:14,marginBottom:8,fontWeight:500},children:["🏢 檢查單位：",e.unit]}),o.jsxs("div",{style:{color:"var(--text-muted)",fontSize:14,lineHeight:1.5,display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden"},children:["📋 檢查說明：",e.directions]})]})})});var n},wt=e=>{const[t,r]=y.useState(null),[n,a]=y.useState(!0),[i,o]=y.useState(null);return y.useEffect(()=>{m(null,null,function*(){if(e){a(!0),o(null);try{const{data:t,error:n}=yield Fe.projects.getById(e);n?(o(n),r(null)):r(t)}catch(t){o(t),r(null)}finally{a(!1)}}})},[e]),{project:t,loading:n,error:i}},St=()=>{const[e,t]=y.useState([]),[r,n]=y.useState(!0),[a,i]=y.useState(null);return y.useEffect(()=>{m(null,null,function*(){n(!0),i(null);try{const{data:e,error:r}=yield Fe.projects.getAll();r?i(r):t(e||[])}catch(e){i(e),t([])}finally{n(!1)}})},[]),{projects:e,loading:r,error:a}};function kt(){const e=le(),{userName:t}=$e(),{projects:r,loading:n}=St(),a=t=>{t&&t.id?e(`/project/${t.id}`):A.error("專案資料異常，無法跳轉")};if(n)return o.jsx(Be,{});const i=o.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[o.jsx("div",{className:"sidebar-title",children:fe}),o.jsx(f,{className:"sidebar-menu-item",type:"text",icon:o.jsx(_,{}),onClick:()=>A.info("尚未實作應用程式設定"),children:"應用程式設定"}),o.jsx("div",{style:{flex:1}}),o.jsx("div",{style:{textAlign:"center",marginTop:24},children:o.jsx(f,{className:"sidebar-menu-item",type:"text",icon:o.jsx(S,{}),onClick:()=>A.info("尚未實作用戶頁面"),children:t||"用戶"})})]});return o.jsx(jt,{userName:t,projectName:ge,customSideMenu:i,children:o.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto",padding:"20px"},children:[o.jsx("div",{className:"animate-fadeInUp",style:{marginBottom:"32px"},children:o.jsx(g.Title,{level:2,className:"gradient-text",style:{textAlign:"center",marginBottom:"8px",fontSize:"2.5rem",fontWeight:700},children:"季保養管理系統"})}),o.jsx(O,{gutter:[24,24],children:r.map((e,t)=>o.jsx(F,{xs:24,sm:12,md:8,lg:6,children:o.jsx("div",{className:"animate-scaleIn interactive-hover",style:{animationDelay:.1*t+"s",animationFillMode:"both"},children:o.jsx(vt,{project:e,onClick:a})})},e.id))}),0===r.length&&o.jsxs("div",{className:"animate-fadeInUp",style:{textAlign:"center",padding:"80px 20px",color:"var(--text-muted)"},children:[o.jsx(g.Title,{level:3,style:{color:"var(--text-muted)"},children:"暫無專案資料"}),o.jsx(g.Text,{children:"請聯繫管理員新增專案"})]})]})})}const _t=({message:e="發生錯誤",showBackButton:t=!0,onBack:r,backText:n="回主畫面"})=>o.jsxs("div",{className:"glass-morphism animate-fadeInUp",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",padding:"40px",textAlign:"center",color:"var(--text-primary)",margin:"20px",maxWidth:"500px",marginLeft:"auto",marginRight:"auto"},children:[o.jsx("div",{className:"animate-bounce",style:{marginBottom:"24px"},children:o.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:"var(--danger-gradient)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"2rem",color:"white",boxShadow:"var(--shadow-danger)",animation:"pulse 2s ease-in-out infinite"},children:"⚠️"})}),o.jsx(g.Title,{level:4,className:"gradient-text",style:{marginBottom:16,fontSize:"1.5rem"},children:e}),t&&o.jsxs(f,{type:"primary",onClick:()=>{r?r():window.location.href="/home"},size:"large",className:"interactive-click",style:{height:"48px",fontSize:"16px",fontWeight:600,borderRadius:"12px",background:"var(--primary-gradient)",border:"none",boxShadow:"var(--shadow-glow)",padding:"0 32px"},children:["🏠 ",n]})]}),Nt=({visible:e,onClose:t,success:r=!0,title:n="",message:a=""})=>{const i=r?"儲存成功":"儲存失敗",s=r?"資料已成功儲存！":"儲存過程中發生錯誤，請稍後再試。";return o.jsx($,{open:e,onCancel:t,footer:null,centered:!0,closable:!1,width:400,className:"save-result-modal",children:o.jsxs("div",{style:{textAlign:"center",padding:"20px 0"},children:[o.jsx("div",{className:"animate-scaleIn",style:{marginBottom:"20px"},children:r?o.jsx(U,{style:{fontSize:"64px",color:"var(--text-success)",animation:"successPulse 0.6s ease-out"}}):o.jsx(P,{style:{fontSize:"64px",color:"var(--text-danger)",animation:"errorShake 0.6s ease-out"}})}),o.jsx("h2",{style:{color:"var(--text-primary)",marginBottom:"12px",fontSize:"24px",fontWeight:600},children:n||i}),o.jsx("p",{style:{color:"var(--text-secondary)",marginBottom:"24px",fontSize:"16px",lineHeight:1.5},children:a||s}),o.jsx(f,{type:"primary",size:"large",onClick:t,className:"interactive-click",style:{height:"48px",fontSize:"16px",fontWeight:600,borderRadius:"12px",background:r?"var(--success-gradient)":"var(--primary-gradient)",border:"none",boxShadow:r?"var(--shadow-success)":"var(--shadow-glow)",padding:"0 32px"},children:"確定"})]})})};function It(){const{id:e}=ce(),t=le(),{userName:r}=$e(),{project:n,loading:a,error:i}=wt(e),[s]=L.useForm(),[l,c]=y.useState(!1),[d,p]=y.useState([]),[u,h]=y.useState([]),[x,g]=y.useState([]),[b,j]=y.useState([]),[v,w]=y.useState([]),[S,k]=y.useState(null),[N,I]=y.useState(""),[C,R]=y.useState(!0),[z,W]=y.useState(!1),[T,E]=y.useState(!1),[$,O]=y.useState(!1),[F,U]=y.useState(!0),[P,K]=y.useState("");y.useEffect(()=>{n&&(G(),X(),J(),s.setFieldsValue({maintainance_time:D().format("YYYY-MM-DD"),maintainance_user:r}))},[n,r,s]),y.useEffect(()=>()=>{N&&URL.revokeObjectURL(N)},[N]),y.useEffect(()=>{S&&C&&te()},[C]);const G=()=>m(null,null,function*(){try{const{data:e,error:t}=yield Fe.maintenanceSettings.getByProject(n.name);if(t&&"PGRST116"!==t.code)return;const r=D();if(e){if(e.time_start&&e.time_finish){const t=D(e.time_start),n=D(e.time_finish);(r.isBefore(t)||r.isAfter(n))&&(W(!0),E(!0))}}else W(!0),E(!0)}catch(e){}}),X=()=>m(null,null,function*(){try{const{data:e,error:t}=yield Fe.maintenanceData.getOptions(n.name);if(t)throw t;p(e)}catch(e){}}),J=()=>m(null,null,function*(){try{const{data:e,error:t}=yield Fe.maintenancePhoto.getByProject(n.name);if(t)throw t;const r=new Set(e.map(e=>`${e.floor}_${e.thing}_${e.location}`));j(Array.from(r))}catch(e){}}),Q=y.useCallback(()=>{const e=s.getFieldValue("floor"),t=s.getFieldValue("thing"),r=new Set(b);let n=[];e&&t?(n=d.filter(r=>r.floor===e&&r.thing===t).map(e=>e.location).filter(Boolean).filter(n=>{const a=`${e}_${t}_${n}`;return!r.has(a)}),g([...new Set(n)])):g([]);let a=[];if(e){const t=d.filter(t=>t.floor===e).map(e=>e.thing).filter(Boolean);a=[...new Set(t.filter(t=>d.filter(r=>r.floor===e&&r.thing===t).some(n=>{const a=`${e}_${t}_${n.location}`;return!r.has(a)})))],h(a)}else h([]);const i=new Set;d.forEach(e=>{const t=e.floor;t&&d.filter(e=>e.floor===t).map(e=>e.thing).filter(Boolean).some(e=>d.filter(r=>r.floor===t&&r.thing===e).some(n=>{const a=`${t}_${e}_${n.location}`;return!r.has(a)}))&&i.add(t)}),w(Array.from(i))},[d,s,b]);y.useEffect(()=>{n&&(d.length>0||b.length>0||0===d.length&&0===b.length)&&Q()},[d,b,Q,n]);const Z=e=>m(null,null,function*(){if(!C)return URL.createObjectURL(e);try{const t=s.getFieldsValue(),r=yield ne(e,t);return URL.createObjectURL(r)}catch(t){return URL.createObjectURL(e)}}),ee=e=>m(null,null,function*(){const t=e.target.files[0];if(t)if(t.type.startsWith("image/")){k(t);const e=yield Z(t);I(e)}else A.error("請選擇圖片檔案")}),te=()=>m(null,null,function*(){if(S){N&&URL.revokeObjectURL(N);const e=yield Z(S);I(e)}}),re=()=>{N&&URL.revokeObjectURL(N),k(null),I("")},ne=(e,t)=>m(null,null,function*(){return new Promise((r,a)=>{const i=document.createElement("canvas"),o=i.getContext("2d"),s=new Image;s.onload=()=>{try{i.width=s.width,i.height=s.height,o.drawImage(s,0,0);const l=[`案場名稱: ${(null==n?void 0:n.name)||t.project||""}`,`檢查項目: ${t.thing||""}`,`檢查位置: ${t.location||""}`,`檢查日期: ${t.maintainance_time||D().format("YYYY/MM/DD")}`],c=Math.max(16,Math.min(s.width/40,24)),d=c+4,m=20;o.font=`${c}px Arial`;const p=Math.max(...l.map(e=>o.measureText(e).width))+2*m,u=l.length*d+2*m,h=i.width-p-20,x=i.height-u;o.fillStyle="rgba(128, 128, 128, 0.8)",o.fillRect(h,x,p,u),o.font=`${c}px Arial`,o.fillStyle="white",o.textAlign="left",o.textBaseline="top",l.forEach((e,t)=>{const r=h+m,n=x+m+t*d;o.fillText(e,r,n)}),i.toBlob(t=>{if(t){const n=new File([t],e.name,{type:e.type});r(n)}else a(new Error("無法創建浮水印圖片"))},e.type,.9)}catch(l){a(l)}},s.onerror=()=>a(new Error("圖片載入失敗")),s.src=URL.createObjectURL(e)})});return a?o.jsx(Be,{}):i||!n?o.jsx(_t,{message:"找不到專案資料",onBack:()=>t(ye)}):o.jsx(jt,{userName:r,projectName:n.name,projectId:e,children:o.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto",padding:"20px"},children:[z&&o.jsx(q,{message:"保養設定提醒",description:"此專案尚未設定保養期間或目前不在保養期間內，請先進行設定。",type:"warning",showIcon:!0,icon:o.jsx(M,{}),style:{marginBottom:16},action:o.jsx(f,{size:"small",type:"primary",onClick:()=>t(`${Se}/${e}`),children:"前往設定"})}),o.jsx(B,{className:"modern-card glass-morphism animate-fadeInUp",title:o.jsxs("div",{style:{fontSize:"1.8rem",fontWeight:700,display:"flex",alignItems:"center",gap:"12px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",textShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[o.jsx("span",{style:{fontSize:"2rem",filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.2))"},children:"🔧"}),"季保養作業系統"]}),style:{marginBottom:32,background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"16px",boxShadow:"0 8px 32px rgba(0,0,0,0.1)"},children:o.jsxs(L,{form:s,layout:"vertical",onFinish:e=>m(null,null,function*(){if(S){c(!0);try{let t=S;C&&(t=yield ne(S,e));const a=t.name.split(".").pop(),i=`${Date.now()}.${a}`,o=`${n.id}/${i}`,{data:l,error:c}=yield Te.storage.from("maintainance-data-photo").upload(o,t);if(c)throw new Error(`照片上傳失敗: ${c.message}`);const{data:d,error:m}=yield Te.from("maintainance_data").select("company, direction").eq("project",n.name).eq("floor",e.floor).eq("thing",e.thing).eq("location",e.location).single(),p={project:n.name,floor:e.floor,thing:e.thing,location:e.location,maintainance_user:e.maintainance_user,maintainance_time:e.maintainance_time,photo_path:o,direction:(null==d?void 0:d.direction)||"季保養檢查",company:(null==d?void 0:d.company)||"維護公司"},{data:u,error:h}=yield Te.from("maintainance_photo").insert(p);if(h)throw new Error(`資料庫儲存失敗: ${h.message}`);h?(U(!1),K((null==h?void 0:h.message)||"儲存失敗，請重試")):(U(!0),K("保養資料已成功儲存！"),s.resetFields(),s.setFieldsValue({maintainance_time:D().format("YYYY-MM-DD"),maintainance_user:r}),re(),yield J()),O(!0)}catch(t){U(!1),K(t.message||"儲存失敗，請重試"),O(!0)}finally{c(!1)}}else A.error("請選擇一張照片")}),onValuesChange:(e,t)=>{"floor"in e&&s.setFieldsValue({thing:void 0,location:void 0}),"thing"in e&&s.setFieldsValue({location:void 0}),Q(),S&&C&&setTimeout(()=>te(),100)},disabled:T,className:"animate-slideInLeft",style:{maxWidth:"700px",margin:"0 auto",animationDelay:"0.2s",animationFillMode:"both",padding:"20px"},children:[o.jsx(L.Item,{label:o.jsxs("span",{style:{color:"var(--text-primary)",fontWeight:600,fontSize:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx("span",{style:{fontSize:"20px"},children:"🏢"}),"樓層選擇"]}),name:"floor",rules:[{required:!0,message:"請選擇樓層"}],children:o.jsx(Y,{placeholder:"🔍 請選擇樓層",options:v.map(e=>({label:e,value:e})),style:{width:"100%",height:"48px"},className:"modern-select"})}),o.jsx(L.Item,{label:o.jsxs("span",{style:{color:"var(--text-primary)",fontWeight:600,fontSize:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx("span",{style:{fontSize:"20px"},children:"🔍"}),"檢查項目"]}),name:"thing",rules:[{required:!0,message:"請選擇檢查項目"}],children:o.jsx(Y,{placeholder:"⚙️ 請選擇檢查項目",options:u.map(e=>({label:e,value:e})),style:{width:"100%",height:"48px"},className:"modern-select"})}),o.jsx(L.Item,{label:o.jsxs("span",{style:{color:"var(--text-primary)",fontWeight:600,fontSize:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx("span",{style:{fontSize:"20px"},children:"📍"}),"檢查位置"]}),name:"location",rules:[{required:!0,message:"請選擇檢查位置"}],children:o.jsx(Y,{placeholder:"🎯 請選擇檢查位置",options:x.map(e=>({label:e,value:e})),style:{width:"100%",height:"48px"},className:"modern-select"})}),o.jsx(L.Item,{label:o.jsxs("span",{style:{color:"var(--text-primary)",fontWeight:600,fontSize:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx("span",{style:{fontSize:"20px"},children:"📅"}),"保養日期"]}),name:"maintainance_time",rules:[{required:!0,message:"請輸入保養日期"}],children:o.jsxs("div",{style:{position:"relative"},children:[o.jsx("input",{type:"date",value:s.getFieldValue("maintainance_time")||"",onChange:e=>s.setFieldValue("maintainance_time",e.target.value),style:{width:"100%",height:"48px",padding:"12px 16px",border:"2px solid #e1e5e9",borderRadius:"12px",fontSize:"16px",fontWeight:"500",background:"rgba(255,255,255,0.8)",backdropFilter:"blur(10px)",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",color:"#333",colorScheme:"none",appearance:"none",WebkitAppearance:"none",MozAppearance:"textfield"},onFocus:e=>{e.target.style.borderColor="#667eea",e.target.style.boxShadow="0 0 0 3px rgba(102, 126, 234, 0.1)",e.target.style.background="rgba(102, 126, 234, 0.05)"},onBlur:e=>{e.target.style.borderColor="#e1e5e9",e.target.style.boxShadow="0 2px 8px rgba(0,0,0,0.05)",e.target.style.background="rgba(255,255,255,0.8)"}}),o.jsx("style",{jsx:!0,children:'\n                  input[type="date"]::-webkit-calendar-picker-indicator {\n                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                    border-radius: 6px;\n                    padding: 4px;\n                    cursor: pointer;\n                    filter: invert(1);\n                  }\n                  input[type="date"]::-webkit-calendar-picker-indicator:hover {\n                    background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);\n                    transform: scale(1.1);\n                  }\n                  input[type="date"]::-webkit-inner-spin-button,\n                  input[type="date"]::-webkit-outer-spin-button {\n                    -webkit-appearance: none;\n                    margin: 0;\n                  }\n                '})]})}),o.jsx(L.Item,{label:o.jsxs("span",{style:{color:"var(--text-primary)",fontWeight:600,fontSize:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx("span",{style:{fontSize:"20px"},children:"👤"}),"保養人員"]}),name:"maintainance_user",rules:[{required:!0,message:"請輸入保養人員"}],children:o.jsx("input",{type:"text",placeholder:"👨‍🔧 請輸入保養人員姓名",value:s.getFieldValue("maintainance_user")||"",onChange:e=>s.setFieldValue("maintainance_user",e.target.value),style:{width:"100%",height:"48px",padding:"12px 16px",border:"2px solid #e1e5e9",borderRadius:"12px",fontSize:"16px",fontWeight:"500",background:"rgba(255,255,255,0.8)",backdropFilter:"blur(10px)",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",color:"#333"},onFocus:e=>{e.target.style.borderColor="#667eea",e.target.style.boxShadow="0 0 0 3px rgba(102, 126, 234, 0.1)",e.target.style.background="rgba(102, 126, 234, 0.05)"},onBlur:e=>{e.target.style.borderColor="#e1e5e9",e.target.style.boxShadow="0 2px 8px rgba(0,0,0,0.05)",e.target.style.background="rgba(255,255,255,0.8)"}})}),o.jsx(L.Item,{label:o.jsxs("span",{style:{color:"var(--text-primary)",fontWeight:600,fontSize:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx("span",{style:{fontSize:"20px"},children:"📷"}),"照片上傳"]}),required:!0,children:o.jsx("div",{style:{border:S?"3px solid #52c41a":"3px dashed #667eea",borderRadius:"16px",padding:"24px",textAlign:"center",background:S?"linear-gradient(135deg, rgba(82, 196, 26, 0.1) 0%, rgba(82, 196, 26, 0.05) 100%)":"linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.05) 100%)",backdropFilter:"blur(10px)",transition:"all 0.3s ease",boxShadow:S?"0 8px 32px rgba(82, 196, 26, 0.2)":"0 8px 32px rgba(102, 126, 234, 0.1)",position:"relative",overflow:"hidden"},children:S?o.jsxs("div",{style:{position:"relative"},children:[o.jsxs("div",{style:{position:"relative",width:"100%",paddingBottom:"75%",overflow:"hidden",borderRadius:"12px",boxShadow:"0 4px 16px rgba(0,0,0,0.1)",cursor:"pointer",transition:"all 0.3s ease"},onClick:()=>document.getElementById("photo-upload").click(),onMouseEnter:e=>{e.currentTarget.style.transform="scale(1.02)",e.currentTarget.style.boxShadow="0 8px 24px rgba(0,0,0,0.15)"},onMouseLeave:e=>{e.currentTarget.style.transform="scale(1)",e.currentTarget.style.boxShadow="0 4px 16px rgba(0,0,0,0.1)"},children:[o.jsx("img",{src:N,alt:"預覽",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",borderRadius:"12px"}}),o.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",opacity:0,transition:"opacity 0.3s ease"},onMouseEnter:e=>{e.currentTarget.style.opacity="1"},onMouseLeave:e=>{e.currentTarget.style.opacity="0"},children:o.jsxs("div",{style:{color:"white",fontSize:"18px",fontWeight:"600",textAlign:"center"},children:[o.jsx("div",{style:{fontSize:"32px",marginBottom:"8px"},children:"📸"}),"點擊重新選擇照片"]})}),o.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),re()},style:{position:"absolute",top:"12px",right:"12px",width:"36px",height:"36px",borderRadius:"50%",border:"none",background:"rgba(255, 77, 79, 0.9)",color:"white",cursor:"pointer",fontSize:"20px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(255, 77, 79, 0.4)",zIndex:10,transition:"all 0.3s ease"},onMouseEnter:e=>{e.target.style.transform="scale(1.1)",e.target.style.boxShadow="0 6px 16px rgba(255, 77, 79, 0.6)"},onMouseLeave:e=>{e.target.style.transform="scale(1)",e.target.style.boxShadow="0 4px 12px rgba(255, 77, 79, 0.4)"},children:"×"})]}),o.jsx("div",{style:{marginTop:"16px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:o.jsxs("div",{style:{fontSize:"16px",color:"#52c41a",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx("span",{style:{fontSize:"20px"},children:"✅"}),S.name]})}),o.jsx("input",{type:"file",accept:"image/*",onChange:ee,style:{display:"none"},id:"photo-upload"})]}):o.jsxs("div",{children:[o.jsx("input",{type:"file",accept:"image/*",onChange:ee,style:{display:"none"},id:"photo-upload"}),o.jsxs("label",{htmlFor:"photo-upload",style:{cursor:"pointer",display:"block",padding:"32px",transition:"all 0.3s ease"},onMouseEnter:e=>{e.currentTarget.style.transform="scale(1.02)"},onMouseLeave:e=>{e.currentTarget.style.transform="scale(1)"},children:[o.jsx("div",{style:{fontSize:"64px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",marginBottom:"20px",filter:"drop-shadow(0 4px 8px rgba(0,0,0,0.1))"},children:"📸"}),o.jsx("div",{style:{fontSize:"20px",fontWeight:600,color:"#667eea",marginBottom:"8px"},children:"點擊上傳照片"}),o.jsx("div",{style:{fontSize:"14px",color:"#8c8c8c",fontWeight:500},children:"支援 JPG、PNG、WEBP 等格式"}),o.jsx("div",{style:{marginTop:"16px",padding:"8px 16px",background:"rgba(102, 126, 234, 0.1)",borderRadius:"20px",display:"inline-block",fontSize:"12px",color:"#667eea",fontWeight:600},children:"✨ 支援自動浮水印"})]})]})})}),o.jsx(L.Item,{children:o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",padding:"20px",background:C?"linear-gradient(135deg, rgba(82, 196, 26, 0.1) 0%, rgba(82, 196, 26, 0.05) 100%)":"linear-gradient(135deg, rgba(140, 140, 140, 0.1) 0%, rgba(140, 140, 140, 0.05) 100%)",borderRadius:"16px",border:C?"2px solid #52c41a":"2px solid #d9d9d9",transition:"all 0.3s ease",boxShadow:C?"0 4px 16px rgba(82, 196, 26, 0.2)":"0 4px 16px rgba(0,0,0,0.05)",cursor:"pointer"},onClick:()=>R(!C),children:[o.jsx("div",{style:{width:"24px",height:"24px",borderRadius:"6px",background:C?"linear-gradient(135deg, #52c41a 0%, #389e0d 100%)":"#d9d9d9",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s ease",boxShadow:C?"0 2px 8px rgba(82, 196, 26, 0.3)":"none"},children:C&&o.jsx("span",{style:{color:"white",fontSize:"14px",fontWeight:"bold"},children:"✓"})}),o.jsxs("label",{style:{color:"var(--text-primary)",fontWeight:600,cursor:"pointer",margin:0,fontSize:"16px",flex:1},children:[o.jsx("span",{style:{fontSize:"20px",marginRight:"8px"},children:"🏷️"}),"自動添加浮水印",o.jsx("div",{style:{fontSize:"14px",color:"#8c8c8c",marginTop:"4px",fontWeight:400},children:"包含案場名稱、檢查項目、位置、日期等資訊"})]})]})}),o.jsx(L.Item,{style:{marginTop:"32px"},children:o.jsx(f,{type:"primary",htmlType:"submit",loading:l,disabled:T,icon:o.jsx(H,{style:{fontSize:"20px"}}),size:"large",style:{width:"100%",height:"64px",fontSize:"18px",fontWeight:700,background:l?"linear-gradient(135deg, #bfbfbf 0%, #8c8c8c 100%)":"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none",borderRadius:"16px",boxShadow:l?"0 4px 16px rgba(0,0,0,0.1)":"0 8px 32px rgba(102, 126, 234, 0.4)",transition:"all 0.3s ease",position:"relative",overflow:"hidden"},onMouseEnter:e=>{l||T||(e.target.style.transform="translateY(-2px)",e.target.style.boxShadow="0 12px 40px rgba(102, 126, 234, 0.5)")},onMouseLeave:e=>{l||T||(e.target.style.transform="translateY(0)",e.target.style.boxShadow="0 8px 32px rgba(102, 126, 234, 0.4)")},children:o.jsx("span",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px"},children:l?o.jsxs(o.Fragment,{children:[o.jsx("span",{style:{display:"inline-block",width:"20px",height:"20px",border:"2px solid #ffffff",borderTop:"2px solid transparent",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"正在儲存資料..."]}):o.jsxs(o.Fragment,{children:[o.jsx(H,{style:{fontSize:"20px"}}),"💾 儲存保養資料"]})})})})]})}),o.jsx(V,{icon:o.jsx(_,{}),tooltip:"專案設定",onClick:()=>t(`${Se}/${e}`),style:{right:24,bottom:24}}),o.jsx(Nt,{visible:$,success:F,message:P,onClose:()=>O(!1)})]})})}function Ct(){const{id:e}=ce(),[t,r]=y.useState(!1),[n,a]=y.useState(!1),[i,s]=y.useState(!0),[d,p]=y.useState(""),[u,h]=y.useState({}),[x,g]=y.useState({name:"",unit:"",directions:""}),[b,j]=y.useState(""),[v,w]=y.useState(!1),S=le();return y.useEffect(()=>{m(null,null,function*(){r(!0);let e=null,t=null;try{const{data:r,error:n}=yield Te.auth.getUser();e=r,t=n}catch(i){}if(null==e?void 0:e.user){const t=e.user.email;if(t)try{const{data:e,error:r}=yield Te.from("user_names").select("user").eq("email",t).single();!r&&e&&e.user?j(e.user):j(t||"用戶")}catch(i){j(t||"用戶")}else j("用戶")}else j("用戶");const{data:n}=yield Te.from("home_project_card").select("name, unit, directions").eq("id",1).single();if(n){g({name:n.name||"",unit:n.unit||"",directions:n.directions||""});try{yield Te.from("maintainance_setting").upsert({name:n.name})}catch(i){}}const{data:a}=yield Te.from("maintainance_setting").select("*").eq("project_id",1).single();a&&h({year_q:a.year_q||"",time_start:a.time_start?D(a.time_start):null,time_finish:a.time_finish?D(a.time_finish):null}),r(!1)})},[]),o.jsxs("div",{style:{minHeight:"100vh",width:"100vw",background:"var(--background-color)",display:"flex",flexDirection:"column"},children:[o.jsx(bt,{userName:b,projectName:x.name,id:e,onUserClick:()=>S("/home"),onHomeClick:()=>S("/home"),onHistory:()=>{},onSeasonSetting:()=>{},onInfoSetting:()=>{S(`/project/${e}/maintain-setting`)},drawerOpen:v,setDrawerOpen:w}),o.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:x.name||x.unit||x.directions?o.jsxs(B,{className:"glass-morphism animate-fadeInUp",style:{width:440,borderRadius:16,boxShadow:"var(--shadow-intense)",background:"var(--bg-glass)",backdropFilter:"blur(20px)",border:"1px solid var(--border-primary)"},children:[o.jsx("h2",{className:"gradient-text",style:{textAlign:"center",marginBottom:24,fontSize:"1.5rem",fontWeight:600},children:"⚙️ 本次季保養設定"}),o.jsxs(L,{layout:"vertical",initialValues:c(l({},u),{name:x.name,unit:x.unit,directions:x.directions}),onFinish:e=>m(null,null,function*(){r(!0);const t={name:x.name,year_q:e.year_q,time_start:e.time_start?e.time_start.format("YYYY-MM-DD"):null,time_finish:e.time_finish?e.time_finish.format("YYYY-MM-DD"):null},{error:n}=yield Te.from("maintainance_setting").upsert(t,{onConflict:["name","year_q"]});n?(s(!1),p("儲存失敗"),a(!0)):(s(!0),p("儲存成功"),a(!0)),r(!1)}),children:[o.jsx(L.Item,{label:o.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"🏢 案場名稱"}),name:"name",children:o.jsx(K,{disabled:!0,style:{height:"48px",borderRadius:"12px",fontSize:"16px",background:"var(--bg-secondary)",color:"var(--text-secondary)"}})}),o.jsx(L.Item,{label:o.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"🏭 檢查單位"}),name:"unit",children:o.jsx(K,{disabled:!0,style:{height:"48px",borderRadius:"12px",fontSize:"16px",background:"var(--bg-secondary)",color:"var(--text-secondary)"}})}),o.jsx(L.Item,{label:o.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"📋 檢查說明"}),name:"directions",children:o.jsx(K.TextArea,{disabled:!0,autoSize:!0,style:{borderRadius:"12px",fontSize:"16px",background:"var(--bg-secondary)",color:"var(--text-secondary)"}})}),o.jsx(L.Item,{label:o.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"📊 季別"}),name:"year_q",rules:[{required:!0,message:"請輸入季別"}],children:o.jsx(K,{placeholder:"例如：2024 Q3",className:"interactive-hover",style:{height:"48px",borderRadius:"12px",fontSize:"16px"}})}),o.jsx(L.Item,{label:o.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"📅 保養時間起"}),name:"time_start",rules:[{required:!0,message:"請選擇保養開始時間"}],children:o.jsx(G,{style:{width:"100%",height:"48px",borderRadius:"12px"},format:"YYYY-MM-DD",className:"interactive-hover"})}),o.jsx(L.Item,{label:o.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"📅 保養時間迄"}),name:"time_finish",rules:[{required:!0,message:"請選擇保養結束時間"}],children:o.jsx(G,{style:{width:"100%",height:"48px",borderRadius:"12px"},format:"YYYY-MM-DD",className:"interactive-hover"})}),o.jsx(L.Item,{children:o.jsx(f,{type:"primary",htmlType:"submit",block:!0,loading:t,className:"interactive-click neon-glow",style:{height:"52px",fontSize:"18px",fontWeight:600,borderRadius:"12px",background:"var(--success-gradient)",border:"none",boxShadow:"var(--shadow-success)"},children:"儲存設定"})}),o.jsx(L.Item,{children:o.jsx(f,{danger:!0,block:!0,className:"interactive-click",onClick:()=>m(null,null,function*(){if(!x.name)return s(!1),p("找不到案場名稱"),void a(!0);r(!0);try{const{error:e}=yield Te.from("maintainance_setting").delete().eq("name",x.name);e?(s(!1),p("重置失敗"),a(!0)):(s(!0),p("已重置所有保養時間"),a(!0))}catch(e){s(!1),p("重置時發生錯誤"),a(!0)}r(!1)}),style:{marginTop:16,background:"var(--danger-gradient)",borderColor:"transparent",boxShadow:"var(--shadow-danger)",animation:"redGlow 2s ease-in-out infinite",fontWeight:600,height:"48px",borderRadius:"12px"},children:"🗑️ 重置此案場的所有保養時間"})})]},x.name+x.unit+x.directions+(u.year_q||""))]}):o.jsx(Be,{tip:"載入專案資料中..."})}),o.jsx(Nt,{visible:n,onClose:()=>a(!1),success:i,message:d})]})}function Rt(){const{id:e}=ce(),[t,r]=y.useState(!1),[n,a]=y.useState({}),[i,s]=y.useState({name:"",unit:"",directions:""}),[d,p]=y.useState(""),[u,h]=y.useState(!1),[x,g]=y.useState(!1),[b,j]=y.useState(""),[v,w]=y.useState("success"),[S,k]=y.useState(null),[_,N]=y.useState(null),[I,C]=y.useState(null),R=y.useRef(),z=le();return y.useEffect(()=>{m(null,null,function*(){r(!0);let e=null,t=null;try{const{data:r,error:n}=yield Te.auth.getUser();e=r,t=n}catch(i){t=i}let n=e&&e.user?e.user.email:null;if(n)try{const{data:e,error:t}=yield Te.from("user_names").select("user").eq("email",n).single();!t&&e&&e.user?p(e.user):p(n||"用戶")}catch(i){p(n||"用戶")}else p("用戶");const{data:a}=yield Te.from("home_project_card").select("name, unit, directions, photo_path").eq("id",1).single();if(a&&(s(a),a.photo_path)){C(a.photo_path);try{const{data:e}=Te.storage.from("home-project-card-photo").getPublicUrl(a.photo_path);(null==e?void 0:e.publicUrl)&&k(e.publicUrl)}catch(o){}}r(!1)})},[]),o.jsxs(o.Fragment,{children:[o.jsx($,{open:x,onOk:()=>g(!1),onCancel:()=>g(!1),okText:"確認",cancelButtonProps:{style:{display:"none"}},centered:!0,className:"success"===v?"custom-success-modal":"modern-modal",bodyStyle:{textAlign:"center",fontSize:18,padding:32},title:"success"===v?"成功":"錯誤",afterClose:()=>{},children:b}),o.jsxs("div",{style:{minHeight:"100vh",width:"100vw",background:"var(--background-color)",display:"flex",flexDirection:"column"},children:[o.jsx(bt,{projectName:i.name||"載入中...",userName:d,id:e,onHomeClick:()=>z("/home"),drawerOpen:u,setDrawerOpen:h}),o.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:i.name||i.unit||i.directions?o.jsxs(B,{className:"glass-morphism animate-fadeInUp",style:{width:440,borderRadius:16,boxShadow:"var(--shadow-intense)",background:"var(--bg-glass)",backdropFilter:"blur(20px)",border:"1px solid var(--border-primary)"},children:[o.jsx("h2",{className:"gradient-text",style:{textAlign:"center",marginBottom:24,fontSize:"1.5rem",fontWeight:600},children:"🔧 保養資訊設定"}),o.jsxs(L,{layout:"vertical",initialValues:c(l({},n),{name:i.name,unit:i.unit,directions:i.directions}),onFinish:t=>m(null,null,function*(){r(!0);const{name:n,unit:a,directions:i}=t,o=e||1;try{yield(e=>m(null,null,function*(){try{const{data:t,error:r}=yield Te.storage.from("home-project-card-photo").list(e.toString());if(r)return;if(t&&t.length>0){const r=t.map(t=>`${e}/${t.name}`),{error:n}=yield Te.storage.from("home-project-card-photo").remove(r)}}catch(t){}}))(o);let e="";_&&(e=yield((e,r)=>m(null,null,function*(){try{const t=Date.now(),n=r.name.split(".").pop(),a=`${e}/project_${e}_${t}.${n}`,{error:i}=yield Te.storage.from("home-project-card-photo").upload(a,r);if(i)throw i;return a}catch(t){throw t}}))(o,_));const{error:t}=yield Te.from("home_project_card").update({name:n,unit:a,directions:i,photo_path:e}).eq("id",o);if(t)setSaveSuccess(!1),j(`儲存失敗：${t.message||"未知錯誤"}`),setSaveResultVisible(!0);else if(setSaveSuccess(!0),j("保養資訊已儲存，照片已更新"),setSaveResultVisible(!0),s({name:n,unit:a,directions:i}),C(e),N(null),e)try{const{data:t}=Te.storage.from("home-project-card-photo").getPublicUrl(e);(null==t?void 0:t.publicUrl)&&k(t.publicUrl)}catch(l){}else k(null)}catch(c){setSaveSuccess(!1),j(`處理失敗：${c.message||"未知錯誤"}`),setSaveResultVisible(!0)}finally{r(!1)}}),children:[o.jsx(L.Item,{label:o.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"🏢 案場名稱"}),name:"name",rules:[{required:!0,message:"請輸入案場名稱"}],children:o.jsx(K,{name:"name",className:"interactive-hover",style:{height:"48px",borderRadius:"12px",fontSize:"16px"}})}),o.jsx(L.Item,{label:o.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"🏭 檢查單位"}),name:"unit",rules:[{required:!0,message:"請輸入檢查單位"}],children:o.jsx(K,{name:"unit",className:"interactive-hover",style:{height:"48px",borderRadius:"12px",fontSize:"16px"}})}),o.jsx(L.Item,{label:o.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"📋 檢查說明"}),name:"directions",children:o.jsx(K.TextArea,{name:"directions",autoSize:!0,className:"interactive-hover",style:{borderRadius:"12px",fontSize:"16px"}})}),o.jsxs(L.Item,{label:o.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"📸 上傳案場圖片"}),children:[o.jsx("div",{className:"interactive-hover",style:{border:"2px dashed var(--border-primary)",borderRadius:"12px",padding:"20px",textAlign:"center",background:"var(--bg-tertiary)",cursor:"pointer",transition:"var(--transition-smooth)",minHeight:"120px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},onClick:()=>{var e;return null==(e=R.current)?void 0:e.click()},children:S?o.jsx("img",{src:S,alt:"案場圖片預覽",style:{maxWidth:"100%",maxHeight:"200px",borderRadius:"8px",objectFit:"cover"}}):o.jsxs("div",{className:"animate-bounce",style:{color:"var(--text-accent)",display:"flex",flexDirection:"column",alignItems:"center",gap:"8px"},children:[o.jsx("div",{style:{fontSize:"2rem"},children:"📸"}),o.jsx("div",{style:{fontWeight:500},children:"點擊上傳案場圖片"})]})}),o.jsx("input",{ref:R,type:"file",accept:"image/*",capture:"environment",style:{display:"none"},onChange:e=>{const t=e.target.files[0];if(t){N(t);const e=new FileReader;e.onload=e=>{k(e.target.result)},e.readAsDataURL(t)}else{if(I)try{const{data:e}=Te.storage.from("home-project-card-photo").getPublicUrl(I);(null==e?void 0:e.publicUrl)&&k(e.publicUrl)}catch(r){k(null)}else k(null);N(null)}}})]}),o.jsx(L.Item,{children:o.jsx(f,{type:"primary",htmlType:"submit",block:!0,loading:t,className:"interactive-click neon-glow",style:{height:"52px",fontSize:"18px",fontWeight:600,borderRadius:"12px",background:"var(--success-gradient)",border:"none",boxShadow:"var(--shadow-success)"},children:"儲存設定"})})]},i.name+i.unit+i.directions+(n.year_q||""))]}):o.jsx(Be,{tip:"載入專案資料中..."})})]})]})}function zt({onRegisterSuccess:e}){const[t]=L.useForm(),[r,n]=y.useState(""),[a,i]=y.useState(!1);return o.jsxs("div",{style:{textAlign:"center",marginBottom:"32px"},children:[o.jsx("div",{className:"neon-glow animate-rotateIn",style:{width:"80px",height:"80px",borderRadius:"50%",background:"var(--success-gradient)",margin:"0 auto 24px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"2rem",fontWeight:"bold",color:"white"},children:"👤"}),o.jsx(g.Title,{level:2,className:"gradient-text",style:{marginBottom:"8px",fontSize:"2rem",fontWeight:700},children:"註冊新帳號"}),o.jsxs(L,{form:t,layout:"vertical",onFinish:t=>m(null,null,function*(){n("");const{email:r,password:a,confirmPassword:o}=t;if(!r||!a||!o)return void n("所有欄位皆必填");if(a!==o)return void n("密碼與確認密碼不一致");i(!0);const{error:s}=yield Te.auth.signUp({email:r,password:a});if(s)return n(s.message),void i(!1);i(!1),e&&e()}),className:"animate-fadeInUp",style:{marginTop:"24px",animationDelay:"0.3s",animationFillMode:"both"},children:[o.jsx(L.Item,{label:o.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"📧 Email"}),name:"email",rules:[{required:!0,message:"請輸入Email"},{type:"email",message:"Email格式錯誤"}],children:o.jsx(K,{placeholder:"請輸入您的Email",className:"interactive-hover",style:{height:"48px",borderRadius:"12px",fontSize:"16px"}})}),o.jsx(L.Item,{label:o.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"🔒 密碼"}),name:"password",rules:[{required:!0,message:"請輸入密碼"}],children:o.jsx(K.Password,{placeholder:"請輸入密碼",className:"interactive-hover",style:{height:"48px",borderRadius:"12px",fontSize:"16px"}})}),o.jsx(L.Item,{label:o.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"🔐 確認密碼"}),name:"confirmPassword",dependencies:["password"],rules:[{required:!0,message:"請再次輸入密碼"},({getFieldValue:e})=>({validator:(t,r)=>r&&e("password")!==r?Promise.reject(new Error("密碼與確認密碼不一致")):Promise.resolve()})],children:o.jsx(K.Password,{placeholder:"請再次輸入密碼",className:"interactive-hover",style:{height:"48px",borderRadius:"12px",fontSize:"16px"}})}),r&&o.jsxs("div",{className:"animate-slideInLeft",style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid var(--border-danger)",borderRadius:"12px",padding:"12px 16px",color:"var(--text-danger)",marginBottom:"24px",textAlign:"center",fontWeight:500,backdropFilter:"blur(10px)"},children:["⚠️ ",r]}),o.jsx(f,{type:"primary",htmlType:"submit",block:!0,loading:a,className:"interactive-click neon-glow",style:{height:"52px",fontSize:"18px",fontWeight:600,borderRadius:"12px",background:"var(--success-gradient)",border:"none",boxShadow:"var(--shadow-success)",transition:"var(--transition-bounce)",marginBottom:"12px"},children:"立即註冊"})]})]})}function Wt(){const e=le(),[t,r]=y.useState(!1);return y.useEffect(()=>(document.body.classList.add("register-page"),()=>{document.body.classList.remove("register-page")}),[]),t?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"animated-bg"}),o.jsx("div",{className:"register-container",children:o.jsxs("div",{className:"register-card-modern glass-effect",children:[o.jsx("h2",{style:{color:"var(--text-primary)",textAlign:"center",marginBottom:24},children:"註冊成功！"}),o.jsx("p",{style:{color:"var(--text-secondary)",textAlign:"center",marginBottom:32},children:"請至信箱完成驗證後再登入"}),o.jsx(f,{className:"modern-btn-primary",type:"primary",block:!0,size:"large",onClick:()=>e(be),children:"前往登入"})]})})]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"animated-bg"}),o.jsx("div",{style:{minHeight:"100vh",background:"var(--bg-primary)",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",position:"relative",overflow:"hidden"},children:o.jsxs("div",{className:"glass-morphism animate-scaleIn",style:{padding:"48px 40px",width:"100%",maxWidth:"420px",boxShadow:"var(--shadow-intense)",position:"relative",zIndex:1},children:[o.jsx(zt,{onRegisterSuccess:()=>r(!0)}),o.jsx(f,{block:!0,onClick:()=>e(be),className:"interactive-hover",style:{height:"48px",fontSize:"16px",fontWeight:500,borderRadius:"12px",background:"var(--bg-tertiary)",border:"1px solid var(--border-primary)",color:"var(--text-primary)",marginTop:"12px"},children:"🔙 返回登入"})]})})]})}function Tt(){const{id:e}=ce(),t=le(),{userName:r}=$e(),{project:n,loading:a,error:i}=wt(e),[s]=L.useForm(),[l,c]=y.useState(!1),[d,p]=y.useState(!1),[u,h]=y.useState(!0),[x,g]=y.useState("");return y.useEffect(()=>{s.setFieldsValue({create_at:D(),user:r})},[s,r]),a?o.jsx(Be,{}):i||!n?o.jsx(_t,{message:"找不到專案資料",onBack:()=>t(ye)}):o.jsxs(jt,{userName:r,projectName:n.name,projectId:e,children:[o.jsx("div",{style:{maxWidth:"800px",margin:"0 auto",padding:"20px"},children:o.jsx(B,{className:"modern-card glass-morphism animate-fadeInUp",title:o.jsx("div",{className:"gradient-text",style:{fontSize:"1.5rem",fontWeight:600,display:"flex",alignItems:"center",gap:"8px"},children:"➕ 新增季保養資料"}),style:{marginBottom:24},children:o.jsxs(L,{form:s,layout:"vertical",onFinish:e=>m(null,null,function*(){if(!n)return;c(!0);let t=null;try{t={thing:e.thing,location:e.location,floor:e.floor,creat_at:e.create_at.format("YYYY-MM-DD"),creat_user:r,project:n.name,company:n.unit,direction:n.directions},Object.entries(t).forEach(([e,t])=>{});const{error:a}=yield Fe.maintenanceData.create(t);if(a)throw a;h(!0),g("季保養資料新增成功！"),p(!0),s.resetFields(),s.setFieldsValue({create_at:D(),user:r})}catch(a){h(!1),g(`新增失敗：${a.message||"未知錯誤"}`),p(!0)}finally{c(!1)}}),className:"animate-slideInLeft",style:{maxWidth:"600px",margin:"0 auto",animationDelay:"0.2s",animationFillMode:"both"},children:[o.jsx(L.Item,{label:o.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"🔍 檢查項目"}),name:"thing",rules:[{required:!0,message:"請輸入檢查項目"}],children:o.jsx(K,{placeholder:"請輸入檢查項目",className:"interactive-hover",style:{height:"48px",borderRadius:"12px",fontSize:"16px"}})}),o.jsx(L.Item,{label:o.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"📍 檢查位置"}),name:"location",rules:[{required:!0,message:"請輸入檢查位置"}],children:o.jsx(K,{placeholder:"請輸入檢查位置",className:"interactive-hover",style:{height:"48px",borderRadius:"12px",fontSize:"16px"}})}),o.jsx(L.Item,{label:o.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"🏢 樓層"}),name:"floor",rules:[{required:!0,message:"請輸入樓層"}],children:o.jsx(K,{placeholder:"請輸入樓層",className:"interactive-hover",style:{height:"48px",borderRadius:"12px",fontSize:"16px"}})}),o.jsx(L.Item,{label:o.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"📅 新增日期"}),name:"create_at",rules:[{required:!0,message:"請選擇新增日期"}],children:o.jsx(G,{style:{width:"100%",height:"48px",borderRadius:"12px",fontSize:"16px"},className:"interactive-hover"})}),o.jsx(L.Item,{label:o.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"👤 新增者"}),name:"user",children:o.jsx(K,{disabled:!0,value:r,style:{height:"48px",borderRadius:"12px",fontSize:"16px",background:"var(--bg-secondary)",color:"var(--text-secondary)"}})}),o.jsx(L.Item,{style:{marginTop:32},children:o.jsxs(X,{size:"large",style:{width:"100%",justifyContent:"center"},children:[o.jsx(f,{type:"primary",htmlType:"submit",icon:o.jsx(H,{}),loading:l,size:"large",className:"interactive-click neon-glow",style:{height:"52px",fontSize:"18px",fontWeight:600,borderRadius:"12px",background:"var(--success-gradient)",border:"none",boxShadow:"var(--shadow-success)",padding:"0 32px"},children:"儲存"}),o.jsx(f,{type:"default",icon:o.jsx(J,{}),onClick:()=>{s.resetFields(),s.setFieldsValue({create_at:D(),user:r})},size:"large",className:"interactive-hover",style:{height:"52px",fontSize:"18px",fontWeight:500,borderRadius:"12px",background:"var(--bg-tertiary)",border:"1px solid var(--border-primary)",color:"var(--text-primary)",padding:"0 32px"},children:"取消"})]})})]})})}),o.jsx(Nt,{visible:d,onClose:()=>p(!1),success:u,message:x})]})}const{Title:Et,Text:$t}=g;function Bt(){const{id:e}=ce(),t=le(),{userName:r}=$e(),{project:n,loading:a,error:i}=wt(e),{modal:s}=Q.useApp(),[d,p]=y.useState([]),[u,h]=y.useState(!0),[x,g]=y.useState({}),[j,v]=y.useState([]),[w,S]=y.useState(!1),[k,_]=y.useState(!1);y.useEffect(()=>{n&&N()},[n]);const N=()=>m(null,null,function*(){try{const{data:e,error:t}=yield Fe.maintenanceData.getByProject(n.name);if(t)throw t;const{data:r,error:a}=yield Fe.maintenancePhoto.getByProject(n.name);if(a)throw a;const i=new Map;r.forEach(e=>{const t=`${e.project}_${e.floor}_${e.thing}_${e.location}`;i.set(t,e)});const o=(e.map(e=>{const t=`${e.project}_${e.floor}_${e.thing}_${e.location}`,r=i.get(t);return c(l({},e),{photo_path:r?r.photo_path:null,photo_record_id:r?r.id:null,maintainance_user:r?r.maintainance_user:e.creat_user,maintainance_time:r?r.maintainance_time:e.creat_at})})||[]).sort((e,t)=>{const r=e.photo_path&&""!==e.photo_path.trim(),n=t.photo_path&&""!==t.photo_path.trim();return!r&&n?-1:r&&!n?1:new Date(t.created_at||0)-new Date(e.created_at||0)});p(o),I(o)}catch(e){}finally{h(!1)}}),I=e=>{const t={};e.forEach(e=>{let r="未分類";if(e.location){const t=e.location.match(/[\u4e00-\u9fff]+/);r=t?t[0]:"未分類"}t[r]||(t[r]=[]),t[r].push(e)}),Object.keys(t).forEach(e=>{t[e].sort((e,t)=>C(e.location)-C(t.location))}),g(t)},C=e=>{if(!e)return 0;const t=e.match(/(\d+)-(\d+)/);return t?100*parseInt(t[1])+parseInt(t[2]):0},R=e=>{if(!e)return null;try{const{data:t}=Te.storage.from("maintainance-data-photo").getPublicUrl(e);return t.publicUrl}catch(t){return null}},z=e=>{const t=e.photo_path,r=j.includes(e.id),n={minWidth:280,flexShrink:0,position:"relative",border:r?"2px solid #1890ff":void 0,boxShadow:r?"0 0 10px rgba(24, 144, 255, 0.3)":void 0};return o.jsx(B,{className:"modern-card "+(t?"":"maintenance-card-missing"),style:n,cover:o.jsxs("div",{style:{position:"relative"},children:[w&&o.jsx(te,{checked:r,onChange:t=>{return r=e.id,n=t.target.checked,void v(n?e=>[...e,r]:e=>e.filter(e=>e!==r));var r,n},style:{position:"absolute",top:8,right:8,zIndex:10,backgroundColor:"var(--bg-secondary)",borderRadius:"4px",padding:"2px",border:"1px solid var(--border-primary)",boxShadow:"var(--shadow-sm)"}}),t?o.jsx("img",{alt:"保養照片",src:R(e.photo_path),style:{height:160,objectFit:"cover",width:"100%"},onLoad:()=>{},onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="flex"}}):o.jsx("div",{style:{height:160,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(255, 77, 79, 0.2)",color:"#ff4d4f"},children:o.jsx(M,{style:{fontSize:48}})})]}),children:o.jsx(B.Meta,{title:o.jsx("div",{style:{color:t?"var(--text-primary)":"#ff4d4f"},children:e.location}),description:o.jsxs("div",{children:[o.jsxs($t,{style:{color:"var(--text-secondary)"},children:["檢查項目：",e.thing]}),o.jsx("br",{}),o.jsxs($t,{style:{color:"var(--text-muted)"},children:["樓層：",e.floor]}),o.jsx("br",{}),o.jsxs($t,{style:{color:"var(--text-muted)"},children:["新增日期：",e.maintainance_time]}),o.jsx("br",{}),o.jsxs($t,{style:{color:"var(--text-muted)"},children:["保養者：",e.maintainance_user||"未填寫"]}),!t&&o.jsx("div",{style:{marginTop:8,color:"#ff4d4f",fontSize:12},children:"⚠️ 缺少照片資料"})]})})},e.id)},W=e=>Object.entries(e).map(([e,t],r)=>o.jsxs("div",{className:"animate-slideInLeft",style:{marginBottom:32,animationDelay:.1*r+"s",animationFillMode:"both"},children:[o.jsxs(Et,{level:4,className:"gradient-text",style:{marginBottom:16,borderLeft:"4px solid var(--text-accent)",paddingLeft:12,fontSize:"1.3rem",fontWeight:600},children:["📂 ",e]}),o.jsx("div",{className:"horizontal-scroll",children:t.map((e,t)=>o.jsx("div",{className:"animate-scaleIn",style:{animationDelay:.1*r+.05*t+"s",animationFillMode:"both"},children:z(e)},e.id))})]},e));if(a)return o.jsx(Be,{});if(i||!n)return o.jsx(_t,{message:"找不到專案資料",onBack:()=>t(ye)});const T=[{key:"location",label:"按檢查位置分類",children:u?o.jsx("div",{style:{textAlign:"center",padding:40},children:o.jsx(b,{size:"large"})}):0===Object.keys(x).length?o.jsx(Z,{description:"暫無保養資料"}):W(x)},{key:"thing",label:"按檢查項目分類",children:u?o.jsx("div",{style:{textAlign:"center",padding:40},children:o.jsx(b,{size:"large"})}):0===d.length?o.jsx(Z,{description:"暫無保養資料"}):W((e=>{const t={};return e.forEach(e=>{const r=e.thing||"未分類";t[r]||(t[r]=[]),t[r].push(e)}),t})(d))}];return o.jsx(jt,{userName:r,projectName:n.name,projectId:e,children:o.jsx("div",{style:{maxWidth:"1200px",margin:"0 auto",padding:"20px"},children:o.jsx(B,{className:"modern-card glass-morphism animate-fadeInUp",title:o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsx("div",{className:"gradient-text",style:{display:"flex",alignItems:"center",gap:8,fontSize:"1.5rem",fontWeight:600},children:"👁️ 查看季保養資料"}),o.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[w&&o.jsxs(o.Fragment,{children:[o.jsxs(te,{checked:j.length===d.length&&d.length>0,indeterminate:j.length>0&&j.length<d.length,onChange:e=>{return t=e.target.checked,void v(t?d.map(e=>e.id):[]);var t},style:{color:"var(--text-primary)"},children:["全選 (",j.length,"/",d.length,")"]}),o.jsxs(f,{type:"primary",danger:!0,icon:o.jsx(re,{}),onClick:()=>{m(null,null,function*(){0!==j.length?s.confirm({title:o.jsxs("span",{style:{color:"var(--text-primary)"},children:[o.jsx(re,{})," 確認刪除季保養項目"]}),content:o.jsxs("span",{style:{color:"var(--text-secondary)"},children:["您確定要刪除選中的 ",o.jsx("strong",{style:{color:"var(--text-accent)"},children:j.length})," 個季保養項目嗎？這將刪除 maintainance_data 表中的資料記錄。"]}),okText:"確認",cancelText:"取消",okButtonProps:{danger:!0},centered:!0,className:"modern-modal",onOk:()=>m(null,null,function*(){_(!0);try{for(const e of j)yield Fe.maintenanceData.delete(e);$.success({title:"刪除成功",content:`成功刪除 ${j.length} 個季保養項目`,className:"custom-success-modal"}),v([]),S(!1),N()}catch(e){$.error({title:"刪除失敗",content:"操作失敗，請稍後再試",className:"modern-modal"})}finally{_(!1)}})}):A.warning("請先選擇要刪除的項目")})},loading:k,disabled:0===j.length,style:{marginRight:8},children:["刪除季保養項目 (",j.length,")"]}),o.jsxs(f,{type:"primary",danger:!0,icon:o.jsx(re,{}),onClick:()=>{m(null,null,function*(){0!==j.length?s.confirm({title:o.jsxs("span",{style:{color:"var(--text-primary)"},children:[o.jsx(re,{})," 確認刪除本次季保養資料"]}),content:o.jsxs("span",{style:{color:"var(--text-secondary)"},children:["您確定要刪除選中的 ",o.jsx("strong",{style:{color:"var(--text-accent)"},children:j.length})," 個項目的照片資料嗎？這將刪除 maintainance_photo 表中的資料和相關照片文件。"]}),okText:"確認",cancelText:"取消",okButtonProps:{danger:!0},centered:!0,className:"modern-modal",onOk:()=>m(null,null,function*(){_(!0);try{for(const e of j){const t=d.find(t=>t.id===e);t&&t.photo_record_id&&(t.photo_path&&(yield Fe.storage.deleteImage("maintainance-data-photo",t.photo_path)),yield Fe.maintenancePhoto.delete(t.photo_record_id))}$.success({title:"刪除成功",content:`成功刪除 ${j.length} 個本次季保養資料`,className:"custom-success-modal"}),v([]),S(!1),N()}catch(e){$.error({title:"刪除失敗",content:"操作失敗，請稍後再試",className:"modern-modal"})}finally{_(!1)}})}):A.warning("請先選擇要刪除的項目")})},loading:k,disabled:0===j.length,children:["刪除本次季保養資料 (",j.length,")"]})]}),o.jsx(f,{type:w?"default":"primary",icon:o.jsx(ne,{}),onClick:()=>{S(!w),v([])},children:w?"取消選擇":"批量選擇"})]})]}),style:{marginBottom:24},children:o.jsx(ee,{items:T,defaultActiveKey:"location",className:"animate-slideInRight",style:{minHeight:400,animationDelay:"0.3s",animationFillMode:"both"}})})})})}var Ot=ue();const Ft=h(Ot);function At(e){return m(this,null,function*(){const t=yield fetch(e);return yield t.arrayBuffer()})}function Ut(){const{id:e}=ce(),t=le(),{userName:r}=$e(),{project:n,loading:a,error:i}=wt(e),{message:s,modal:l}=Q.useApp(),[c,d]=y.useState(!1),[p,u]=y.useState(null),[h,x]=y.useState([]),[g,b]=y.useState([]),[j,v]=y.useState(""),[w,S]=y.useState({}),k=e=>{const t=Object.keys(e),r={};for(const n of t){const t=e[n],a=t.length,i=[],o={key:"count-row",rowType:"count"};o.col_0=`照片數量: ${a}`,o.col_1="",o.col_2="",o.col_3="",i.push(o);const s={key:"header-row",rowType:"header",col_0:"項次",col_1:"照片",col_2:"位置",col_3:"備註"};i.push(s);for(let e=0;e<a;e++){const r={key:`data-row-${e}`,rowType:"data"},n=t[e];n?(r.col_0=e+1,r.col_1=n.photo_path,r.col_2=n.location||"",r.col_3=""):(r.col_0="",r.col_1="",r.col_2="",r.col_3=""),i.push(r)}r[n]=i}return r},_=e=>{const t=[];return t.push({title:"項次",dataIndex:"col_0",key:"col_0",width:50,align:"center",render:(e,t)=>"count"===t.rowType?{children:e,props:{colSpan:4}}:"header"===t.rowType?{children:e,props:{style:{backgroundColor:"#fafafa",fontWeight:"bold"}}}:e}),t.push({title:"照片",dataIndex:"col_1",key:"col_1",width:280,align:"center",render:(e,t)=>"count"===t.rowType?{children:"",props:{colSpan:0}}:"header"===t.rowType?{children:e,props:{style:{backgroundColor:"#fafafa",fontWeight:"bold"}}}:e&&"data"===t.rowType?o.jsx("img",{src:Fe.storage.getImageUrl("maintainance-data-photo",e),alt:"照片",style:{width:267,height:199,objectFit:"contain",border:"1px solid #d9d9d9",borderRadius:"4px"}}):e}),t.push({title:"位置",dataIndex:"col_2",key:"col_2",width:96,align:"center",render:(e,t)=>"count"===t.rowType?{children:"",props:{colSpan:0}}:"header"===t.rowType?{children:e,props:{style:{backgroundColor:"#fafafa",fontWeight:"bold"}}}:e}),t.push({title:"備註",dataIndex:"col_3",key:"col_3",width:96,align:"center",render:(e,t)=>"count"===t.rowType?{children:"",props:{colSpan:0}}:"header"===t.rowType?{children:e,props:{style:{backgroundColor:"#fafafa",fontWeight:"bold"}}}:e}),t};return y.useEffect(()=>{n&&n.name&&m(null,null,function*(){if(d(!0),u(null),n&&n.name)try{const{data:e,error:t}=yield Fe.maintenancePhoto.getByProject(n.name);if(t)throw t;if(!e||0===e.length)return x([]),void d(!1);const r=e.reduce((e,t)=>{const r=t.thing||"未分類";return e[r]||(e[r]=[]),e[r].push(t),e},{});S(r);const a=k(r);x(a);const i=Object.keys(r),o=_(i);b(o),i.length>0&&v(i[0])}catch(e){u("無法獲取或處理數據"),s.error("操作失敗，請稍後再試")}finally{d(!1)}else d(!1)})},[n]),a?o.jsx(Be,{}):i||!n?o.jsx(ErrorMessage,{message:"找不到專案資料",onBack:()=>t("/")}):o.jsx(jt,{userName:r,projectName:null==n?void 0:n.name,projectId:e,children:o.jsxs("div",{style:{padding:"20px",color:"white"},children:[o.jsx("h1",{children:"匯出 Excel"}),o.jsx("p",{children:"點擊下面的按鈕來下載季保養資料的 Excel 檔案。"}),o.jsx("p",{style:{fontSize:"0.9em",color:"var(--text-secondary)"},children:"Excel 檔案將所有檢查項目橫向排列在同一個工作表中。每個檢查項目佔用 4 欄（項次｜照片｜位置｜備註）， 包含照片數量統計、分類標題和詳細資料。格式符合維護照片記錄範本規範。"}),o.jsx(f,{type:"primary",onClick:()=>m(null,null,function*(){if(d(!0),u(null),!n||!n.name)return $.error({title:"無法生成 Excel",content:"專案資料尚未載入，請稍後再試。",className:"modern-modal"}),void d(!1);try{const{data:t,error:r}=yield Fe.maintenancePhoto.getByProject(n.name);if(r)throw r;const a=new Ft.Workbook;for(const n of Object.keys(w)){const t=a.addWorksheet(n),r=w[n];t.getColumn(1).width=5,t.getColumn(2).width=40,t.getColumn(3).width=12,t.getColumn(4).width=12;let i=1;const o=t.getCell(i,1);o.value=`照片數量: ${r.length}`,o.alignment={horizontal:"center",vertical:"middle"},o.font={bold:!0},t.mergeCells(i,1,i,4),i++,["項次","照片","位置","備註"].forEach((e,r)=>{const n=t.getCell(i,r+1);n.value=e,n.alignment={horizontal:"center",vertical:"middle"},n.font={bold:!0},n.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFAFAFA"}},n.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}),i++;for(const[n,s]of r.entries()){let r=387;const o=t.getCell(i,1);o.value=n+1,o.alignment={horizontal:"center",vertical:"middle"},o.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}};const l=t.getCell(i,2);if(s.photo_path)try{const e=Fe.storage.getImageUrl("maintainance-data-photo",s.photo_path),r=yield At(e),n=a.addImage({buffer:r,extension:"jpeg"});t.addImage(n,{tl:{col:1.05,row:i-1+.1},ext:{width:267,height:199}})}catch(e){l.value="無法載入圖片"}l.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}};const c=t.getCell(i,3);c.value=s.location||"",c.alignment={horizontal:"center",vertical:"middle"},c.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}};const d=t.getCell(i,4);d.value="",d.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},t.getRow(i).height=r,i++}}const i=yield a.xlsx.writeBuffer(),o=new Blob([i],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),s=document.createElement("a");s.href=URL.createObjectURL(o),s.download=`${n.name}_季保養.xlsx`,s.click(),$.success({title:"Excel 文件已成功下載",content:`檔案 ${n.name}_季保養.xlsx 已經可以開啟。`,className:"custom-success-modal"})}catch(t){u("無法獲取或處理數據"),$.error({title:"操作失敗",content:"請稍後再試",className:"modern-modal"})}finally{d(!1)}}),loading:c,disabled:c,children:c?"正在生成...":"下載 Excel"}),p&&o.jsx(q,{message:p,type:"error",style:{marginTop:20}}),o.jsxs("div",{style:{marginTop:20},children:[o.jsx("h2",{children:"Excel 格式預覽"}),o.jsx("p",{style:{fontSize:"0.9em",color:"var(--text-secondary)",marginBottom:"16px"},children:"以下預覽展示了 Excel 檔案的實際格式：每個檢查項目佔用 4 欄（項次｜照片｜位置｜備註）， 所有分類橫向排列在同一個工作表中。"}),o.jsx("div",{style:{overflowX:"auto"},children:o.jsx(ee,{activeKey:j,onChange:v,children:Object.keys(w).map(e=>o.jsx(ee.TabPane,{tab:e,children:o.jsx(ae,{columns:_(),dataSource:h[e],loading:c,pagination:!1,bordered:!0,size:"small",scroll:{x:"max-content"},rowClassName:e=>"data"===e.rowType?"data-row-height":""})},e))})})]})]})})}function Pt({onLoginSuccess:e}){const[t,r]=y.useState([]),[n,a]=y.useState(""),[i,s]=y.useState(""),[l,c]=y.useState(""),[d,p]=y.useState(!1),u=le();y.useEffect(()=>{!function(){m(this,null,function*(){const{data:e,error:t}=yield Fe.users.getAll();!t&&e&&r(e)})}()},[]);const h=()=>m(null,null,function*(){if(c(""),p(!0),!n||!i)return c("請輸入帳號和密碼"),void p(!1);try{const{data:{user:t}}=yield Te.auth.getUser();let r=n;if(!n.includes("@")){const{data:e,error:t}=yield Te.from("user_names").select("email").eq("user",n).single();if(t||!e)return c("找不到此用戶名"),void p(!1);r=e.email}const{data:a,error:o}=yield Te.auth.signInWithPassword({email:r,password:i});if(o)return c("登入失敗："+o.message),void p(!1);A.success("登入成功！"),e&&e()}catch(t){c("登入異常："+t.message)}finally{p(!1)}}),x=t.filter(e=>e.user&&!e.user.includes("@")).map(e=>({value:e.user}));return o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"animated-bg"}),o.jsx("div",{style:{minHeight:"100vh",background:"var(--bg-primary)",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",position:"relative",overflow:"hidden"},children:o.jsxs("div",{className:"glass-morphism animate-scaleIn",style:{padding:"48px 40px",width:"100%",maxWidth:"420px",boxShadow:"var(--shadow-intense)",position:"relative",zIndex:1},children:[o.jsxs("div",{className:"animate-fadeInUp",style:{textAlign:"center",marginBottom:"32px"},children:[o.jsx("div",{className:"neon-glow animate-rotateIn",style:{width:"80px",height:"80px",borderRadius:"50%",background:"var(--primary-gradient)",margin:"0 auto 24px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"2rem",fontWeight:"bold",color:"white"},children:"🔧"}),o.jsx(g.Title,{level:2,className:"gradient-text",style:{marginBottom:"8px",fontSize:"2rem",fontWeight:700},children:"季保養管理系統"})]}),o.jsxs(L,{layout:"vertical",onFinish:h,className:"animate-fadeInUp",style:{animationDelay:"0.3s",animationFillMode:"both"},children:[o.jsx(L.Item,{label:o.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"👤 帳號"}),required:!0,children:o.jsx(ie,{className:"interactive-hover",value:n,onChange:a,options:x,placeholder:"請輸入Email或選擇用戶名",style:{height:"48px",borderRadius:"12px",fontSize:"16px"},filterOption:(e,t)=>{var r;return(null!=(r=null==t?void 0:t.value)?r:"").toLowerCase().includes(e.toLowerCase())}})}),o.jsx(L.Item,{label:o.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500},children:"🔒 密碼"}),required:!0,children:o.jsx(K.Password,{className:"interactive-hover",value:i,onChange:e=>s(e.target.value),placeholder:"請輸入密碼",style:{height:"48px",borderRadius:"12px",fontSize:"16px"},onPressEnter:h})}),l&&o.jsxs("div",{className:"animate-slideInLeft",style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid var(--border-danger)",borderRadius:"12px",padding:"12px 16px",color:"var(--text-danger)",marginBottom:"24px",textAlign:"center",fontWeight:500,backdropFilter:"blur(10px)"},children:["⚠️ ",l]}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[o.jsx(f,{type:"primary",onClick:h,loading:d,block:!0,disabled:!n||!i,className:"interactive-click neon-glow",style:{height:"52px",fontSize:"18px",fontWeight:600,borderRadius:"12px",background:"var(--primary-gradient)",border:"none",boxShadow:"var(--shadow-glow)",transition:"var(--transition-bounce)"},children:"立即登入"}),o.jsx(f,{block:!0,onClick:()=>u(je),className:"interactive-hover",style:{height:"48px",fontSize:"16px",fontWeight:500,borderRadius:"12px",background:"var(--bg-tertiary)",border:"1px solid var(--border-primary)",color:"var(--text-primary)"},children:"註冊新帳號"})]})]})]})})]})}function Lt(){return o.jsx(Ie,{children:o.jsx(Q,{children:o.jsx(de,{children:o.jsxs(me,{children:[o.jsx(pe,{path:be,element:o.jsx(Dt,{})}),o.jsx(pe,{path:je,element:o.jsx(Wt,{})}),o.jsx(pe,{path:ye,element:o.jsx(Oe,{children:o.jsx(kt,{})})}),o.jsx(pe,{path:ve,element:o.jsx(Oe,{children:o.jsx(It,{})})}),o.jsx(pe,{path:we,element:o.jsx(Oe,{children:o.jsx(Ct,{})})}),o.jsx(pe,{path:Se,element:o.jsx(Oe,{children:o.jsx(Rt,{})})}),o.jsx(pe,{path:ke,element:o.jsx(Oe,{children:o.jsx(Tt,{})})}),o.jsx(pe,{path:_e,element:o.jsx(Oe,{children:o.jsx(Bt,{})})}),o.jsx(pe,{path:Ne,element:o.jsx(Oe,{children:o.jsx(Ut,{})})}),o.jsx(pe,{path:"*",element:o.jsx(se,{to:be,replace:!0})})]})})})})}function Dt(){const e=le();return o.jsx(Pt,{onLoginSuccess:()=>e(ye)})}xe.createRoot(document.getElementById("root")).render(o.jsx(x.StrictMode,{children:o.jsx(Lt,{})}))}},function(){return xe||(0,he[n(he)[0]])((xe={exports:{}}).exports,xe),xe.exports});export default ge();
