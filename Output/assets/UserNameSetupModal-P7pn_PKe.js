import{j as e,s as r}from"./index-DDyIevCc.js";import{F as t,r as s,M as a,I as o,b as n,B as i,s as l}from"./antd-Bl7BgLRS.js";import"./vendor-CeQafwst.js";import"./supabase-DQJTPruz.js";import"./router-xrOJY9lc.js";import"./utils-BLtkkhtr.js";const d=({visible:d,onClose:m,userEmail:c,onSuccess:u})=>{const[p]=t.useForm(),[x,y]=s.useState(!1);return e.jsxs(a,{title:e.jsxs("div",{style:{textAlign:"center",color:"var(--text-primary)"},children:[e.jsx(n,{style:{marginRight:8,color:"var(--text-accent)"}}),"設定您的用戶名"]}),open:d,onCancel:m,footer:null,className:"modern-modal user-setup-modal",centered:!0,maskClosable:!1,closable:!1,width:400,styles:{mask:{backgroundColor:"rgba(0, 0, 0, 0.7)"},content:{backgroundColor:"var(--bg-card)",border:"1px solid var(--border-primary)",borderRadius:"16px"},header:{backgroundColor:"transparent",borderBottom:"1px solid var(--border-primary)"},body:{backgroundColor:"transparent"}},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:24},children:[e.jsx("div",{style:{background:"var(--primary-gradient)",width:60,height:60,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px",fontSize:"24px"},children:"👤"}),e.jsx("p",{style:{color:"var(--text-secondary)",margin:0},children:"歡迎！請設定您的用戶名以完成註冊"})]}),e.jsxs(t,{form:p,layout:"vertical",onFinish:e=>{return t=null,s=null,a=function*(){y(!0);try{const{userName:t}=e,{data:s,error:a}=yield r.from("user_names").select("user").eq("user",t).single();if(s)return l.error("此用戶名已被使用，請選擇其他名稱"),void y(!1);const{error:o}=yield r.from("user_names").insert([{user:t,email:c}]);if(o)throw o;l.success("用戶名設定成功！"),p.resetFields(),u(t),m()}catch(t){l.error("設定用戶名失敗："+t.message)}finally{y(!1)}},new Promise((e,r)=>{var o=e=>{try{i(a.next(e))}catch(t){r(t)}},n=e=>{try{i(a.throw(e))}catch(t){r(t)}},i=r=>r.done?e(r.value):Promise.resolve(r.value).then(o,n);i((a=a.apply(t,s)).next())});var t,s,a},autoComplete:"off",children:[e.jsx(t.Item,{label:e.jsx("span",{style:{color:"var(--text-primary)"},children:"用戶名"}),name:"userName",rules:[{required:!0,message:"請輸入用戶名"},{min:2,message:"用戶名至少需要2個字符"},{max:20,message:"用戶名不能超過20個字符"},{pattern:/^[a-zA-Z0-9\u4e00-\u9fa5_-]+$/,message:"用戶名只能包含字母、數字、中文、底線和連字符"}],children:e.jsx(o,{prefix:e.jsx(n,{style:{color:"var(--text-muted)"}}),placeholder:"請輸入您的用戶名",style:{height:44,borderRadius:8,fontSize:16}})}),e.jsx(t.Item,{style:{marginBottom:0,textAlign:"center"},children:e.jsx(i,{type:"primary",htmlType:"submit",loading:x,block:!0,style:{height:44,borderRadius:8,fontSize:16,fontWeight:600,background:"var(--primary-gradient)",border:"none"},children:"完成設定"})})]})]})};export{d as default};
