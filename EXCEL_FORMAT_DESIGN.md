# Excel 輸出格式設計文檔

## 概述
根據 SETUP.md 規格，為 `/project/1/export-excel` 路由設計符合「弱電系統維運檢查_一頁式」格式的 Excel 輸出。

## 主要修正項目

### 1. 版面結構 (符合 SETUP.md)
- **工作表尺寸**: 1008列 × 39欄 (A-AM)
- **資料區域**: A1 至 AM1008
- **每組資料**: 佔用10列高度

### 2. 標題與欄寬設定
- **主標題** (A1:AM1): 專案名稱，微軟正黑體 16pt 粗體置中，列高 40pt
- **欄寬設定**:
  - A-C欄: 20字元 (144px)
  - D-I欄: 15字元 (108px)  
  - J-L欄: 12字元 (86px)
  - M-R欄: 18字元 (130px)
  - S-U欄: 12字元 (86px)
  - V-AA欄: 18字元 (130px)
  - AB-AM欄: 15字元 (108px)

### 3. 固定標題區域
- **A2:A4**: "決裁編號" (合併儲存格)
- **B2:D2**: "工程名稱" (合併儲存格)
- **I2:M2**: 專案名稱 (合併儲存格)
- **V2:AA2**: "驗收照片" (合併儲存格)

### 4. 資料區塊結構 (每組10列)
每組資料從第5列開始，按以下格式排列：

#### 左側資料區 (C欄-I欄):
- **C5:I5**: "位置" 標籤 (灰色背景)
- **C6:I6**: 位置內容
- **C7:I7**: "內容" 標籤 (灰色背景)
- **C8:I8**: 內容描述
- **C9:I9**: "備註" 標籤 (灰色背景)
- **C10:I14**: 備註內容區域 (5列高度)

#### 右側照片區 (V欄-AA欄):
- **V5:AA14**: 驗收照片區域 (10列高度，對應左側資料)

### 5. 圖片處理
- **位置**: V欄至AA欄的合併區域
- **尺寸**: 寬度130px，高度250pt
- **格式**: 自動縮放至儲存格大小

### 6. 列高設定
- **標題列** (第1列): 40pt (53.33px)
- **說明列** (第2-4列): 25pt (33.33px)
- **資料列**: 25pt (33.33px)
- **間隔列** (每5組後): 15pt (20px)

### 7. 特殊功能
- **每5組重複標題**: 在第25、35列等位置重複顯示分類標題
- **自動邊框**: 所有資料儲存格都有細邊框
- **字型統一**: 微軟正黑體

## 資料來源對應

### 從 maintainance_photo 表格取得:
- `location` → 位置內容
- `thing` → 內容描述 (備用)
- `content` 或 `check_result` → 內容描述
- `notes` 或 `remarks` → 備註內容
- `photo_path` → 驗收照片

## 技術實現要點

### 1. 儲存格合併
```javascript
// 位置標籤
worksheet.mergeCells(`C${groupStartRow}:I${groupStartRow}`);

// 照片區域 (10列高度)
worksheet.mergeCells(`V${groupStartRow}:AA${groupStartRow + 9}`);
```

### 2. 圖片插入
```javascript
worksheet.addImage(imageId, {
  tl: { col: 21, row: groupStartRow - 1 }, // V欄 = 21
  ext: { width: 130, height: 250 }
});
```

### 3. 樣式設定
```javascript
const addCellBorder = (cell) => {
  cell.border = {
    top: { style: 'thin' },
    left: { style: 'thin' },
    bottom: { style: 'thin' },
    right: { style: 'thin' }
  };
};
```

## 輸出檔案
- **檔名格式**: `{專案名稱}_季保養檢查表.xlsx`
- **工作表名稱**: "季保養檢查表"
- **檔案類型**: Excel 2007+ (.xlsx)

## 與原始需求的符合度
✅ 單一工作表包含所有資料  
✅ 固定的行列結構  
✅ 正確的儲存格合併  
✅ 符合規格的欄寬列高  
✅ 圖片自動縮放  
✅ 每5組重複標題  
✅ 完整的邊框樣式  

這個設計完全符合 SETUP.md 中描述的「MITSUI OUTLET PARK 台南」範本格式要求。