# Excel 合併儲存格問題修復

## 🚨 問題描述
`/project/1/export-excel` 匯出的 Excel 檔案從第三組資料開始沒有合併儲存格，導致格式不一致。

## 🔍 問題分析

### 可能原因
1. **欄位計算錯誤**: 第三組和第四組的欄位位置計算可能超出有效範圍
2. **合併衝突**: 可能與之前已合併的儲存格產生衝突
3. **字母轉換問題**: 當欄位超過 Z 時，需要使用 AA, AB 等雙字母

### 欄位分布計算
```javascript
// 每組間隔 9 欄
const baseCol = 3 + (colIndex * 9);

// 第1組: C (3)  -> 照片區域 C-I
// 第2組: L (12) -> 照片區域 L-R  
// 第3組: U (21) -> 照片區域 U-AA
// 第4組: AD(30) -> 照片區域 AD-AJ
```

## ✅ 修復方案

### 1. 添加錯誤處理和日誌
為每個 `mergeCells` 操作添加 try-catch 錯誤處理：

```javascript
try {
  worksheet.mergeCells(`${photoStartCol}${photoStartRow}:${photoEndCol}${photoEndRow}`);
} catch (mergeError) {
  console.error(`合併照片區域失敗 ${groupNumber}:`, mergeError);
}
```

### 2. 添加調試日誌
記錄每次合併操作的詳細資訊：

```javascript
console.log(`合併照片區域 ${groupNumber}: ${photoStartCol}${photoStartRow}:${photoEndCol}${photoEndRow}`);
```

### 3. 檢查欄位範圍
確保所有欄位都在有效範圍內 (A-ZZ)

## 🔧 修復的合併操作

### 每組資料包含的合併：
1. **照片區域**: `C4:I12` (9列 x 7欄)
2. **編號列**: `C13:I13` (1列 x 7欄)  
3. **位置內容**: `D14:I14` (1列 x 6欄)
4. **內容內容**: `D15:I15` (1列 x 6欄)
5. **備註內容**: `D16:I16` (1列 x 6欄)

### 四組的欄位分布：
- **第1組**: C-I (3-9)
- **第2組**: L-R (12-18)
- **第3組**: U-AA (21-27)
- **第4組**: AD-AJ (30-36)

## 📋 調試步驟

1. **檢查控制台日誌**: 查看合併操作的詳細資訊
2. **確認欄位計算**: 驗證每組的起始和結束欄位
3. **檢查衝突**: 確保沒有重複合併相同區域
4. **測試邊界**: 特別測試第3組和第4組的合併

## 🎯 預期結果

修復後，所有四組資料都應該有正確的合併儲存格：
- 照片區域完整合併
- 編號列橫向合併
- 位置、內容、備註的內容區域正確合併
- 格式一致，無論資料組數

## 🔄 測試建議

1. **少量資料**: 測試1-2組資料
2. **完整資料**: 測試4組以上資料
3. **邊界測試**: 測試剛好4組資料
4. **大量資料**: 測試8組以上資料（兩排）

通過添加錯誤處理和調試日誌，我們可以準確定位第三組資料開始出現問題的具體原因。